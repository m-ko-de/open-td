import{r as tr,g as sr}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();var ir=tr();const tt=sr(ir);const rr=n=>{const e=new Map;e.set("web",{name:"web"});const t=n.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:e},s=(r,o)=>{t.platforms.set(r,o)},i=r=>{t.platforms.has(r)&&(t.currentPlatform=t.platforms.get(r))};return t.addPlatform=s,t.setPlatform=i,t},nr=n=>n.CapacitorPlatforms=rr(n),yi=nr(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});yi.addPlatform;yi.setPlatform;var We;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(We||(We={}));class Vt extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}const or=n=>{var e,t;return n?.androidBridge?"android":!((t=(e=n?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},ar=n=>{var e,t,s,i,r;const o=n.CapacitorCustomPlatform||null,a=n.Capacitor||{},l=a.Plugins=a.Plugins||{},h=n.CapacitorPlatforms,d=()=>o!==null?o.name:or(n),u=((e=h?.currentPlatform)===null||e===void 0?void 0:e.getPlatform)||d,p=()=>u()!=="web",g=((t=h?.currentPlatform)===null||t===void 0?void 0:t.isNativePlatform)||p,b=M=>{const N=S.get(M);return!!(N?.platforms.has(u())||k(M))},T=((s=h?.currentPlatform)===null||s===void 0?void 0:s.isPluginAvailable)||b,L=M=>{var N;return(N=a.PluginHeaders)===null||N===void 0?void 0:N.find(ue=>ue.name===M)},k=((i=h?.currentPlatform)===null||i===void 0?void 0:i.getPluginHeader)||L,_=M=>n.console.error(M),D=(M,N,ue)=>Promise.reject(`${ue} does not have an implementation of "${N}".`),S=new Map,U=(M,N={})=>{const ue=S.get(M);if(ue)return console.warn(`Capacitor plugin "${M}" already registered. Cannot register plugins twice.`),ue.proxy;const oe=u(),$=k(M);let J;const Te=async()=>(!J&&oe in N?J=typeof N[oe]=="function"?J=await N[oe]():J=N[oe]:o!==null&&!J&&"web"in N&&(J=typeof N.web=="function"?J=await N.web():J=N.web),J),W=(j,A)=>{var se,H;if($){const ae=$?.methods.find(I=>A===I.name);if(ae)return ae.rtype==="promise"?I=>a.nativePromise(M,A.toString(),I):(I,pe)=>a.nativeCallback(M,A.toString(),I,pe);if(j)return(se=j[A])===null||se===void 0?void 0:se.bind(j)}else{if(j)return(H=j[A])===null||H===void 0?void 0:H.bind(j);throw new Vt(`"${M}" plugin is not implemented on ${oe}`,We.Unimplemented)}},te=j=>{let A;const se=(...H)=>{const ae=Te().then(I=>{const pe=W(I,j);if(pe){const _e=pe(...H);return A=_e?.remove,_e}else throw new Vt(`"${M}.${j}()" is not implemented on ${oe}`,We.Unimplemented)});return j==="addListener"&&(ae.remove=async()=>A()),ae};return se.toString=()=>`${j.toString()}() { [capacitor code] }`,Object.defineProperty(se,"name",{value:j,writable:!1,configurable:!1}),se},at=te("addListener"),lt=te("removeListener"),ct=(j,A)=>{const se=at({eventName:j},A),H=async()=>{const I=await se;lt({eventName:j,callbackId:I},A)},ae=new Promise(I=>se.then(()=>I({remove:H})));return ae.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await H()},ae},je=new Proxy({},{get(j,A){switch(A){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return $?ct:at;case"removeListener":return lt;default:return te(A)}}});return l[M]=je,S.set(M,{name:M,proxy:je,platforms:new Set([...Object.keys(N),...$?[oe]:[]])}),je},P=((r=h?.currentPlatform)===null||r===void 0?void 0:r.registerPlugin)||U;return a.convertFileSrc||(a.convertFileSrc=M=>M),a.getPlatform=u,a.handleError=_,a.isNativePlatform=g,a.isPluginAvailable=T,a.pluginMethodNoop=D,a.registerPlugin=P,a.Exception=Vt,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,a.platform=a.getPlatform(),a.isNative=a.isNativePlatform(),a},lr=n=>n.Capacitor=ar(n),rt=lr(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),wi=rt.registerPlugin;rt.Plugins;class bi{constructor(e){this.listeners={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t);const i=this.windowListeners[e];i&&!i.registered&&this.addWindowListener(i);const r=async()=>this.removeListener(e,t),o=Promise.resolve({remove:r});return Object.defineProperty(o,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await r()}}),o}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t){const s=this.listeners[e];s&&s.forEach(i=>i(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:s=>{this.notifyListeners(t,s)}}}unimplemented(e="not implemented"){return new rt.Exception(e,We.Unimplemented)}unavailable(e="not available"){return new rt.Exception(e,We.Unavailable)}async removeListener(e,t){const s=this.listeners[e];if(!s)return;const i=s.indexOf(t);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}}const qs=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),js=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class cr extends bi{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(s=>{if(s.length<=0)return;let[i,r]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=js(i).trim(),r=js(r).trim(),t[i]=r}),t}async setCookie(e){try{const t=qs(e.key),s=qs(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,r=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${i}; path=${r}; ${o};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}wi("CapacitorCookies",{web:()=>new cr});const hr=async n=>new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{const i=s.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},s.onerror=i=>t(i),s.readAsDataURL(n)}),dr=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(i=>i.toLocaleLowerCase()).reduce((i,r,o)=>(i[r]=n[e[o]],i),{})},ur=(n,e=!0)=>n?Object.entries(n).reduce((s,i)=>{const[r,o]=i;let a,l;return Array.isArray(o)?(l="",o.forEach(h=>{a=e?encodeURIComponent(h):h,l+=`${r}=${a}&`}),l.slice(0,-1)):(a=e?encodeURIComponent(o):o,l=`${r}=${a}`),`${s}&${l}`},"").substr(1):null,pr=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),i=dr(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(i.includes("application/x-www-form-urlencoded")){const r=new URLSearchParams;for(const[o,a]of Object.entries(n.data||{}))r.set(o,a);t.body=r.toString()}else if(i.includes("multipart/form-data")||n.data instanceof FormData){const r=new FormData;if(n.data instanceof FormData)n.data.forEach((a,l)=>{r.append(l,a)});else for(const a of Object.keys(n.data))r.append(a,n.data[a]);t.body=r;const o=new Headers(t.headers);o.delete("content-type"),t.headers=o}else(i.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class fr extends bi{async request(e){const t=pr(e,e.webFetchExtra),s=ur(e.params,e.shouldEncodeUrlParams),i=s?`${e.url}?${s}`:e.url,r=await fetch(i,t),o=r.headers.get("content-type")||"";let{responseType:a="text"}=r.ok?e:{};o.includes("application/json")&&(a="json");let l,h;switch(a){case"arraybuffer":case"blob":h=await r.blob(),l=await hr(h);break;case"json":l=await r.json();break;case"document":case"text":default:l=await r.text()}const d={};return r.headers.forEach((u,p)=>{d[p]=u}),{data:l,headers:d,status:r.status,url:r.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}wi("CapacitorHttp",{web:()=>new fr});class Ce{static instance;maps=new Map;constructor(){}static getInstance(){return Ce.instance||(Ce.instance=new Ce),Ce.instance}async loadAllMaps(){let e=[];try{const s=await fetch("maps/index.json");s.ok?(e=(await s.json()).maps||[],console.log(`Found ${e.length} maps in index`)):(console.warn("maps/index.json not found, using fallback list"),e=["classic","spiral","zigzag"])}catch(s){console.error("Error loading maps index:",s),e=["classic","spiral","zigzag"]}const t=e.map(async s=>{try{const i=await fetch(`maps/${s}.json`);if(!i.ok){console.warn(`Failed to load map: ${s}`);return}const r=await i.json();this.maps.set(s,r),console.log(`Loaded map: ${s}`)}catch(i){console.error(`Error loading map ${s}:`,i)}});await Promise.all(t)}getMap(e){return this.maps.get(e)}getAllMaps(){return Array.from(this.maps.entries()).map(([e,t])=>({id:e,config:t}))}hasMap(e){return this.maps.has(e)}getMapCount(){return this.maps.size}}function st(n){let e;try{e="./"}catch{e=void 0}e||(typeof document<"u"&&document.baseURI?e=document.baseURI:typeof window<"u"&&window.location?e=window.location.href:e="/");try{const t=new URL(e),s=t.pathname||"",i=s.split("/").filter(Boolean),r=i.length?i[i.length-1]:"";!s.endsWith("/")&&r&&!r.includes(".")&&(t.pathname=s+"/");const o=new URL(".",t.toString()).toString();return new URL(n,o).toString()}catch{return typeof e=="string"?e.endsWith("/")?e+n:e+"/"+n:n}}class E{static instance;config;loaded=!1;constructor(){}static getInstance(){return E.instance||(E.instance=new E),E.instance}async load(){if(!this.loaded)try{const e=st("config.json"),t=await fetch(e);if(!t.ok)throw new Error(`Failed to load config: ${t.statusText}`);this.config=await t.json(),this.loaded=!0,console.log("Game configuration loaded successfully")}catch(e){throw console.error("Failed to load game configuration:",e),e}}getConfig(){if(!this.loaded)throw new Error("Configuration not loaded. Call load() first.");return this.config}getTowerConfig(e){return this.config.towers[e]}getEnemyConfig(e){return this.config.enemies[e]}getWaveConfig(){return this.config.waves}getGameConfig(){return this.config.game}getResearchConfig(){return this.config.research}getUpgradeConfig(){return this.config.towerUpgrades}isLoaded(){return this.loaded}isSoundEnabled(){return!!(this.config&&this.config.audio&&this.config.audio.enabled!==!1)}isMusicEnabled(){return!!(this.config&&this.config.audio&&this.config.audio.musicEnabled!==!1)}setSoundEnabled(e){this.config&&(this.config.audio||(this.config.audio={}),this.config.audio.enabled=!!e)}setMusicEnabled(e){this.config&&(this.config.audio||(this.config.audio={}),this.config.audio.musicEnabled=!!e)}}class ie{static instance;storageMode="hybrid";serverUrl=null;storagePrefix="opentd_";constructor(){this.detectStorageMode()}async saveErrorReport(e,t){try{const s=this.getLocal("errorReports")||[];s.push(e),this.setLocal("errorReports",s),(this.storageMode==="hybrid"||this.storageMode==="server")&&t&&await this.saveToServer("errorReports",s,t)}catch(s){console.error("âŒ Failed to save error report:",s)}}getErrorReports(){return this.getLocal("errorReports")||[]}clearErrorReports(){this.removeLocal("errorReports")}static getInstance(){return ie.instance||(ie.instance=new ie),ie.instance}detectStorageMode(){const e=localStorage.getItem(this.storagePrefix+"serverUrl");e?(this.serverUrl=e,this.storageMode="hybrid"):this.storageMode="local",console.log(`ðŸ’¾ Storage mode: ${this.storageMode}`)}setServerUrl(e){this.serverUrl=e,localStorage.setItem(this.storagePrefix+"serverUrl",e),this.storageMode="hybrid",console.log(`ðŸŒ Server URL set: ${e}`)}getServerUrl(){return this.serverUrl}setStorageMode(e){this.storageMode=e,console.log(`ðŸ’¾ Storage mode changed to: ${e}`)}setLocal(e,t){try{const s=JSON.stringify(t);localStorage.setItem(this.storagePrefix+e,s)}catch(s){console.error("âŒ Failed to save to localStorage:",s)}}getLocal(e){try{const t=localStorage.getItem(this.storagePrefix+e);return t===null?null:JSON.parse(t)}catch(t){return console.error("âŒ Failed to read from localStorage:",t),null}}removeLocal(e){localStorage.removeItem(this.storagePrefix+e)}clearLocal(){const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s&&s.startsWith(this.storagePrefix)&&e.push(s)}e.forEach(t=>localStorage.removeItem(t)),console.log("ðŸ—‘ï¸ Local storage cleared")}async saveToServer(e,t,s){if(!this.serverUrl||this.storageMode==="local")return!1;try{const i=st(`${this.serverUrl.replace(/\/$/,"")}/storage/save`);return(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({key:e,value:t})})).ok?(console.log(`â˜ï¸ Saved to server: ${e}`),!0):!1}catch(i){return console.error("âŒ Failed to save to server:",i),!1}}async loadFromServer(e,t){if(!this.serverUrl||this.storageMode==="local")return null;try{const s=st(`${this.serverUrl.replace(/\/$/,"")}/storage/load?key=${encodeURIComponent(e)}`),i=await fetch(s,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(i.ok){const r=await i.json();return console.log(`â˜ï¸ Loaded from server: ${e}`),r.value}return null}catch(s){return console.error("âŒ Failed to load from server:",s),null}}async save(e,t,s){this.setLocal(e,t),(this.storageMode==="hybrid"||this.storageMode==="server")&&s&&await this.saveToServer(e,t,s)}async load(e,t){if((this.storageMode==="hybrid"||this.storageMode==="server")&&t){const s=await this.loadFromServer(e,t);if(s!==null)return this.setLocal(e,s),s}return this.getLocal(e)}async saveGameProgress(e,t){await this.save("gameProgress",e,t)}async loadGameProgress(e){return await this.load("gameProgress",e)}saveSettings(e){this.setLocal("settings",e)}loadSettings(){return this.getLocal("settings")}async updateStatistics(e,t){await this.save("statistics",e,t)}async loadStatistics(e){return await this.load("statistics",e)}async clearAllData(e){if(this.clearLocal(),(this.storageMode==="hybrid"||this.storageMode==="server")&&e){const t=st(`${this.serverUrl.replace(/\/$/,"")}/storage/clear`);await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${e}`}})}}}class ce{static defaultSettings={soundEnabled:!0,musicEnabled:!0,difficulty:"normal",autoRestartOnError:!0,language:"en"};static save(e){ie.getInstance().saveSettings(e)}static load(){const e=ie.getInstance().loadSettings();if(e)try{return{...this.defaultSettings,...e}}catch(t){console.error("Failed to load settings:",t)}return{...this.defaultSettings}}static getSettings(){return this.load()}}const gr={"main.instructions":"Tap anywhere to place. Use the menu for help.","menu.burger":"Menu","menu.close":"Close","menu.source":"Source Code","menu.restart":"Restart","menu.restart_confirm_msg":"Restart? All unsaved data will be lost.","menu.readme_load_failed":"Could not load README content.","menu.readme_fetch_error":"Error fetching README: {{error}}","menu.yes":"Yes","menu.cancel":"Cancel","menu.singleplayer":"Singleplayer","menu.multiplayer":"Multiplayer","menu.options":"Options","menu.credits":"Credits","options.title":"Options","options.sound":"Sound:","options.music":"Music:","options.back":"Back","options.show_reports":"Show error reports","options.must_login_to_view_reports":"Please log in to view error reports.","options.auto_restart":"Auto-restart on error:","options.language":"Language:","auth.login":"LOG IN","auth.register":"REGISTER","auth.username":"Username:","auth.password":"Password:","auth.email_optional":"Email (optional):","auth.fill_fields":"Please fill all fields!","auth.register_success":"Registration successful!","auth.register_failed":"Registration failed","auth.login_success":"Login successful!","auth.login_failed":"Login failed","auth.no_account_register":"No account? Register","auth.already_registered":"Already registered? Log in","auth.guest_skip":"Continue as guest â†’","preloader.loading":"Loading...","main.logout":"Log out","main.restart_overlay_message":"An error occurred. Restarting the game automatically...","admin.title":"Error Reports","admin.loading":"Loading error reports...","admin.not_logged_in":"Not logged in. No reports.","admin.no_reports":"No reports found","admin.load_error":"Failed to load","game.game_over":"Game Over","game.final_wave":"You reached wave {{wave}}!","level.select_map":"Select a map","credits.title":"Credits","credits.close":"Close","game.restart":"Restart","tower.upgrade":`Upgrade Tower
(Choose a tower)`,"tower.upgrade_cost":`Upgrade Tower
Level {{level}} â†’ {{nextLevel}}
Cost: {{cost}}G`,"tower.sell":"Sell","tower.sell_refund":`Sell
{{value}}
({{pct}} refund)`,"tower.info":`{{name}} (Level {{level}})
Damage: {{damage}} | Range: {{range}}`,"tower.name.basic":"Basic Tower","tower.name.fast":"Fast Tower","tower.name.strong":"Strong Tower","tower.name.sniper":"Sniper Tower","tower.name.splash":"Splash Tower","tower.name.frost":"Frost Tower","tower.name.fire":"Fire Tower","notification.level_up":"Level Up!","notification.tower_upgraded":"Tower Upgraded!","notification.tower_sold":"Tower Sold!","notification.research_unlocked":"New research available!","notification.gold_gain":"+{{amount}} Gold","room.create_loading":"Creating room...","room.join_loading":"Joining room...","room.created":"Room created: {{code}}","room.joined":"Joined room: {{code}}","room.error_prefix":"Error: ","room.enter_name":"Please provide a name!","room.enter_code":"Please provide a room code!","room.name_length_error":"Name must be 2-20 characters long!","room.code_format_error":"Room code format: word-word (e.g. bear-lamp)","room.players_not_ready":"Not all players are ready!","room.players_min":"At least 1 player required!","research.title":"Research","research.research_button":"Research","research.no_research":"No researches available","research.hint":"Collect more XP to unlock new researches!","research.cost_fmt":"Cost: {{gold}} Gold | {{xp}} XP","multiplayer.title":"Multiplayer Lobby","multiplayer.connecting":"Connecting to server...","multiplayer.server_unreachable":"âŒ Server unreachable! Start server with: pnpm server","multiplayer.or":"or","multiplayer.player_joined":"{{name}} joined!","multiplayer.player_left":"{{name}} left the room.","multiplayer.starting":"Game starting...","multiplayer.connection_lost":"Connection to server lost!","multiplayer.error_prefix":"Error: "},mr={"main.instructions":"Tippe irgendwo, um zu platzieren. Benutze das MenÃ¼ fÃ¼r Hilfe.","menu.burger":"MenÃ¼","menu.close":"SchlieÃŸen","menu.source":"Quellcode","menu.restart":"Neustarten","menu.restart_confirm_msg":"Neustarten? Alle nicht gespeicherten Daten gehen verloren.","menu.readme_load_failed":"README-Inhalt konnte nicht geladen werden.","menu.readme_fetch_error":"Fehler beim Laden von README: {{error}}","menu.yes":"Ja","menu.cancel":"Abbrechen","menu.singleplayer":"Singleplayer","menu.multiplayer":"Multiplayer","menu.options":"Options","menu.credits":"Credits","options.title":"Optionen","options.sound":"Sound:","options.music":"Musik:","options.back":"ZurÃ¼ck","options.show_reports":"Fehlerberichte anzeigen","options.must_login_to_view_reports":"Bitte einloggen, um Fehlerberichte anzuzeigen.","options.auto_restart":"Auto-Restart bei Fehlern:","options.language":"Sprache:","auth.login":"ANMELDEN","auth.register":"REGISTRIEREN","auth.username":"Benutzername:","auth.password":"Passwort:","auth.email_optional":"E-Mail (optional):","auth.fill_fields":"Bitte alle Felder ausfÃ¼llen!","auth.register_success":"Registrierung erfolgreich!","auth.register_failed":"Registrierung fehlgeschlagen","auth.login_success":"Anmeldung erfolgreich!","auth.login_failed":"Anmeldung fehlgeschlagen","auth.no_account_register":"Noch kein Account? Registrieren","auth.already_registered":"Bereits registriert? Anmelden","auth.guest_skip":"Als Gast fortfahren â†’","preloader.loading":"LÃ¤dt...","main.logout":"Abmelden","main.restart_overlay_message":"Ein Fehler ist aufgetreten. Das Spiel wird automatisch neu gestartet...","admin.title":"Fehlerberichte","admin.loading":"Lade Fehlerberichte...","admin.not_logged_in":"Nicht eingeloggt. Keine Berichte.","admin.no_reports":"Keine Berichte gefunden","admin.load_error":"Fehler beim Laden","game.game_over":"Game Over","game.final_wave":"Du hast Welle {{wave}} erreicht!","level.select_map":"WÃ¤hle eine Karte","credits.title":"Credits","credits.close":"SchlieÃŸen","game.restart":"Neustart","tower.upgrade":`Upgrade-Turm
(WÃ¤hle einen Turm)`,"tower.upgrade_cost":`Upgrade Turm
Level {{level}} â†’ {{nextLevel}}
Kosten: {{cost}}G`,"tower.sell":"Verkaufen","tower.sell_refund":`Verkaufen
{{value}}
({{pct}} zurÃ¼ck)`,"tower.info":`{{name}} (Level {{level}})
Schaden: {{damage}} | Reichweite: {{range}}`,"tower.name.basic":"Basis-Turm","tower.name.fast":"Schnell-Turm","tower.name.strong":"Stark-Turm","tower.name.sniper":"Sniper-Turm","tower.name.splash":"Splash-Turm","tower.name.frost":"Frost-Turm","tower.name.fire":"Feuer-Turm","notification.level_up":"Level Up!","notification.tower_upgraded":"Turm Verbessert!","notification.tower_sold":"Turm Verkauft!","notification.research_unlocked":"Neue Forschung verfÃ¼gbar!","notification.gold_gain":"+{{amount}} Gold","room.create_loading":"Raum wird erstellt...","room.join_loading":"Trete Raum bei...","room.created":"Raum erstellt: {{code}}","room.joined":"Raum beigetreten: {{code}}","room.error_prefix":"Fehler: ","room.enter_name":"Bitte gib einen Namen ein!","room.enter_code":"Bitte gib einen Raum-Code ein!","room.name_length_error":"Name muss 2-20 Zeichen lang sein!","room.code_format_error":"Raum-Code Format: wort-wort (z.B. bear-lamp)","room.players_not_ready":"Nicht alle Spieler sind bereit!","room.players_min":"Mindestens 1 Spieler benÃ¶tigt!","research.title":"Forschung","research.research_button":"Erforschen","research.no_research":"Keine Forschungen verfÃ¼gbar","research.hint":"Sammle mehr XP, um neue Forschungen freizuschalten!","research.cost_fmt":"Kosten: {{gold}} Gold | {{xp}} XP","multiplayer.title":"Multiplayer Lobby","multiplayer.connecting":"Verbinde mit Server...","multiplayer.server_unreachable":"âŒ Server nicht erreichbar! Starte Server mit: pnpm server","multiplayer.or":"oder","multiplayer.player_joined":"{{name}} ist beigetreten!","multiplayer.player_left":"{{name}} hat den Raum verlassen.","multiplayer.starting":"Spiel startet...","multiplayer.connection_lost":"Verbindung zum Server verloren!","multiplayer.error_prefix":"Fehler: "},yr={"main.instructions":"Touchez n'importe oÃ¹ pour placer. Utilisez le menu pour obtenir de l'aide.","menu.burger":"Menu","menu.close":"Fermer","menu.source":"Code source","menu.restart":"RedÃ©marrer","menu.restart_confirm_msg":"RedÃ©marrer ? Toutes les donnÃ©es non enregistrÃ©es seront perdues.","menu.readme_load_failed":"Impossible de charger le contenu README.","menu.readme_fetch_error":"Erreur lors du chargement du README: {{error}}","menu.yes":"Oui","menu.cancel":"Annuler","menu.singleplayer":"Solo","menu.multiplayer":"Multijoueur","menu.options":"Options","menu.credits":"CrÃ©dits","options.title":"Options","options.sound":"Son :","options.music":"Musique :","options.back":"Retour","options.show_reports":"Afficher les rapports d'erreur","options.must_login_to_view_reports":"Veuillez vous connecter pour afficher les rapports d'erreur.","options.auto_restart":"RedÃ©marrage automatique en cas d'erreur :","options.language":"Langue :","auth.login":"CONNEXION","auth.register":"S'INSCRIRE","auth.username":"Nom d'utilisateur:","auth.password":"Mot de passe :","auth.email_optional":"E-mail (optionnel) :","auth.fill_fields":"Veuillez remplir tous les champs !","auth.register_success":"Inscription rÃ©ussie !","auth.register_failed":"Ã‰chec de l'inscription","auth.login_success":"Connexion rÃ©ussie !","auth.login_failed":"Ã‰chec de la connexion","auth.no_account_register":"Pas de compte ? S'inscrire","auth.already_registered":"DÃ©jÃ  inscrit ? Connectez-vous","auth.guest_skip":"Continuer en tant qu'invitÃ© â†’","preloader.loading":"Chargement...","main.logout":"DÃ©connexion","main.restart_overlay_message":"Une erreur est survenue. RedÃ©marrage automatique du jeu...","admin.title":"Rapports d'erreur","admin.loading":"Chargement des rapports d'erreur...","admin.not_logged_in":"Non connectÃ©. Aucun rapport.","admin.no_reports":"Aucun rapport trouvÃ©","admin.load_error":"Ã‰chec du chargement","game.game_over":"Game Over","game.final_wave":"Vous avez atteint la vague {{wave}} !","level.select_map":"SÃ©lectionnez une carte","credits.title":"CrÃ©dits","credits.close":"Fermer","game.restart":"RedÃ©marrer","tower.upgrade":`AmÃ©liorer la tour
(Choisissez une tour)`,"tower.upgrade_cost":`AmÃ©liorer la tour
Niveau {{level}} â†’ {{nextLevel}}
CoÃ»t : {{cost}}G`,"tower.sell":"Vendre","tower.sell_refund":`Vendre
{{value}}
({{pct}} de remboursement)`,"tower.info":`{{name}} (Niveau {{level}})
DÃ©gÃ¢ts : {{damage}} | PortÃ©e : {{range}}`,"tower.name.basic":"Tour basique","tower.name.fast":"Tour rapide","tower.name.strong":"Tour puissante","tower.name.sniper":"Tour Sniper","tower.name.splash":"Tour Splash","tower.name.frost":"Tour Gel","tower.name.fire":"Tour Feu","notification.level_up":"Level Up!","notification.tower_upgraded":"Tour amÃ©liorÃ©e !","notification.tower_sold":"Tour vendue !","notification.research_unlocked":"Nouvelle recherche disponible !","notification.gold_gain":"+{{amount}} Gold","room.create_loading":"CrÃ©ation de la salle...","room.join_loading":"Rejoindre la salle...","room.created":"Salle crÃ©Ã©e : {{code}}","room.joined":"Rejoint la salle : {{code}}","room.error_prefix":"Erreur : ","room.enter_name":"Veuillez fournir un nom !","room.enter_code":"Veuillez fournir un code de salle !","room.name_length_error":"Le nom doit contenir entre 2 et 20 caractÃ¨res !","room.code_format_error":"Format du code de salle : mot-mot (ex: bear-lamp)","room.players_not_ready":"Tous les joueurs ne sont pas prÃªts !","room.players_min":"Au moins 1 joueur requis !","research.title":"Recherche","research.research_button":"Rechercher","research.no_research":"Aucune recherche disponible","research.hint":"Collectez plus d'XP pour dÃ©bloquer de nouvelles recherches !","research.cost_fmt":"CoÃ»t : {{gold}} Gold | {{xp}} XP","multiplayer.title":"Lobby Multijoueur","multiplayer.connecting":"Connexion au serveur...","multiplayer.server_unreachable":"âŒ Serveur inaccessible ! DÃ©marrez le serveur avec : pnpm server","multiplayer.or":"ou","multiplayer.player_joined":"{{name}} a rejoint !","multiplayer.player_left":"{{name}} a quittÃ© la salle.","multiplayer.starting":"DÃ©marrage du jeu...","multiplayer.connection_lost":"Connexion au serveur perdue !","multiplayer.error_prefix":"Erreur: "},wr={"main.instructions":"Toca en cualquier lugar para colocar. Usa el menÃº para ayuda.","menu.burger":"MenÃº","menu.close":"Cerrar","menu.source":"CÃ³digo fuente","menu.restart":"Reiniciar","menu.restart_confirm_msg":"Â¿Reiniciar? Todos los datos no guardados se perderÃ¡n.","menu.readme_load_failed":"No se pudo cargar el contenido del README.","menu.readme_fetch_error":"Error al obtener README: {{error}}","menu.yes":"SÃ­","menu.cancel":"Cancelar","menu.singleplayer":"Singleplayer","menu.multiplayer":"Multijugador","menu.options":"Opciones","menu.credits":"CrÃ©ditos","options.title":"Opciones","options.sound":"Sonido:","options.music":"MÃºsica:","options.back":"Volver","options.show_reports":"Mostrar informes de errores","options.must_login_to_view_reports":"Por favor inicie sesiÃ³n para ver los informes de errores.","options.auto_restart":"Reinicio automÃ¡tico ante errores:","options.language":"Idioma:","auth.login":"INICIAR SESIÃ“N","auth.register":"REGISTRARSE","auth.username":"Nombre de usuario:","auth.password":"ContraseÃ±a:","auth.email_optional":"Correo electrÃ³nico (opcional):","auth.fill_fields":"Â¡Por favor rellene todos los campos!","auth.register_success":"Â¡Registro correcto!","auth.register_failed":"Registro fallido","auth.login_success":"Â¡Inicio de sesiÃ³n correcto!","auth.login_failed":"Error de inicio de sesiÃ³n","auth.no_account_register":"Â¿Sin cuenta? Registrarse","auth.already_registered":"Â¿Ya registrado? Iniciar sesiÃ³n","auth.guest_skip":"Continuar como invitado â†’","preloader.loading":"Cargando...","main.logout":"Cerrar sesiÃ³n","main.restart_overlay_message":"OcurriÃ³ un error. Reiniciando el juego automÃ¡ticamente...","admin.title":"Informes de errores","admin.loading":"Cargando informes de errores...","admin.not_logged_in":"No ha iniciado sesiÃ³n. Sin informes.","admin.no_reports":"No se encontraron informes","admin.load_error":"Error al cargar","game.game_over":"Game Over","game.final_wave":"Â¡Has alcanzado la ola {{wave}}!","level.select_map":"Selecciona un mapa","credits.title":"CrÃ©ditos","credits.close":"Cerrar","game.restart":"Reiniciar","tower.upgrade":`Mejorar Torre
(Elige una torre)`,"tower.upgrade_cost":`Mejorar Torre
Nivel {{level}} â†’ {{nextLevel}}
Costo: {{cost}}G`,"tower.sell":"Vender","tower.sell_refund":`Vender
{{value}}
({{pct}} de reembolso)`,"tower.info":`{{name}} (Nivel {{level}})
DaÃ±o: {{damage}} | Alcance: {{range}}`,"tower.name.basic":"Torre BÃ¡sica","tower.name.fast":"Torre RÃ¡pida","tower.name.strong":"Torre Fuerte","tower.name.sniper":"Torre Francotirador","tower.name.splash":"Torre Splash","tower.name.frost":"Torre Escarcha","tower.name.fire":"Torre de Fuego","notification.level_up":"Â¡Subiste de nivel!","notification.tower_upgraded":"Â¡Torre mejorada!","notification.tower_sold":"Â¡Torre vendida!","notification.research_unlocked":"Â¡Nueva investigaciÃ³n disponible!","notification.gold_gain":"+{{amount}} Oro","room.create_loading":"Creando sala...","room.join_loading":"UniÃ©ndose a la sala...","room.created":"Sala creada: {{code}}","room.joined":"Sala unida: {{code}}","room.error_prefix":"Error: ","room.enter_name":"Por favor, indique un nombre!","room.enter_code":"Por favor, indique un cÃ³digo de sala!","room.name_length_error":"Â¡El nombre debe tener entre 2 y 20 caracteres!","room.code_format_error":"Formato de cÃ³digo de sala: palabra-palabra (ej. bear-lamp)","room.players_not_ready":"Â¡No todos los jugadores estÃ¡n listos!","room.players_min":"Â¡Se requiere al menos 1 jugador!","research.title":"InvestigaciÃ³n","research.research_button":"Investigar","research.no_research":"No hay investigaciones disponibles","research.hint":"Â¡Recolecta mÃ¡s XP para desbloquear nuevas investigaciones!","research.cost_fmt":"Costo: {{gold}} Oro | {{xp}} XP","multiplayer.title":"Sala multijugador","multiplayer.connecting":"Conectando al servidor...","multiplayer.server_unreachable":"âŒ Â¡Servidor inalcanzable! Inicia el servidor con: pnpm server","multiplayer.or":"o","multiplayer.player_joined":"Â¡{{name}} se ha unido!","multiplayer.player_left":"Â¡{{name}} ha salido de la sala!","multiplayer.starting":"Iniciando partida...","multiplayer.connection_lost":"Â¡ConexiÃ³n al servidor perdida!","multiplayer.error_prefix":"Error: "},Si=["en","de","fr","es"],Xt={en:gr,de:mr,fr:yr,es:wr};let nt="en";const br=new EventTarget;function Sr(){try{const n=ce.load(),e=n&&n.language||navigator?.language||"en",t=typeof e=="string"&&e.split("-")[0]||"en";if(Si.includes(t))return t}catch{}return"en"}nt=Sr();function vi(){return nt}function xi(n){if(nt!==n){nt=n;try{const e=ce.load();e.language=n,ce.save(e)}catch{}br.dispatchEvent(new CustomEvent("languagechange",{detail:{lang:n}}))}}function f(n,e){let s=(Xt[nt]||Xt.en)[n]||Xt.en[n]||n;return e&&Object.keys(e).forEach(i=>{s=s.replace(new RegExp(`{{s*${i}s*}}`,"g"),String(e[i]))}),s}function ki(){const n={en:"English",de:"Deutsch",fr:"FranÃ§ais",es:"EspaÃ±ol"};return Si.map(e=>({code:e,label:n[e]}))}class vr extends Phaser.Scene{particles;mapRegistry;constructor(){super({key:"PreloaderScene"}),this.mapRegistry=Ce.getInstance()}preload(){const e=this.cameras.main.width,t=this.cameras.main.height,s=this.add.graphics();s.fillGradientStyle(657930,657930,1710638,1710638,1),s.fillRect(0,0,e,t),this.particles=[];for(let b=0;b<20;b++){const T=this.add.graphics();T.fillStyle(65280,.3),T.fillCircle(0,0,Math.random()*3+1),T.x=Math.random()*e,T.y=Math.random()*t,this.particles.push(T),this.tweens.add({targets:T,y:T.y+Math.random()*200-100,x:T.x+Math.random()*100-50,alpha:{from:.3,to:0},duration:2e3+Math.random()*1e3,repeat:-1,yoyo:!0})}const i=this.add.text(e/2,t/3,"OPEN TD",{font:"bold 72px Arial",color:"#00ff00"});i.setOrigin(.5),i.setStroke("#003300",8),this.tweens.add({targets:i,scale:{from:1,to:1.05},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"});const r=this.add.text(e/2,t/3+60,"Tower Defense",{font:"24px Arial",color:"#00aa00"});r.setOrigin(.5),r.setAlpha(0),this.tweens.add({targets:r,alpha:1,duration:800,delay:300});const o=this.add.graphics();o.lineStyle(3,65280,.8),o.strokeRoundedRect(e/2-165,t/2+50,330,40,10),o.fillStyle(0,.5),o.fillRoundedRect(e/2-165,t/2+50,330,40,10);const a=this.add.graphics(),l=this.add.text(e/2,t/2+20,f("preloader.loading"),{font:"20px Arial",color:"#00ff00"});l.setOrigin(.5);let h=0;const d=f("preloader.loading");this.time.addEvent({delay:500,callback:()=>{h=(h+1)%4,l.setText(d+".".repeat(h))},loop:!0});const u=this.add.text(e/2,t/2+70,"0%",{font:"bold 20px Arial",color:"#ffffff"});u.setOrigin(.5),this.load.on("progress",b=>{a.clear(),a.fillGradientStyle(65280,65280,43520,43520,1),a.fillRoundedRect(e/2-160,t/2+55,320*b,30,8),a.lineStyle(2,65280,.5),a.strokeRoundedRect(e/2-160,t/2+55,320*b,30,8),u.setText(`${Math.floor(b*100)}%`),this.tweens.add({targets:u,scale:{from:1,to:1.1},duration:100,yoyo:!0})});const p=E.getInstance();(p.isLoaded()?p.isSoundEnabled():!1)&&(this.load.audio("click","assets/sounds/click.mp3"),this.load.audio("music","assets/music/menu.mp3"),this.load.audio("tower_basic","assets/sounds/tower_basic.mp3"),this.load.audio("tower_fast","assets/sounds/tower_fast.mp3"),this.load.audio("tower_fire","assets/sounds/tower_fire.mp3"),this.load.audio("tower_frost","assets/sounds/tower_frost.mp3"),this.load.audio("tower_sniper","assets/sounds/tower_sniper.mp3"),this.load.audio("tower_splash","assets/sounds/tower_splash.mp3"),this.load.audio("tower_strong","assets/sounds/tower_strong.mp3")),this.load.once("complete",()=>{this.time.delayedCall(800,()=>{this.tweens.add({targets:[a,o,l,u,i,r],alpha:0,duration:500}),this.particles.forEach(b=>{this.tweens.add({targets:b,alpha:0,duration:500})})})})}async create(){if(console.log("Loading maps..."),await this.mapRegistry.loadAllMaps(),console.log(`Loaded ${this.mapRegistry.getMapCount()} maps`),this.load.totalToLoad===0){let e=0;const t=setInterval(()=>{e+=.1,e>=1&&(e=1,clearInterval(t),this.load.emit("complete"),this.time.delayedCall(1500,()=>{this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("LoginScene")})})),this.load.emit("progress",e)},100)}else this.load.once("complete",()=>{this.time.delayedCall(1500,()=>{this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("LoginScene")})})})}}class ge{static instance;currentUser=null;authToken=null;persistence;constructor(){this.persistence=ie.getInstance(),this.loadSession()}static getInstance(){return ge.instance||(ge.instance=new ge),ge.instance}loadSession(){const e=this.persistence.getLocal("authToken"),t=this.persistence.getLocal("currentUser");e&&t&&(this.authToken=e,this.currentUser=t,console.log("âœ… Session restored:",t.username))}saveSession(){this.authToken&&this.currentUser&&(this.persistence.setLocal("authToken",this.authToken),this.persistence.setLocal("currentUser",this.currentUser))}async register(e,t,s){try{const o=this.persistence.getServerUrl();if(o){const a=await fetch(`${o}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t,email:s})});if(a.ok){const l=await a.json();return this.authToken=l.token,this.currentUser=l.user,this.saveSession(),console.log("âœ… Registered on server:",e),{success:!0,user:l.user,token:l.token}}}}catch{console.log("âš ï¸ Server registration failed, using local storage")}const i=this.persistence.getLocal("users")||{};if(i[e])return{success:!1,message:"Benutzername bereits vergeben"};const r={userId:this.generateUserId(),username:e,email:s,level:1,xp:0,createdAt:new Date().toISOString(),lastLogin:new Date().toISOString(),passwordHash:await this.hashPassword(t)};return i[e]={...r},this.persistence.setLocal("users",i),this.authToken=this.generateToken(r.userId),this.currentUser=r,this.saveSession(),console.log("âœ… Registered locally:",e),{success:!0,user:r,token:this.authToken}}async login(e,t){try{const r=this.persistence.getServerUrl();if(r){const o=await fetch(`${r}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(o.ok){const a=await o.json();return this.authToken=a.token,this.currentUser=a.user,this.currentUser&&(this.currentUser.lastLogin=new Date().toISOString()),this.saveSession(),console.log("âœ… Logged in via server:",e),{success:!0,user:a.user,token:a.token}}}}catch{console.log("âš ï¸ Server login failed, using local storage")}const s=this.persistence.getLocal("users")||{},i=s[e];return i?i.passwordHash!==await this.hashPassword(t)?{success:!1,message:"Falsches Passwort"}:(i.lastLogin=new Date().toISOString(),s[e]=i,this.persistence.setLocal("users",s),this.authToken=this.generateToken(i.userId),this.currentUser={userId:i.userId,username:i.username,email:i.email,level:i.level,xp:i.xp,createdAt:i.createdAt,lastLogin:i.lastLogin,passwordHash:i.passwordHash},this.saveSession(),console.log("âœ… Logged in locally:",e),{success:!0,user:this.currentUser,token:this.authToken}):{success:!1,message:"Benutzer nicht gefunden"}}logout(){this.currentUser=null,this.authToken=null,this.persistence.removeLocal("authToken"),this.persistence.removeLocal("currentUser"),console.log("ðŸ‘‹ Logged out")}isLoggedIn(){return this.currentUser!==null&&this.authToken!==null}getCurrentUser(){return this.currentUser}getAuthToken(){return this.authToken}async updateUserProgress(e,t){if(!this.currentUser)return;this.currentUser.xp+=e,t&&this.currentUser.level&&(this.currentUser.level+=1),this.saveSession();try{const i=this.persistence.getServerUrl();i&&this.authToken&&await fetch(`${i}/auth/progress`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.authToken}`},body:JSON.stringify({xp:this.currentUser.xp,level:this.currentUser.level})})}catch{console.log("âš ï¸ Could not sync progress with server")}const s=this.persistence.getLocal("users")||{};s[this.currentUser.username]&&(s[this.currentUser.username].xp=this.currentUser.xp,s[this.currentUser.username].level=this.currentUser.level,this.persistence.setLocal("users",s))}generateUserId(){return"user_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}generateToken(e){return btoa(e+":"+Date.now()+":"+Math.random().toString(36).substr(2,16))}async hashPassword(e){let t=this.persistence.getLocal("passwordSalt");if(!t){const l=new Uint8Array(128);crypto.getRandomValues(l),t=btoa(String.fromCharCode(...l)),this.persistence.setLocal("passwordSalt",t)}const s=new TextEncoder,i=await crypto.subtle.importKey("raw",s.encode(e),"PBKDF2",!1,["deriveBits"]),r=new Uint8Array([...atob(t)].map(l=>l.charCodeAt(0))),o=await crypto.subtle.deriveBits({name:"PBKDF2",salt:r,iterations:1e3,hash:"SHA-512"},i,512),a=new Uint8Array(o);return Array.from(a,l=>l.toString(16).padStart(2,"0")).join("")}}class Ti{constructor(e){this.scene=e}createGradientBackground(e,t){const s=this.scene.add.graphics();s.fillGradientStyle(657930,657930,1451079,2048104,1),s.fillRect(0,0,e,t)}createParticles(e,t,s=30){for(let i=0;i<s;i++){const r=this.scene.add.graphics();r.fillStyle(65280,.1+Math.random()*.2),r.fillCircle(0,0,Math.random()*4+2),r.x=Math.random()*e,r.y=Math.random()*t,this.scene.tweens.add({targets:r,y:r.y+Math.random()*300-150,x:r.x+Math.random()*200-100,alpha:{from:r.alpha,to:0},scale:{from:1,to:0},duration:3e3+Math.random()*2e3,repeat:-1,delay:Math.random()*2e3})}}}class xr extends Phaser.Scene{authManager;isRegistering=!1;constructor(){super({key:"LoginScene"}),this.authManager=ge.getInstance()}create(){const e=this.cameras.main.width,t=this.cameras.main.height;if(this.authManager.isLoggedIn()){console.log("Already logged in, going to main menu"),this.scene.start("MainMenuScene");return}this.cameras.main.fadeIn(500);const s=new Ti(this);s.createGradientBackground(e,t),s.createParticles(e,t,20);const i=this.add.text(e/2,120,"OPEN TD",{fontSize:"64px",fontFamily:"Arial Black",color:"#ffffff",stroke:"#000000",strokeThickness:6});i.setOrigin(.5),i.setAlpha(0),this.tweens.add({targets:i,alpha:1,scale:{from:.8,to:1},duration:800,ease:"Back.easeOut"}),this.createLoginForm(e,t)}createLoginForm(e,t){const s=e/2,i=t/2-80,r=this.add.graphics();r.fillStyle(0,.7),r.fillRoundedRect(s-200,i-40,400,380,15),r.lineStyle(3,65280,.8),r.strokeRoundedRect(s-200,i-40,400,380,15);const o=this.add.text(s,i,f("auth.login"),{fontSize:"32px",fontFamily:"Arial",color:"#00ff00"});o.setOrigin(.5),this.add.text(s-150,i+60,f("auth.username"),{fontSize:"18px",color:"#ffffff"});const a=this.createInput(s-150,i+90,300,"username");this.add.text(s-150,i+140,f("auth.password"),{fontSize:"18px",color:"#ffffff"});const l=this.createInput(s-150,i+170,300,"password"),h=this.add.text(s-150,i+220,f("auth.email_optional"),{fontSize:"18px",color:"#ffffff"});h.setVisible(!1);const d=this.createInput(s-150,i+250,300,"email");d.style.display="none";const u=this.add.text(s,i+290,f("auth.login"),{fontSize:"24px",fontFamily:"Arial",color:"#ffffff",backgroundColor:"#00aa00",padding:{x:30,y:10}});u.setOrigin(.5),u.setInteractive({useHandCursor:!0}),u.on("pointerover",()=>{u.setStyle({backgroundColor:"#00ff00"})}),u.on("pointerout",()=>{u.setStyle({backgroundColor:"#00aa00"})}),u.on("pointerdown",async()=>{const b=a.value.trim(),T=l.value.trim(),L=d.value.trim();if(!b||!T){this.showMessage(f("auth.fill_fields"),"#ff0000");return}if(u.disableInteractive(),this.isRegistering){const k=await this.authManager.register(b,T,L||void 0);k.success?(this.showMessage(f("auth.register_success"),"#00ff00"),this.time.delayedCall(1e3,()=>{this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})})):(this.showMessage(k.message||f("auth.register_failed"),"#ff0000"),u.setInteractive())}else{const k=await this.authManager.login(b,T);k.success?(this.showMessage(f("auth.login_success"),"#00ff00"),this.time.delayedCall(1e3,()=>{this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})})):(this.showMessage(k.message||f("auth.login_failed"),"#ff0000"),u.setInteractive())}});const p=this.add.text(s,i+270,f("auth.no_account_register"),{fontSize:"16px",color:"#aaaaaa"});p.setOrigin(.5),p.setInteractive({useHandCursor:!0}),p.on("pointerover",()=>{p.setStyle({color:"#ffffff"})}),p.on("pointerout",()=>{p.setStyle({color:"#aaaaaa"})}),p.on("pointerdown",()=>{this.isRegistering=!this.isRegistering,this.isRegistering?(o.setText(f("auth.register")),u.setText(f("auth.register")),p.setText(f("auth.already_registered")),h.setVisible(!0),d.style.display="block"):(o.setText(f("auth.login")),u.setText(f("auth.login")),p.setText(f("auth.no_account_register")),h.setVisible(!1),d.style.display="none")});const g=this.add.text(e-20,t-20,f("auth.guest_skip"),{fontSize:"14px",color:"#666666"});g.setOrigin(1,1),g.setInteractive({useHandCursor:!0}),g.on("pointerover",()=>{g.setStyle({color:"#aaaaaa"})}),g.on("pointerout",()=>{g.setStyle({color:"#666666"})}),g.on("pointerdown",()=>{this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})})}createInput(e,t,s,i){const r=document.createElement("input");r.type=i==="password"?"password":i==="email"?"email":"text",r.placeholder=f(i==="username"?"auth.username":i==="password"?"auth.password":"auth.email_optional"),r.style.position="absolute",r.style.width=s+"px",r.style.height="35px",r.style.fontSize="16px",r.style.padding="5px 10px",r.style.backgroundColor="#333333",r.style.color="#ffffff",r.style.border="2px solid #00aa00",r.style.borderRadius="5px",r.style.outline="none",r.style.fontFamily="Arial",r.style.boxSizing="border-box";const a=this.game.canvas.getBoundingClientRect(),l=a.width/this.cameras.main.width,h=a.height/this.cameras.main.height;return r.style.left=a.left+e*l+"px",r.style.top=a.top+t*h+"px",r.style.width=s*l+"px",r.style.height=35*h+"px",document.body.appendChild(r),this.events.once("shutdown",()=>{r.remove()}),r}showMessage(e,t){const s=this.cameras.main.width,i=this.cameras.main.height,r=this.add.text(s/2,i/2+200,e,{fontSize:"20px",color:t,backgroundColor:"#000000",padding:{x:20,y:10}});r.setOrigin(.5),r.setAlpha(0),this.tweens.add({targets:r,alpha:1,duration:300}),this.time.delayedCall(3e3,()=>{this.tweens.add({targets:r,alpha:0,duration:300,onComplete:()=>r.destroy()})})}}class kr{constructor(e){this.scene=e}createAnimatedTitle(e,t,s,i){const r=this.scene.add.text(e,t-20,s,{font:"bold 80px Arial",color:"#00ff00"});if(r.setOrigin(.5),r.setStroke("#003300",10),r.setShadow(0,0,"#00ff00",20,!1,!0),r.setScale(0),r.setAlpha(0),this.scene.tweens.add({targets:r,scale:1,alpha:1,duration:800,ease:"Back.easeOut"}),this.scene.tweens.add({targets:r,scale:{from:1,to:1.05},duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),i){const o=this.scene.add.text(e,t+70,"",{font:"28px Arial",color:"#00cc00"});o.setOrigin(.5);let a=0;this.scene.time.addEvent({delay:100,callback:()=>{a<i.length&&(o.setText(i.substring(0,a+1)),a++)},repeat:i.length-1})}}}class Tr{constructor(e){this.scene=e}lightenColor(e,t){const s=parseInt(e.replace("#",""),16),i=Math.round(2.55*t),r=Math.min(255,(s>>16&255)+i),o=Math.min(255,(s>>8&255)+i),a=Math.min(255,(s&255)+i);return"#"+((1<<24)+(r<<16)+(o<<8)+a).toString(16).slice(1)}createButton(e,t,s,i,r){const o=this.scene.add.text(e,t,s,{font:"bold 28px Arial",color:"#ffffff",backgroundColor:i,padding:{x:30,y:12}});return o.setOrigin(.5),o.setInteractive({useHandCursor:!0}),o.on("pointerover",()=>{o.setScale(1.1),o.setStyle({backgroundColor:this.lightenColor(i,30),shadow:{blur:15,color:i,fill:!0}}),this.scene.tweens.add({targets:o,scale:1.1,duration:200,ease:"Back.easeOut"})}),o.on("pointerout",()=>{o.setStyle({backgroundColor:i,shadow:{blur:0,color:"#000000",fill:!1}}),this.scene.tweens.add({targets:o,scale:1,duration:200})}),o.on("pointerdown",()=>{this.scene.tweens.add({targets:o,scale:.95,duration:100,yoyo:!0,onComplete:r})}),o}createMainMenuButtons(e,t,s,i){const r=this.createButton(e,t,f("menu.singleplayer"),"#00aa00",i.onSingleplayer),o=this.createButton(e,t+s,f("menu.multiplayer"),"#e67e22",i.onMultiplayer),a=this.createButton(e,t+s*2,f("menu.options"),"#0066cc",i.onOptions),l=this.createButton(e,t+s*3,f("menu.credits"),"#666666",i.onCredits);return[r,o,a,l]}animateButtonsEntrance(e,t=800){e.forEach((s,i)=>{s.setAlpha(0),s.setY(s.y+50),this.scene.tweens.add({targets:s,alpha:1,y:s.y-50,duration:500,delay:t+i*150,ease:"Back.easeOut"})})}}class _r{constructor(e){this.scene=e,this.mapRegistry=Ce.getInstance()}elements=[];mapRegistry;show(e,t,s,i){const r=e/2,o=t/2,a=this.scene.add.rectangle(0,0,e,t,0,.8);a.setOrigin(0),a.setInteractive();const l=this.mapRegistry.getAllMaps(),h=Math.min(700,200+l.length*220),u=this.scene.add.rectangle(r,o,h,400,1710638);u.setStrokeStyle(3,65280);const p=this.scene.add.text(r,o-150,f("level.select_map"),{font:"bold 32px Arial",color:"#00ff00"});p.setOrigin(.5),this.elements=[a,u,p];const g=l.map((_,D)=>{const S=["#0088ff","#ff8800","#8800ff","#00ff88","#ff0088","#88ff00"];return{id:_.id,name:_.config.name,description:_.config.description,color:S[D%S.length]}}),b=180,T=220,L=r-(g.length-1)*T/2;g.forEach((_,D)=>{const S=L+D*T,U=o-20,P=this.scene.add.rectangle(S,U,b,120,2969622);P.setStrokeStyle(3,parseInt(_.color.replace("#","0x"))),P.setInteractive({useHandCursor:!0});const M=this.scene.add.text(S,U-10,_.name,{font:"bold 20px Arial",color:_.color});M.setOrigin(.5);const N=this.scene.add.text(S,U+20,_.description,{font:"14px Arial",color:"#cccccc",align:"center",wordWrap:{width:b-20}});N.setOrigin(.5),P.on("pointerover",()=>{P.setFillStyle(4022310),this.scene.tweens.add({targets:P,scaleX:1.05,scaleY:1.05,duration:200})}),P.on("pointerout",()=>{P.setFillStyle(2969622),this.scene.tweens.add({targets:P,scaleX:1,scaleY:1,duration:200})}),P.on("pointerdown",()=>{s(_.id)}),this.elements.push(P,M,N)});const k=this.scene.add.text(r,o+140,f("options.back"),{font:"bold 20px Arial",color:"#ffffff",backgroundColor:"#666666",padding:{x:20,y:8}});k.setOrigin(.5),k.setInteractive({useHandCursor:!0}),k.on("pointerover",()=>{k.setStyle({backgroundColor:"#888888"})}),k.on("pointerout",()=>{k.setStyle({backgroundColor:"#666666"})}),k.on("pointerdown",()=>{this.hide(),i()}),this.elements.push(k),this.elements.forEach((_,D)=>{"setAlpha"in _&&_.setAlpha(0),this.scene.tweens.add({targets:_,alpha:1,duration:300,delay:D*30})})}hide(){this.elements.forEach(e=>{this.scene.tweens.add({targets:e,alpha:0,duration:300,onComplete:()=>e.destroy()})}),this.elements=[]}}class Cr{constructor(e){this.scene=e}elements=[];show(e,t,s){const i=e/2,r=t/2,o=this.scene.add.rectangle(0,0,e,t,0,.8);o.setOrigin(0),o.setInteractive();const a=this.scene.add.rectangle(i,r,500,300,1710638);a.setStrokeStyle(3,65280);const l=this.scene.add.text(i,r-100,f("credits.title"),{font:"bold 32px Arial",color:"#00ff00"});l.setOrigin(.5);const h=this.scene.add.text(i,r-20,`Entwickelt mit Phaser 3

Game Engine: Phaser.io
Build Tool: Vite
Mobile: Capacitor

Ein Open Source Projekt`,{font:"18px Arial",color:"#ffffff",align:"center"});h.setOrigin(.5);const d=this.scene.add.text(i,r+110,f("credits.close"),{font:"bold 20px Arial",color:"#ffffff",backgroundColor:"#00aa00",padding:{x:20,y:8}});d.setOrigin(.5),d.setInteractive({useHandCursor:!0}),d.on("pointerdown",()=>{this.hide(),s()}),this.elements=[o,a,l,h,d],this.elements.forEach(u=>{"setAlpha"in u&&u.setAlpha(0),this.scene.tweens.add({targets:u,alpha:1,duration:300})})}hide(){this.elements.forEach(e=>{this.scene.tweens.add({targets:e,alpha:0,duration:300,onComplete:()=>e.destroy()})}),this.elements=[]}}class Rr extends Phaser.Scene{levelSelection;creditsOverlay;authManager;constructor(){super({key:"MainMenuScene"}),this.authManager=ge.getInstance()}create(){const e=this.cameras.main.width,t=this.cameras.main.height;this.cameras.main.fadeIn(500);const s=new Ti(this);s.createGradientBackground(e,t),s.createParticles(e,t,30),new kr(this).createAnimatedTitle(e/2,t/3,"OPEN TD","Tower Defense");const r=t/2+80,o=80,a=new Tr(this),l=a.createMainMenuButtons(e/2,r,o,{onSingleplayer:()=>this.handleSingleplayer(),onMultiplayer:()=>this.handleMultiplayer(),onOptions:()=>this.handleOptions(),onCredits:()=>this.handleCredits()});a.animateButtonsEntrance(l,800);const h=this.add.text(e/2,t-80,f("main.instructions"),{font:"18px Arial",color:"#888888"});h.setOrigin(.5),h.setAlpha(0),this.tweens.add({targets:h,alpha:1,duration:1e3,delay:1500}),this.add.text(e-10,t-10,"v1.0.0",{font:"14px Arial",color:"#444444"}).setOrigin(1,1),this.createUserInfo(e)}createUserInfo(e){const t=this.authManager.getCurrentUser();if(t){const s=this.add.graphics();s.fillStyle(0,.7),s.fillRoundedRect(e-250,10,240,80,10),s.lineStyle(2,43520,.8),s.strokeRoundedRect(e-250,10,240,80,10),this.add.text(e-130,25,t.username,{fontSize:"20px",fontFamily:"Arial",color:"#00ff00",fontStyle:"bold"}).setOrigin(.5,0),this.add.text(e-130,50,`Level ${t.level} | ${t.xp} XP`,{fontSize:"14px",color:"#ffffff"}).setOrigin(.5,0);const o=this.add.text(e-130,70,"ðŸšª "+f("main.logout"),{fontSize:"12px",color:"#ff6666"});o.setOrigin(.5,0),o.setInteractive({useHandCursor:!0}),o.on("pointerover",()=>{o.setStyle({color:"#ff0000"})}),o.on("pointerout",()=>{o.setStyle({color:"#ff6666"})}),o.on("pointerdown",()=>{this.authManager.logout(),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("LoginScene")})})}else this.add.text(e-20,20,"Gast-Modus",{fontSize:"16px",color:"#666666"}).setOrigin(1,0)}handleSingleplayer(){this.levelSelection=new _r(this),this.levelSelection.show(this.cameras.main.width,this.cameras.main.height,e=>{this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("GameScene",{levelType:e})})},()=>{})}handleMultiplayer(){this.cameras.main.fadeOut(500),this.time.delayedCall(500,()=>{this.scene.start("MultiplayerScene")})}handleOptions(){this.scene.launch("OptionsScene"),this.scene.pause()}handleCredits(){this.creditsOverlay=new Cr(this),this.creditsOverlay.show(this.cameras.main.width,this.cameras.main.height,()=>{})}}class Yt{constructor(e,t,s,i,r){this.scene=e,this.onChange=r,this.enabled=i,this.container=e.add.container(t,s),this.bg=e.add.rectangle(0,0,80,36,i?43520:6710886),this.bg.setStrokeStyle(2,16777215,.5),this.toggleCircle=e.add.circle(i?20:-20,0,14,16777215),this.label=e.add.text(0,0,i?"AN":"AUS",{font:"bold 16px Arial",color:"#000000"}),this.label.setOrigin(.5),this.container.add([this.bg,this.toggleCircle,this.label]),this.container.setSize(80,36),this.container.setInteractive(new Phaser.Geom.Rectangle(-40,-18,80,36),Phaser.Geom.Rectangle.Contains),this.container.on("pointerdown",()=>this.handleToggle())}container;bg;toggleCircle;label;enabled;setEnabled(e){this.enabled=e,this.bg.setFillStyle(this.enabled?43520:6710886),this.toggleCircle.x=this.enabled?20:-20,this.label.setText(this.enabled?"AN":"AUS")}handleToggle(){this.enabled=!this.enabled,this.bg.setFillStyle(this.enabled?43520:6710886),this.scene.tweens.add({targets:this.toggleCircle,x:this.enabled?20:-20,duration:300,ease:"Back.easeOut"}),this.label.setText(this.enabled?"AN":"AUS"),this.onChange(this.enabled)}getContainer(){return this.container}}class Er{constructor(e,t){this.scene=e,this.onChange=t,this.currentDifficulty="normal"}buttons=[];currentDifficulty;create(e,t,s){this.currentDifficulty=s;const i=this.scene.add.text(e-150,t+50,"Schwierigkeit:",{font:"24px Arial",color:"#ffffff"}),r=[{value:"easy",label:"Leicht",color:43520},{value:"normal",label:"Normal",color:26316},{value:"hard",label:"Schwer",color:13369344}];return r.forEach((o,a)=>{const l=this.scene.add.text(e-120+a*120,t+100,o.label,{font:"20px Arial",color:"#ffffff",backgroundColor:this.currentDifficulty===o.value?`#${o.color.toString(16).padStart(6,"0")}`:"#333333",padding:{x:15,y:8}});l.setOrigin(.5),l.setInteractive({useHandCursor:!0}),l.on("pointerover",()=>{this.currentDifficulty!==o.value&&l.setStyle({backgroundColor:"#555555"})}),l.on("pointerout",()=>{this.currentDifficulty!==o.value&&l.setStyle({backgroundColor:"#333333"})}),l.on("pointerdown",()=>{this.currentDifficulty=o.value,this.onChange(o.value),this.buttons.forEach((h,d)=>{const u=r[d];h.setStyle({backgroundColor:this.currentDifficulty===u.value?`#${u.color.toString(16).padStart(6,"0")}`:"#333333"})})}),this.buttons.push(l)}),{label:i,buttons:this.buttons}}getDifficultyInfo(){switch(this.currentDifficulty){case"easy":return"Weniger Gegner, mehr Startgold";case"normal":return"Ausbalanciertes Spielerlebnis";case"hard":return"Mehr Gegner, weniger Ressourcen";default:return""}}}class Ae{static instance;scene=null;music=null;soundEnabled=!1;musicEnabled=!1;assetsLoaded=!1;constructor(){}static getInstance(){return Ae.instance||(Ae.instance=new Ae),Ae.instance}init(e,t,s){this.scene=e;const i=E.getInstance();this.soundEnabled=i.isLoaded()?i.isSoundEnabled():t??!1,this.musicEnabled=i.isLoaded()?i.isMusicEnabled():s??!1,this.checkAndloadAssets()}checkAndloadAssets(){if(!this.scene||this.assetsLoaded)return!1;const e=E.getInstance();if(e.isLoaded()&&!e.isSoundEnabled()||!this.soundEnabled)return!1;const t=[["click","assets/sounds/click.mp3"],["music","assets/music/menu.mp3"],["tower_basic","assets/sounds/tower_basic.mp3"],["tower_fast","assets/sounds/tower_fast.mp3"],["tower_fire","assets/sounds/tower_fire.mp3"],["tower_frost","assets/sounds/tower_frost.mp3"],["tower_sniper","assets/sounds/tower_sniper.mp3"],["tower_splash","assets/sounds/tower_splash.mp3"],["tower_strong","assets/sounds/tower_strong.mp3"]];for(const[s,i]of t)this.scene.cache.audio.has(s)||this.scene.load.audio(s,st(i));return this.scene.load.start(),this.assetsLoaded=!0,!0}playTower(e){if(!this.checkAndloadAssets())return;const t=E.getInstance();if(!this.soundEnabled||!this.scene||!this.scene.sound||t.isLoaded()&&!t.isSoundEnabled())return;const i={basic:"tower_basic",fast:"tower_fast",fire:"tower_fire",frost:"tower_frost",sniper:"tower_sniper",splash:"tower_splash",strong:"tower_strong"}[e]||"click";this.scene.sound.play(i,{volume:.5})}playClick(){if(!this.checkAndloadAssets())return;const e=E.getInstance();this.soundEnabled&&this.scene&&this.scene.sound&&(!e.isLoaded()||e.isSoundEnabled())&&this.scene.sound.play("click",{volume:.5})}playMusic(){if(!this.checkAndloadAssets())return;const e=E.getInstance();this.musicEnabled&&this.scene&&this.scene.sound&&(!e.isLoaded()||e.isMusicEnabled())&&(!this.music||!this.music.isPlaying)&&(this.music=this.scene.sound.add("music",{loop:!0,volume:.3}),this.music.play())}stopMusic(){this.music&&this.music.isPlaying&&this.music.stop()}setSoundEnabled(e){const t=E.getInstance();return e&&t.isLoaded()&&!t.isSoundEnabled()?!1:(this.soundEnabled=e,!0)}setMusicEnabled(e){const t=E.getInstance();return e&&t.isLoaded()&&!t.isMusicEnabled()?!1:(this.musicEnabled=e,e?this.playMusic():this.stopMusic(),!0)}}class fs extends Phaser.Scene{settings;auth;constructor(){super({key:"OptionsScene"}),this.settings=ce.load(),this.auth=ge.getInstance()}create(){const e=Ae.getInstance(),t=this.cameras.main.width,s=this.cameras.main.height,i=this.add.rectangle(0,0,t,s,0,.85);i.setOrigin(0),i.setInteractive();const a=this.add.rectangle(t/2,s/2,600,500,1710638);a.setStrokeStyle(4,65280);const l=this.add.text(t/2,s/2-200,f("options.title"),{font:"bold 48px Arial",color:"#00ff00"});l.setOrigin(.5);const h=this.add.text(t/2-150,s/2-100,f("options.sound"),{font:"24px Arial",color:"#ffffff"}),d=E.getInstance(),u=d.isLoaded()?d.isSoundEnabled():this.settings.soundEnabled,p=new Yt(this,t/2+100,s/2-100,u,W=>{this.settings.soundEnabled=W,ce.save(this.settings),e.setSoundEnabled(W)?W&&e.playClick():(p.setEnabled(!1),this.settings.soundEnabled=!1,ce.save(this.settings))}),g=this.add.text(t/2-150,s/2-30,f("options.music"),{font:"24px Arial",color:"#ffffff"}),b=d.isLoaded()?d.isMusicEnabled():this.settings.musicEnabled,T=new Yt(this,t/2+100,s/2-30,b,W=>{this.settings.musicEnabled=W,ce.save(this.settings),e.setMusicEnabled(W)||(T.setEnabled(!1),this.settings.musicEnabled=!1,ce.save(this.settings))}),L=new Er(this,W=>{this.settings.difficulty=W,ce.save(this.settings),D.setText(L.getDifficultyInfo())}),{label:k,buttons:_}=L.create(t/2,s/2,this.settings.difficulty),D=this.add.text(t/2,s/2+150,L.getDifficultyInfo(),{font:"16px Arial",color:"#888888",align:"center"});D.setOrigin(.5);const S=this.add.text(t/2,s/2+200,f("options.back"),{font:"bold 24px Arial",color:"#ffffff",backgroundColor:"#00aa00",padding:{x:30,y:10}});S.setOrigin(.5),S.setInteractive({useHandCursor:!0}),S.on("pointerover",()=>{S.setScale(1.1)}),S.on("pointerout",()=>{S.setScale(1)}),S.on("pointerdown",()=>{this.scene.resume("MainMenuScene"),this.scene.stop()});const U=this.add.text(t/2,s/2+240,f("options.show_reports"),{font:"bold 18px Arial",color:"#ffffff",backgroundColor:"#333333",padding:{x:8,y:8}});U.setOrigin(.5),U.setInteractive({useHandCursor:!0}),U.on("pointerdown",()=>{this.auth.isLoggedIn()?(this.scene.launch("AdminScene"),this.scene.pause()):alert(f("options.must_login_to_view_reports"))});const P=[i,a,l,h,p.getContainer(),g,T.getContainer(),k,..._,D,S];P.push(U),P.forEach((W,te)=>{W.setAlpha(0),this.tweens.add({targets:W,alpha:1,duration:300,delay:te*30})}),e.init(this,this.settings.soundEnabled,this.settings.musicEnabled),this.settings.musicEnabled?e.playMusic():e.stopMusic();const M=this.add.text(t/2-150,s/2+60,f("options.auto_restart"),{font:"24px Arial",color:"#ffffff"}),N=new Yt(this,t/2+100,s/2+60,!!this.settings.autoRestartOnError,W=>{this.settings.autoRestartOnError=W,ce.save(this.settings)});P.splice(P.length-1,0,M,N.getContainer());const ue=ki(),oe=this.add.text(t/2-150,s/2+120,f("options.language"),{font:"24px Arial",color:"#ffffff"}),$=[],J=t/2+80;let Te=0;for(const W of ue){const te=this.add.text(J+Te*90,s/2+120,W.label,{font:"18px Arial",color:vi()===W.code?"#00ff00":"#ffffff"});te.setInteractive({useHandCursor:!0}),te.on("pointerdown",()=>{xi(W.code),this.scene.restart()}),$.push(te),Te+=1}P.push(oe,...$)}static getSettings(){return ce.getSettings()}}class Pr{scene;goldText;livesText;waveText;xpText;levelText;roomCodeText;constructor(e,t,s,i,r,o,a){this.scene=e;const l=20;this.goldText=e.add.text(l,l,`Gold: ${t}`,{font:"24px Arial",color:"#ffd700"}),this.livesText=e.add.text(l,l+35,`Leben: ${s}`,{font:"24px Arial",color:"#ff0000"}),this.waveText=e.add.text(l,l+70,`Welle: ${i}`,{font:"24px Arial",color:"#00ff00"}),this.levelText=e.add.text(l,l+105,`Level: ${r}`,{font:"20px Arial",color:"#00ffff"}),this.xpText=e.add.text(l,l+135,`XP: ${o}/${a}`,{font:"18px Arial",color:"#aaffff"})}updateGold(e){this.goldText.setText(`Gold: ${e}`)}updateLives(e){this.livesText.setText(`Leben: ${e}`)}updateWave(e){this.waveText.setText(`Welle: ${e}`)}updateXP(e,t,s){this.levelText.setText(`Level: ${t}`),this.xpText.setText(`XP: ${e}/${s}`)}showRoomCode(e){const t=this.scene.cameras.main.width,s=20;this.roomCodeText=this.scene.add.text(t-s,s+140,`ðŸŽ® Raum: ${e}`,{font:"bold 20px Arial",color:"#ffffff",backgroundColor:"#4a90e2",padding:{x:12,y:8}}),this.roomCodeText.setOrigin(1,0),this.roomCodeText.setInteractive({useHandCursor:!0}),this.roomCodeText.on("pointerdown",i=>{i.event.stopPropagation(),navigator.clipboard.writeText(e).then(()=>{const r=this.roomCodeText.text;this.roomCodeText.setText("âœ“ Kopiert!"),this.roomCodeText.setStyle({backgroundColor:"#00aa00"}),this.scene.time.delayedCall(1500,()=>{this.roomCodeText&&(this.roomCodeText.setText(r),this.roomCodeText.setStyle({backgroundColor:"#4a90e2"}))})})}),this.roomCodeText.on("pointerover",()=>{this.roomCodeText.setStyle({backgroundColor:"#5aa0f2"})}),this.roomCodeText.on("pointerout",()=>{this.roomCodeText.setStyle({backgroundColor:"#4a90e2"})})}hideRoomCode(){this.roomCodeText&&(this.roomCodeText.destroy(),this.roomCodeText=void 0)}}class Mr{scene;buttons=[];gold;researchManager;onTowerSelect;constructor(e,t,s,i){this.scene=e,this.gold=t,this.researchManager=s,this.onTowerSelect=i,this.createButtons()}createButtons(){const e=this.scene.cameras.main.height-80,t=20,s=120,i=E.getInstance().getConfig();[{type:"basic",label:i.towers.basic.name,cost:i.towers.basic.cost},{type:"fast",label:i.towers.fast.name,cost:i.towers.fast.cost},{type:"strong",label:i.towers.strong.name,cost:i.towers.strong.cost},{type:"splash",label:i.towers.splash.name,cost:i.towers.splash.cost},{type:"sniper",label:i.towers.sniper.name,cost:i.towers.sniper.cost},{type:"frost",label:i.towers.frost.name,cost:i.towers.frost.cost,requiresResearch:i.towers.frost.requiresResearch,researchId:"frost_tower"},{type:"fire",label:i.towers.fire.name,cost:i.towers.fire.cost,requiresResearch:i.towers.fire.requiresResearch,researchId:"fire_tower"}].forEach((o,a)=>{if(o.requiresResearch&&o.researchId&&!this.researchManager.isResearched(o.researchId))return;const l=this.scene.add.text(t+a*s,e,`${o.label}
${o.cost}G`,{font:"16px Arial",color:"#ffffff",backgroundColor:"#333333",padding:{x:10,y:5},align:"center"});l.setInteractive({useHandCursor:!0}),l.setData("towerType",o.type),l.setData("cost",o.cost),l.on("pointerdown",h=>{h.event.stopPropagation(),this.gold>=o.cost&&this.onTowerSelect(o.type,o.cost)}),this.buttons.push(l)})}updateGold(e){this.gold=e,this.updateStyles()}updateStyles(e){this.buttons.forEach(t=>{const s=t.getData("towerType"),i=t.getData("cost");s===e?t.setStyle({backgroundColor:"#00aa00"}):this.gold>=i?t.setStyle({backgroundColor:"#333333"}):t.setStyle({backgroundColor:"#333333"})})}recreate(){this.buttons.forEach(e=>e.destroy()),this.buttons=[],this.createButtons()}getButtons(){return this.buttons}}class Ar{startButton;pauseButton;autoWaveButton;isPaused=!1;autoWaveEnabled=!1;constructor(e,t,s,i){const r=e.cameras.main.width,o=e.cameras.main.height,a=20;this.startButton=e.add.text(r/2,o/2,"Welle Starten",{font:"bold 32px Arial",color:"#ffffff",backgroundColor:"#00aa00",padding:{x:30,y:15}}),this.startButton.setOrigin(.5),this.startButton.setInteractive({useHandCursor:!0}),this.startButton.on("pointerover",()=>{this.startButton.setStyle({backgroundColor:"#00ff00"})}),this.startButton.on("pointerout",()=>{this.startButton.setStyle({backgroundColor:"#00aa00"})}),this.startButton.on("pointerdown",l=>{l.event.stopPropagation(),t()}),this.pauseButton=e.add.text(r-a,a,"â¸ Pause",{font:"bold 20px Arial",color:"#ffffff",backgroundColor:"#666666",padding:{x:15,y:8}}),this.pauseButton.setOrigin(1,0),this.pauseButton.setInteractive({useHandCursor:!0}),this.pauseButton.on("pointerover",()=>{this.pauseButton.setStyle({backgroundColor:"#888888"})}),this.pauseButton.on("pointerout",()=>{const l=this.isPaused?"#ff6600":"#666666";this.pauseButton.setStyle({backgroundColor:l})}),this.pauseButton.on("pointerdown",l=>{l.event.stopPropagation(),s()}),this.autoWaveButton=e.add.text(r-a,a+45,"âš¡ Auto-Welle: AUS",{font:"bold 18px Arial",color:"#ffffff",backgroundColor:"#444444",padding:{x:12,y:6}}),this.autoWaveButton.setOrigin(1,0),this.autoWaveButton.setInteractive({useHandCursor:!0}),this.autoWaveButton.on("pointerover",()=>{this.autoWaveButton.setStyle({backgroundColor:"#666666"})}),this.autoWaveButton.on("pointerout",()=>{const l=this.autoWaveEnabled?"#00aa00":"#444444";this.autoWaveButton.setStyle({backgroundColor:l})}),this.autoWaveButton.on("pointerdown",l=>{l.event.stopPropagation(),i()})}showStartButton(e="Welle Starten"){this.startButton.setText(e),this.startButton.setVisible(!0),this.startButton.setInteractive({useHandCursor:!0})}hideStartButton(){this.startButton.setVisible(!1),this.startButton.disableInteractive()}setPaused(e){this.isPaused=e,this.pauseButton.setText(e?"â–¶ Weiter":"â¸ Pause"),this.pauseButton.setStyle({backgroundColor:e?"#ff6600":"#666666"})}setAutoWave(e){this.autoWaveEnabled=e,this.autoWaveButton.setText(e?"âš¡ Auto-Welle: AN":"âš¡ Auto-Welle: AUS"),this.autoWaveButton.setStyle({backgroundColor:e?"#00aa00":"#444444"})}getButtons(){return[this.startButton,this.pauseButton,this.autoWaveButton]}}class Ir{upgradeButton;sellButton;towerInfoText;gold;constructor(e,t,s,i){this.gold=t;const r=e.cameras.main.width,o=e.cameras.main.height;this.towerInfoText=e.add.text(r/2,o-220,"",{font:"20px Arial",color:"#ffffff",backgroundColor:"#333333",padding:{x:20,y:10},align:"center"}),this.towerInfoText.setOrigin(.5),this.towerInfoText.setVisible(!1),this.upgradeButton=e.add.text(r/2,o-160,f("tower.upgrade"),{font:"18px Arial",color:"#ffffff",backgroundColor:"#ff9900",padding:{x:15,y:10},align:"center"}),this.upgradeButton.setOrigin(.5),this.upgradeButton.setInteractive({useHandCursor:!0}),this.upgradeButton.setVisible(!1),this.upgradeButton.on("pointerover",()=>{this.upgradeButton.setStyle({backgroundColor:"#ffaa00"})}),this.upgradeButton.on("pointerout",()=>{this.upgradeButton.setStyle({backgroundColor:"#ff9900"})}),this.upgradeButton.on("pointerdown",a=>{a.event.stopPropagation(),s()}),this.sellButton=e.add.text(r/2+150,o-160,f("tower.sell_refund",{value:"0",pct:"90%"}),{font:"18px Arial",color:"#ffffff",backgroundColor:"#cc0000",padding:{x:15,y:10},align:"center"}),this.sellButton.setOrigin(.5),this.sellButton.setInteractive({useHandCursor:!0}),this.sellButton.setVisible(!1),this.sellButton.on("pointerover",()=>{this.sellButton.setStyle({backgroundColor:"#ff0000"})}),this.sellButton.on("pointerout",()=>{this.sellButton.setStyle({backgroundColor:"#cc0000"})}),this.sellButton.on("pointerdown",a=>{a.event.stopPropagation(),i()})}updateGold(e){this.gold=e}updateForTower(e){if(!e){this.upgradeButton.setVisible(!1),this.sellButton.setVisible(!1),this.towerInfoText.setVisible(!1);return}const t=e.getType(),s=this.getTowerDisplayName(t),i=e.getUpgradeLevel(),r=Math.round(e.getDamage()),o=Math.round(e.getRange());this.towerInfoText.setText(f("tower.info",{name:s,level:i,damage:r,range:o})),this.towerInfoText.setVisible(!0);const a=e.getSellValue();if(this.sellButton.setText(f("tower.sell_refund",{value:`${a}G`,pct:"90%"})),this.sellButton.setVisible(!0),!e.canUpgrade()){this.upgradeButton.setVisible(!1);return}const l=e.getUpgradeCost();this.upgradeButton.setText(f("tower.upgrade_cost",{level:i,nextLevel:i+1,cost:`${l}`})),this.upgradeButton.setVisible(!0),this.gold>=l?this.upgradeButton.setStyle({backgroundColor:"#ff9900"}):this.upgradeButton.setStyle({backgroundColor:"#666666"})}getButtons(){return[this.upgradeButton,this.sellButton]}getTowerDisplayName(e){return{basic:f("tower.name.basic"),fast:f("tower.name.fast"),strong:f("tower.name.strong"),sniper:f("tower.name.sniper"),splash:f("tower.name.splash"),frost:f("tower.name.frost"),fire:f("tower.name.fire")}[e]||e}}class Lr{scene;button;notificationBadge;pulseTween;constructor(e,t){this.scene=e;const s=e.cameras.main.width,i=20;this.button=e.add.text(s-i,i+95,"ðŸ”¬ Forschung",{font:"bold 18px Arial",color:"#ffffff",backgroundColor:"#9900ff",padding:{x:12,y:6}}),this.button.setOrigin(1,0),this.button.setInteractive({useHandCursor:!0}),this.button.on("pointerover",()=>{this.button.setStyle({backgroundColor:"#bb44ff"})}),this.button.on("pointerout",()=>{this.button.setStyle({backgroundColor:"#9900ff"})}),this.button.on("pointerdown",r=>{r.event.stopPropagation(),this.hidePulse(),t()}),this.notificationBadge=e.add.graphics(),this.notificationBadge.setDepth(100),this.notificationBadge.setVisible(!1)}showPulse(){this.pulseTween&&this.pulseTween.stop();const s=this.scene.cameras.main.width-20-10,i=108;this.notificationBadge.clear(),this.notificationBadge.fillStyle(16711680,1),this.notificationBadge.fillCircle(s,i,8),this.notificationBadge.lineStyle(2,16777215,1),this.notificationBadge.strokeCircle(s,i,8),this.notificationBadge.setVisible(!0),this.pulseTween=this.scene.tweens.add({targets:this.button,scaleX:{from:1,to:1.1},scaleY:{from:1,to:1.1},duration:600,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.scene.tweens.add({targets:this.notificationBadge,alpha:{from:1,to:.3},duration:500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}hidePulse(){this.pulseTween&&(this.pulseTween.stop(),this.pulseTween=void 0),this.button.setScale(1),this.notificationBadge.setVisible(!1),this.notificationBadge.clear()}getButton(){return this.button}}class Or{scene;researchManager;container;gold;onGoldSpent;onResearchComplete;constructor(e,t,s,i,r){this.scene=e,this.researchManager=t,this.gold=s,this.onGoldSpent=i,this.onResearchComplete=r}updateGold(e){this.gold=e}isOpen(){return this.container!==void 0}toggle(){this.isOpen()?this.close():this.show()}show(){const e=this.scene.cameras.main.width,t=this.scene.cameras.main.height;this.container=this.scene.add.container(0,0),this.container.setDepth(1e3);const s=this.scene.add.rectangle(0,0,e,t,0,.8);s.setOrigin(0),s.setInteractive(),this.container.add(s);const i=600,r=500,o=this.scene.add.rectangle(e/2,t/2,i,r,2236962);this.container.add(o);const a=this.scene.add.text(e/2,t/2-r/2+40,f("research.title"),{font:"bold 32px Arial",color:"#ffffff"});a.setOrigin(.5),this.container.add(a);const l=this.researchManager.getAvailableResearches(),h=t/2-r/2+100,d=100;if(l.forEach((p,g)=>{const b=h+g*d,T=this.scene.add.rectangle(e/2,b,i-60,d-10,3355443);this.container.add(T);const L=this.scene.add.text(e/2-250,b-20,p.name,{font:"bold 20px Arial",color:"#ffff00"});this.container.add(L);const k=this.scene.add.text(e/2-250,b+5,p.description,{font:"16px Arial",color:"#cccccc"});this.container.add(k);const _=this.scene.add.text(e/2-250,b+30,f("research.cost_fmt",{gold:p.goldCost,xp:p.xpRequired}),{font:"14px Arial",color:"#aaaaaa"});this.container.add(_);const D=this.researchManager.canResearch(p.id,this.gold),S=this.scene.add.text(e/2+180,b,f("research.research_button"),{font:"bold 18px Arial",color:"#ffffff",backgroundColor:D?"#00aa00":"#666666",padding:{x:15,y:8}});S.setOrigin(.5),D&&(S.setInteractive({useHandCursor:!0}),S.on("pointerover",()=>{S.setStyle({backgroundColor:"#00ff00"})}),S.on("pointerout",()=>{S.setStyle({backgroundColor:"#00aa00"})}),S.on("pointerdown",U=>{U.event.stopPropagation(),this.handleResearch(p.id)})),this.container.add(S)}),l.length===0){const p=this.scene.add.text(e/2,t/2,f("research.no_research"),{font:"20px Arial",color:"#888888"});p.setOrigin(.5),this.container.add(p);const g=this.scene.add.text(e/2,t/2+40,f("research.hint"),{font:"16px Arial",color:"#666666"});g.setOrigin(.5),this.container.add(g)}const u=this.scene.add.text(e/2,t/2+r/2-40,f("menu.close"),{font:"bold 20px Arial",color:"#ffffff",backgroundColor:"#ff0000",padding:{x:20,y:10}});u.setOrigin(.5),u.setInteractive({useHandCursor:!0}),u.on("pointerover",()=>{u.setStyle({backgroundColor:"#ff4444"})}),u.on("pointerout",()=>{u.setStyle({backgroundColor:"#ff0000"})}),u.on("pointerdown",p=>{p.event.stopPropagation(),this.close()}),this.container.add(u)}close(){this.container&&(this.container.destroy(),this.container=void 0)}handleResearch(e){const t=this.researchManager.getResearch(e);t&&this.researchManager.canResearch(e,this.gold)&&(this.researchManager.research(e),this.onGoldSpent(t.goldCost),this.onResearchComplete(e),this.close(),this.show())}}const{entries:_i,setPrototypeOf:Vs,isFrozen:Br,getPrototypeOf:Dr,getOwnPropertyDescriptor:Ur}=Object;let{freeze:Q,seal:ne,create:rs}=Object,{apply:ns,construct:os}=typeof Reflect<"u"&&Reflect;Q||(Q=function(e){return e});ne||(ne=function(e){return e});ns||(ns=function(e,t){for(var s=arguments.length,i=new Array(s>2?s-2:0),r=2;r<s;r++)i[r-2]=arguments[r];return e.apply(t,i)});os||(os=function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];return new e(...s)});const yt=z(Array.prototype.forEach),Nr=z(Array.prototype.lastIndexOf),Xs=z(Array.prototype.pop),Ye=z(Array.prototype.push),Hr=z(Array.prototype.splice),kt=z(String.prototype.toLowerCase),Kt=z(String.prototype.toString),Jt=z(String.prototype.match),Ke=z(String.prototype.replace),$r=z(String.prototype.indexOf),Fr=z(String.prototype.trim),le=z(Object.prototype.hasOwnProperty),Z=z(RegExp.prototype.test),Je=Wr(TypeError);function z(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];return ns(n,e,s)}}function Wr(n){return function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return os(n,t)}}function C(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:kt;Vs&&Vs(n,null);let s=e.length;for(;s--;){let i=e[s];if(typeof i=="string"){const r=t(i);r!==i&&(Br(e)||(e[s]=r),i=r)}n[i]=!0}return n}function Gr(n){for(let e=0;e<n.length;e++)le(n,e)||(n[e]=null);return n}function ke(n){const e=rs(null);for(const[t,s]of _i(n))le(n,t)&&(Array.isArray(s)?e[t]=Gr(s):s&&typeof s=="object"&&s.constructor===Object?e[t]=ke(s):e[t]=s);return e}function Ze(n,e){for(;n!==null;){const s=Ur(n,e);if(s){if(s.get)return z(s.get);if(typeof s.value=="function")return z(s.value)}n=Dr(n)}function t(){return null}return t}const Ys=Q(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Zt=Q(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Qt=Q(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),qr=Q(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),zt=Q(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),jr=Q(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ks=Q(["#text"]),Js=Q(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),es=Q(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Zs=Q(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),wt=Q(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Vr=ne(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Xr=ne(/<%[\w\W]*|[\w\W]*%>/gm),Yr=ne(/\$\{[\w\W]*/gm),Kr=ne(/^data-[\-\w.\u00B7-\uFFFF]+$/),Jr=ne(/^aria-[\-\w]+$/),Ci=ne(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Zr=ne(/^(?:\w+script|data):/i),Qr=ne(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Ri=ne(/^html$/i),zr=ne(/^[a-z][.\w]*(-[.\w]+)+$/i);var Qs=Object.freeze({__proto__:null,ARIA_ATTR:Jr,ATTR_WHITESPACE:Qr,CUSTOM_ELEMENT:zr,DATA_ATTR:Kr,DOCTYPE_NAME:Ri,ERB_EXPR:Xr,IS_ALLOWED_URI:Ci,IS_SCRIPT_OR_DATA:Zr,MUSTACHE_EXPR:Vr,TMPLIT_EXPR:Yr});const Qe={element:1,text:3,progressingInstruction:7,comment:8,document:9},en=function(){return typeof window>"u"?null:window},tn=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let s=null;const i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(s=t.getAttribute(i));const r="dompurify"+(s?"#"+s:"");try{return e.createPolicy(r,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+r+" could not be created."),null}},zs=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Ei(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:en();const e=v=>Ei(v);if(e.version="3.3.0",e.removed=[],!n||!n.document||n.document.nodeType!==Qe.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const s=t,i=s.currentScript,{DocumentFragment:r,HTMLTemplateElement:o,Node:a,Element:l,NodeFilter:h,NamedNodeMap:d=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:u,DOMParser:p,trustedTypes:g}=n,b=l.prototype,T=Ze(b,"cloneNode"),L=Ze(b,"remove"),k=Ze(b,"nextSibling"),_=Ze(b,"childNodes"),D=Ze(b,"parentNode");if(typeof o=="function"){const v=t.createElement("template");v.content&&v.content.ownerDocument&&(t=v.content.ownerDocument)}let S,U="";const{implementation:P,createNodeIterator:M,createDocumentFragment:N,getElementsByTagName:ue}=t,{importNode:oe}=s;let $=zs();e.isSupported=typeof _i=="function"&&typeof D=="function"&&P&&P.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:J,ERB_EXPR:Te,TMPLIT_EXPR:W,DATA_ATTR:te,ARIA_ATTR:at,IS_SCRIPT_OR_DATA:lt,ATTR_WHITESPACE:ct,CUSTOM_ELEMENT:je}=Qs;let{IS_ALLOWED_URI:j}=Qs,A=null;const se=C({},[...Ys,...Zt,...Qt,...zt,...Ks]);let H=null;const ae=C({},[...Js,...es,...Zs,...wt]);let I=Object.seal(rs(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),pe=null,_e=null;const Oe=Object.seal(rs(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let ks=!0,Dt=!0,Ts=!1,_s=!0,Be=!1,ht=!0,Pe=!1,Ut=!1,Nt=!1,De=!1,dt=!1,ut=!1,Cs=!0,Rs=!1;const Xi="user-content-";let Ht=!0,Ve=!1,Ue={},Ne=null;const Es=C({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ps=null;const Ms=C({},["audio","video","img","source","image","track"]);let $t=null;const As=C({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),pt="http://www.w3.org/1998/Math/MathML",ft="http://www.w3.org/2000/svg",Se="http://www.w3.org/1999/xhtml";let He=Se,Ft=!1,Wt=null;const Yi=C({},[pt,ft,Se],Kt);let gt=C({},["mi","mo","mn","ms","mtext"]),mt=C({},["annotation-xml"]);const Ki=C({},["title","style","font","a","script"]);let Xe=null;const Ji=["application/xhtml+xml","text/html"],Zi="text/html";let V=null,$e=null;const Qi=t.createElement("form"),Is=function(c){return c instanceof RegExp||c instanceof Function},Gt=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!($e&&$e===c)){if((!c||typeof c!="object")&&(c={}),c=ke(c),Xe=Ji.indexOf(c.PARSER_MEDIA_TYPE)===-1?Zi:c.PARSER_MEDIA_TYPE,V=Xe==="application/xhtml+xml"?Kt:kt,A=le(c,"ALLOWED_TAGS")?C({},c.ALLOWED_TAGS,V):se,H=le(c,"ALLOWED_ATTR")?C({},c.ALLOWED_ATTR,V):ae,Wt=le(c,"ALLOWED_NAMESPACES")?C({},c.ALLOWED_NAMESPACES,Kt):Yi,$t=le(c,"ADD_URI_SAFE_ATTR")?C(ke(As),c.ADD_URI_SAFE_ATTR,V):As,Ps=le(c,"ADD_DATA_URI_TAGS")?C(ke(Ms),c.ADD_DATA_URI_TAGS,V):Ms,Ne=le(c,"FORBID_CONTENTS")?C({},c.FORBID_CONTENTS,V):Es,pe=le(c,"FORBID_TAGS")?C({},c.FORBID_TAGS,V):ke({}),_e=le(c,"FORBID_ATTR")?C({},c.FORBID_ATTR,V):ke({}),Ue=le(c,"USE_PROFILES")?c.USE_PROFILES:!1,ks=c.ALLOW_ARIA_ATTR!==!1,Dt=c.ALLOW_DATA_ATTR!==!1,Ts=c.ALLOW_UNKNOWN_PROTOCOLS||!1,_s=c.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Be=c.SAFE_FOR_TEMPLATES||!1,ht=c.SAFE_FOR_XML!==!1,Pe=c.WHOLE_DOCUMENT||!1,De=c.RETURN_DOM||!1,dt=c.RETURN_DOM_FRAGMENT||!1,ut=c.RETURN_TRUSTED_TYPE||!1,Nt=c.FORCE_BODY||!1,Cs=c.SANITIZE_DOM!==!1,Rs=c.SANITIZE_NAMED_PROPS||!1,Ht=c.KEEP_CONTENT!==!1,Ve=c.IN_PLACE||!1,j=c.ALLOWED_URI_REGEXP||Ci,He=c.NAMESPACE||Se,gt=c.MATHML_TEXT_INTEGRATION_POINTS||gt,mt=c.HTML_INTEGRATION_POINTS||mt,I=c.CUSTOM_ELEMENT_HANDLING||{},c.CUSTOM_ELEMENT_HANDLING&&Is(c.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(I.tagNameCheck=c.CUSTOM_ELEMENT_HANDLING.tagNameCheck),c.CUSTOM_ELEMENT_HANDLING&&Is(c.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(I.attributeNameCheck=c.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),c.CUSTOM_ELEMENT_HANDLING&&typeof c.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(I.allowCustomizedBuiltInElements=c.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Be&&(Dt=!1),dt&&(De=!0),Ue&&(A=C({},Ks),H=[],Ue.html===!0&&(C(A,Ys),C(H,Js)),Ue.svg===!0&&(C(A,Zt),C(H,es),C(H,wt)),Ue.svgFilters===!0&&(C(A,Qt),C(H,es),C(H,wt)),Ue.mathMl===!0&&(C(A,zt),C(H,Zs),C(H,wt))),c.ADD_TAGS&&(typeof c.ADD_TAGS=="function"?Oe.tagCheck=c.ADD_TAGS:(A===se&&(A=ke(A)),C(A,c.ADD_TAGS,V))),c.ADD_ATTR&&(typeof c.ADD_ATTR=="function"?Oe.attributeCheck=c.ADD_ATTR:(H===ae&&(H=ke(H)),C(H,c.ADD_ATTR,V))),c.ADD_URI_SAFE_ATTR&&C($t,c.ADD_URI_SAFE_ATTR,V),c.FORBID_CONTENTS&&(Ne===Es&&(Ne=ke(Ne)),C(Ne,c.FORBID_CONTENTS,V)),Ht&&(A["#text"]=!0),Pe&&C(A,["html","head","body"]),A.table&&(C(A,["tbody"]),delete pe.tbody),c.TRUSTED_TYPES_POLICY){if(typeof c.TRUSTED_TYPES_POLICY.createHTML!="function")throw Je('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof c.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Je('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');S=c.TRUSTED_TYPES_POLICY,U=S.createHTML("")}else S===void 0&&(S=tn(g,i)),S!==null&&typeof U=="string"&&(U=S.createHTML(""));Q&&Q(c),$e=c}},Ls=C({},[...Zt,...Qt,...qr]),Os=C({},[...zt,...jr]),zi=function(c){let m=D(c);(!m||!m.tagName)&&(m={namespaceURI:He,tagName:"template"});const w=kt(c.tagName),F=kt(m.tagName);return Wt[c.namespaceURI]?c.namespaceURI===ft?m.namespaceURI===Se?w==="svg":m.namespaceURI===pt?w==="svg"&&(F==="annotation-xml"||gt[F]):!!Ls[w]:c.namespaceURI===pt?m.namespaceURI===Se?w==="math":m.namespaceURI===ft?w==="math"&&mt[F]:!!Os[w]:c.namespaceURI===Se?m.namespaceURI===ft&&!mt[F]||m.namespaceURI===pt&&!gt[F]?!1:!Os[w]&&(Ki[w]||!Ls[w]):!!(Xe==="application/xhtml+xml"&&Wt[c.namespaceURI]):!1},fe=function(c){Ye(e.removed,{element:c});try{D(c).removeChild(c)}catch{L(c)}},Me=function(c,m){try{Ye(e.removed,{attribute:m.getAttributeNode(c),from:m})}catch{Ye(e.removed,{attribute:null,from:m})}if(m.removeAttribute(c),c==="is")if(De||dt)try{fe(m)}catch{}else try{m.setAttribute(c,"")}catch{}},Bs=function(c){let m=null,w=null;if(Nt)c="<remove></remove>"+c;else{const G=Jt(c,/^[\r\n\t ]+/);w=G&&G[0]}Xe==="application/xhtml+xml"&&He===Se&&(c='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+c+"</body></html>");const F=S?S.createHTML(c):c;if(He===Se)try{m=new p().parseFromString(F,Xe)}catch{}if(!m||!m.documentElement){m=P.createDocument(He,"template",null);try{m.documentElement.innerHTML=Ft?U:F}catch{}}const Y=m.body||m.documentElement;return c&&w&&Y.insertBefore(t.createTextNode(w),Y.childNodes[0]||null),He===Se?ue.call(m,Pe?"html":"body")[0]:Pe?m.documentElement:Y},Ds=function(c){return M.call(c.ownerDocument||c,c,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT|h.SHOW_PROCESSING_INSTRUCTION|h.SHOW_CDATA_SECTION,null)},qt=function(c){return c instanceof u&&(typeof c.nodeName!="string"||typeof c.textContent!="string"||typeof c.removeChild!="function"||!(c.attributes instanceof d)||typeof c.removeAttribute!="function"||typeof c.setAttribute!="function"||typeof c.namespaceURI!="string"||typeof c.insertBefore!="function"||typeof c.hasChildNodes!="function")},Us=function(c){return typeof a=="function"&&c instanceof a};function ve(v,c,m){yt(v,w=>{w.call(e,c,m,$e)})}const Ns=function(c){let m=null;if(ve($.beforeSanitizeElements,c,null),qt(c))return fe(c),!0;const w=V(c.nodeName);if(ve($.uponSanitizeElement,c,{tagName:w,allowedTags:A}),ht&&c.hasChildNodes()&&!Us(c.firstElementChild)&&Z(/<[/\w!]/g,c.innerHTML)&&Z(/<[/\w!]/g,c.textContent)||c.nodeType===Qe.progressingInstruction||ht&&c.nodeType===Qe.comment&&Z(/<[/\w]/g,c.data))return fe(c),!0;if(!(Oe.tagCheck instanceof Function&&Oe.tagCheck(w))&&(!A[w]||pe[w])){if(!pe[w]&&$s(w)&&(I.tagNameCheck instanceof RegExp&&Z(I.tagNameCheck,w)||I.tagNameCheck instanceof Function&&I.tagNameCheck(w)))return!1;if(Ht&&!Ne[w]){const F=D(c)||c.parentNode,Y=_(c)||c.childNodes;if(Y&&F){const G=Y.length;for(let ee=G-1;ee>=0;--ee){const xe=T(Y[ee],!0);xe.__removalCount=(c.__removalCount||0)+1,F.insertBefore(xe,k(c))}}}return fe(c),!0}return c instanceof l&&!zi(c)||(w==="noscript"||w==="noembed"||w==="noframes")&&Z(/<\/no(script|embed|frames)/i,c.innerHTML)?(fe(c),!0):(Be&&c.nodeType===Qe.text&&(m=c.textContent,yt([J,Te,W],F=>{m=Ke(m,F," ")}),c.textContent!==m&&(Ye(e.removed,{element:c.cloneNode()}),c.textContent=m)),ve($.afterSanitizeElements,c,null),!1)},Hs=function(c,m,w){if(Cs&&(m==="id"||m==="name")&&(w in t||w in Qi))return!1;if(!(Dt&&!_e[m]&&Z(te,m))){if(!(ks&&Z(at,m))){if(!(Oe.attributeCheck instanceof Function&&Oe.attributeCheck(m,c))){if(!H[m]||_e[m]){if(!($s(c)&&(I.tagNameCheck instanceof RegExp&&Z(I.tagNameCheck,c)||I.tagNameCheck instanceof Function&&I.tagNameCheck(c))&&(I.attributeNameCheck instanceof RegExp&&Z(I.attributeNameCheck,m)||I.attributeNameCheck instanceof Function&&I.attributeNameCheck(m,c))||m==="is"&&I.allowCustomizedBuiltInElements&&(I.tagNameCheck instanceof RegExp&&Z(I.tagNameCheck,w)||I.tagNameCheck instanceof Function&&I.tagNameCheck(w))))return!1}else if(!$t[m]){if(!Z(j,Ke(w,ct,""))){if(!((m==="src"||m==="xlink:href"||m==="href")&&c!=="script"&&$r(w,"data:")===0&&Ps[c])){if(!(Ts&&!Z(lt,Ke(w,ct,"")))){if(w)return!1}}}}}}}return!0},$s=function(c){return c!=="annotation-xml"&&Jt(c,je)},Fs=function(c){ve($.beforeSanitizeAttributes,c,null);const{attributes:m}=c;if(!m||qt(c))return;const w={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:H,forceKeepAttr:void 0};let F=m.length;for(;F--;){const Y=m[F],{name:G,namespaceURI:ee,value:xe}=Y,Fe=V(G),jt=xe;let X=G==="value"?jt:Fr(jt);if(w.attrName=Fe,w.attrValue=X,w.keepAttr=!0,w.forceKeepAttr=void 0,ve($.uponSanitizeAttribute,c,w),X=w.attrValue,Rs&&(Fe==="id"||Fe==="name")&&(Me(G,c),X=Xi+X),ht&&Z(/((--!?|])>)|<\/(style|title|textarea)/i,X)){Me(G,c);continue}if(Fe==="attributename"&&Jt(X,"href")){Me(G,c);continue}if(w.forceKeepAttr)continue;if(!w.keepAttr){Me(G,c);continue}if(!_s&&Z(/\/>/i,X)){Me(G,c);continue}Be&&yt([J,Te,W],Gs=>{X=Ke(X,Gs," ")});const Ws=V(c.nodeName);if(!Hs(Ws,Fe,X)){Me(G,c);continue}if(S&&typeof g=="object"&&typeof g.getAttributeType=="function"&&!ee)switch(g.getAttributeType(Ws,Fe)){case"TrustedHTML":{X=S.createHTML(X);break}case"TrustedScriptURL":{X=S.createScriptURL(X);break}}if(X!==jt)try{ee?c.setAttributeNS(ee,G,X):c.setAttribute(G,X),qt(c)?fe(c):Xs(e.removed)}catch{Me(G,c)}}ve($.afterSanitizeAttributes,c,null)},er=function v(c){let m=null;const w=Ds(c);for(ve($.beforeSanitizeShadowDOM,c,null);m=w.nextNode();)ve($.uponSanitizeShadowNode,m,null),Ns(m),Fs(m),m.content instanceof r&&v(m.content);ve($.afterSanitizeShadowDOM,c,null)};return e.sanitize=function(v){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=null,w=null,F=null,Y=null;if(Ft=!v,Ft&&(v="<!-->"),typeof v!="string"&&!Us(v))if(typeof v.toString=="function"){if(v=v.toString(),typeof v!="string")throw Je("dirty is not a string, aborting")}else throw Je("toString is not a function");if(!e.isSupported)return v;if(Ut||Gt(c),e.removed=[],typeof v=="string"&&(Ve=!1),Ve){if(v.nodeName){const xe=V(v.nodeName);if(!A[xe]||pe[xe])throw Je("root node is forbidden and cannot be sanitized in-place")}}else if(v instanceof a)m=Bs("<!---->"),w=m.ownerDocument.importNode(v,!0),w.nodeType===Qe.element&&w.nodeName==="BODY"||w.nodeName==="HTML"?m=w:m.appendChild(w);else{if(!De&&!Be&&!Pe&&v.indexOf("<")===-1)return S&&ut?S.createHTML(v):v;if(m=Bs(v),!m)return De?null:ut?U:""}m&&Nt&&fe(m.firstChild);const G=Ds(Ve?v:m);for(;F=G.nextNode();)Ns(F),Fs(F),F.content instanceof r&&er(F.content);if(Ve)return v;if(De){if(dt)for(Y=N.call(m.ownerDocument);m.firstChild;)Y.appendChild(m.firstChild);else Y=m;return(H.shadowroot||H.shadowrootmode)&&(Y=oe.call(s,Y,!0)),Y}let ee=Pe?m.outerHTML:m.innerHTML;return Pe&&A["!doctype"]&&m.ownerDocument&&m.ownerDocument.doctype&&m.ownerDocument.doctype.name&&Z(Ri,m.ownerDocument.doctype.name)&&(ee="<!DOCTYPE "+m.ownerDocument.doctype.name+`>
`+ee),Be&&yt([J,Te,W],xe=>{ee=Ke(ee,xe," ")}),S&&ut?S.createHTML(ee):ee},e.setConfig=function(){let v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Gt(v),Ut=!0},e.clearConfig=function(){$e=null,Ut=!1},e.isValidAttribute=function(v,c,m){$e||Gt({});const w=V(v),F=V(c);return Hs(w,F,m)},e.addHook=function(v,c){typeof c=="function"&&Ye($[v],c)},e.removeHook=function(v,c){if(c!==void 0){const m=Nr($[v],c);return m===-1?void 0:Hr($[v],m,1)[0]}return Xs($[v])},e.removeHooks=function(v){$[v]=[]},e.removeAllHooks=function(){$=zs()},e}var sn=Ei();function gs(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let Ee=gs();function Pi(n){Ee=n}const Mi=/[&<>"']/,rn=new RegExp(Mi.source,"g"),Ai=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,nn=new RegExp(Ai.source,"g"),on={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ei=n=>on[n];function K(n,e){if(e){if(Mi.test(n))return n.replace(rn,ei)}else if(Ai.test(n))return n.replace(nn,ei);return n}const an=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function Ii(n){return n.replace(an,(e,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const ln=/(^|[^\[])\^/g;function B(n,e){n=typeof n=="string"?n:n.source,e=e||"";const t={replace:(s,i)=>(i=i.source||i,i=i.replace(ln,"$1"),n=n.replace(s,i),t),getRegex:()=>new RegExp(n,e)};return t}const cn=/[^\w:]/g,hn=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function ti(n,e,t){if(n){let s;try{s=decodeURIComponent(Ii(t)).replace(cn,"").toLowerCase()}catch{return null}if(s.indexOf("javascript:")===0||s.indexOf("vbscript:")===0||s.indexOf("data:")===0)return null}e&&!hn.test(t)&&(t=fn(e,t));try{t=encodeURI(t).replace(/%25/g,"%")}catch{return null}return t}const bt={},dn=/^[^:]+:\/*[^/]*$/,un=/^([^:]+:)[\s\S]*$/,pn=/^([^:]+:\/*[^/]*)[\s\S]*$/;function fn(n,e){bt[" "+n]||(dn.test(n)?bt[" "+n]=n+"/":bt[" "+n]=Tt(n,"/",!0)),n=bt[" "+n];const t=n.indexOf(":")===-1;return e.substring(0,2)==="//"?t?e:n.replace(un,"$1")+e:e.charAt(0)==="/"?t?e:n.replace(pn,"$1")+e:n+e}const At={exec:function(){}};function si(n,e){const t=n.replace(/\|/g,(r,o,a)=>{let l=!1,h=o;for(;--h>=0&&a[h]==="\\";)l=!l;return l?"|":" |"}),s=t.split(/ \|/);let i=0;if(s[0].trim()||s.shift(),s.length>0&&!s[s.length-1].trim()&&s.pop(),s.length>e)s.splice(e);else for(;s.length<e;)s.push("");for(;i<s.length;i++)s[i]=s[i].trim().replace(/\\\|/g,"|");return s}function Tt(n,e,t){const s=n.length;if(s===0)return"";let i=0;for(;i<s;){const r=n.charAt(s-i-1);if(r===e&&!t)i++;else if(r!==e&&t)i++;else break}return n.slice(0,s-i)}function gn(n,e){if(n.indexOf(e[1])===-1)return-1;const t=n.length;let s=0,i=0;for(;i<t;i++)if(n[i]==="\\")i++;else if(n[i]===e[0])s++;else if(n[i]===e[1]&&(s--,s<0))return i;return-1}function mn(n,e){!n||n.silent||(e&&console.warn("marked(): callback is deprecated since version 5.0.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/using_pro#async"),(n.sanitize||n.sanitizer)&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options"),(n.highlight||n.langPrefix!=="language-")&&console.warn("marked(): highlight and langPrefix parameters are deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-highlight."),n.mangle&&console.warn("marked(): mangle parameter is enabled by default, but is deprecated since version 5.0.0, and will be removed in the future. To clear this warning, install https://www.npmjs.com/package/marked-mangle, or disable by setting `{mangle: false}`."),n.baseUrl&&console.warn("marked(): baseUrl parameter is deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-base-url."),n.smartypants&&console.warn("marked(): smartypants parameter is deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-smartypants."),n.xhtml&&console.warn("marked(): xhtml parameter is deprecated since version 5.0.0, should not be used and will be removed in the future. Instead use https://www.npmjs.com/package/marked-xhtml."),(n.headerIds||n.headerPrefix)&&console.warn("marked(): headerIds and headerPrefix parameters enabled by default, but are deprecated since version 5.0.0, and will be removed in the future. To clear this warning, install  https://www.npmjs.com/package/marked-gfm-heading-id, or disable by setting `{headerIds: false}`."))}function ii(n,e,t,s){const i=e.href,r=e.title?K(e.title):null,o=n[1].replace(/\\([\[\]])/g,"$1");if(n[0].charAt(0)!=="!"){s.state.inLink=!0;const a={type:"link",raw:t,href:i,title:r,text:o,tokens:s.inlineTokens(o)};return s.state.inLink=!1,a}return{type:"image",raw:t,href:i,title:r,text:K(o)}}function yn(n,e){const t=n.match(/^(\s+)(?:```)/);if(t===null)return e;const s=t[1];return e.split(`
`).map(i=>{const r=i.match(/^\s+/);if(r===null)return i;const[o]=r;return o.length>=s.length?i.slice(s.length):i}).join(`
`)}class It{constructor(e){this.options=e||Ee}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const s=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?s:Tt(s,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const s=t[0],i=yn(s,t[3]||"");return{type:"code",raw:s,lang:t[2]?t[2].trim().replace(this.rules.inline._escapes,"$1"):t[2],text:i}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let s=t[2].trim();if(/#$/.test(s)){const i=Tt(s,"#");(this.options.pedantic||!i||/ $/.test(i))&&(s=i.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const s=t[0].replace(/^ *>[ \t]?/gm,""),i=this.lexer.state.top;this.lexer.state.top=!0;const r=this.lexer.blockTokens(s);return this.lexer.state.top=i,{type:"blockquote",raw:t[0],tokens:r,text:s}}}list(e){let t=this.rules.block.list.exec(e);if(t){let s,i,r,o,a,l,h,d,u,p,g,b,T=t[1].trim();const L=T.length>1,k={type:"list",raw:"",ordered:L,start:L?+T.slice(0,-1):"",loose:!1,items:[]};T=L?`\\d{1,9}\\${T.slice(-1)}`:`\\${T}`,this.options.pedantic&&(T=L?T:"[*+-]");const _=new RegExp(`^( {0,3}${T})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;e&&(b=!1,!(!(t=_.exec(e))||this.rules.block.hr.test(e)));){if(s=t[0],e=e.substring(s.length),d=t[2].split(`
`,1)[0].replace(/^\t+/,S=>" ".repeat(3*S.length)),u=e.split(`
`,1)[0],this.options.pedantic?(o=2,g=d.trimLeft()):(o=t[2].search(/[^ ]/),o=o>4?1:o,g=d.slice(o),o+=t[1].length),l=!1,!d&&/^ *$/.test(u)&&(s+=u+`
`,e=e.substring(u.length+1),b=!0),!b){const S=new RegExp(`^ {0,${Math.min(3,o-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),U=new RegExp(`^ {0,${Math.min(3,o-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),P=new RegExp(`^ {0,${Math.min(3,o-1)}}(?:\`\`\`|~~~)`),M=new RegExp(`^ {0,${Math.min(3,o-1)}}#`);for(;e&&(p=e.split(`
`,1)[0],u=p,this.options.pedantic&&(u=u.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(P.test(u)||M.test(u)||S.test(u)||U.test(e)));){if(u.search(/[^ ]/)>=o||!u.trim())g+=`
`+u.slice(o);else{if(l||d.search(/[^ ]/)>=4||P.test(d)||M.test(d)||U.test(d))break;g+=`
`+u}!l&&!u.trim()&&(l=!0),s+=p+`
`,e=e.substring(p.length+1),d=u.slice(o)}}k.loose||(h?k.loose=!0:/\n *\n *$/.test(s)&&(h=!0)),this.options.gfm&&(i=/^\[[ xX]\] /.exec(g),i&&(r=i[0]!=="[ ] ",g=g.replace(/^\[[ xX]\] +/,""))),k.items.push({type:"list_item",raw:s,task:!!i,checked:r,loose:!1,text:g}),k.raw+=s}k.items[k.items.length-1].raw=s.trimRight(),k.items[k.items.length-1].text=g.trimRight(),k.raw=k.raw.trimRight();const D=k.items.length;for(a=0;a<D;a++)if(this.lexer.state.top=!1,k.items[a].tokens=this.lexer.blockTokens(k.items[a].text,[]),!k.loose){const S=k.items[a].tokens.filter(P=>P.type==="space"),U=S.length>0&&S.some(P=>/\n.*\n/.test(P.raw));k.loose=U}if(k.loose)for(a=0;a<D;a++)k.items[a].loose=!0;return k}}html(e){const t=this.rules.block.html.exec(e);if(t){const s={type:"html",block:!0,raw:t[0],pre:!this.options.sanitizer&&(t[1]==="pre"||t[1]==="script"||t[1]==="style"),text:t[0]};if(this.options.sanitize){const i=this.options.sanitizer?this.options.sanitizer(t[0]):K(t[0]);s.type="paragraph",s.text=i,s.tokens=this.lexer.inline(i)}return s}}def(e){const t=this.rules.block.def.exec(e);if(t){const s=t[1].toLowerCase().replace(/\s+/g," "),i=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",r=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline._escapes,"$1"):t[3];return{type:"def",tag:s,raw:t[0],href:i,title:r}}}table(e){const t=this.rules.block.table.exec(e);if(t){const s={type:"table",header:si(t[1]).map(i=>({text:i})),align:t[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(s.header.length===s.align.length){s.raw=t[0];let i=s.align.length,r,o,a,l;for(r=0;r<i;r++)/^ *-+: *$/.test(s.align[r])?s.align[r]="right":/^ *:-+: *$/.test(s.align[r])?s.align[r]="center":/^ *:-+ *$/.test(s.align[r])?s.align[r]="left":s.align[r]=null;for(i=s.rows.length,r=0;r<i;r++)s.rows[r]=si(s.rows[r],s.header.length).map(h=>({text:h}));for(i=s.header.length,o=0;o<i;o++)s.header[o].tokens=this.lexer.inline(s.header[o].text);for(i=s.rows.length,o=0;o<i;o++)for(l=s.rows[o],a=0;a<l.length;a++)l[a].tokens=this.lexer.inline(l[a].text);return s}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const s=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:s,tokens:this.lexer.inline(s)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:K(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):K(t[0]):t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const s=t[2].trim();if(!this.options.pedantic&&/^</.test(s)){if(!/>$/.test(s))return;const o=Tt(s.slice(0,-1),"\\");if((s.length-o.length)%2===0)return}else{const o=gn(t[2],"()");if(o>-1){const l=(t[0].indexOf("!")===0?5:4)+t[1].length+o;t[2]=t[2].substring(0,o),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let i=t[2],r="";if(this.options.pedantic){const o=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(i);o&&(i=o[1],r=o[3])}else r=t[3]?t[3].slice(1,-1):"";return i=i.trim(),/^</.test(i)&&(this.options.pedantic&&!/>$/.test(s)?i=i.slice(1):i=i.slice(1,-1)),ii(t,{href:i&&i.replace(this.rules.inline._escapes,"$1"),title:r&&r.replace(this.rules.inline._escapes,"$1")},t[0],this.lexer)}}reflink(e,t){let s;if((s=this.rules.inline.reflink.exec(e))||(s=this.rules.inline.nolink.exec(e))){let i=(s[2]||s[1]).replace(/\s+/g," ");if(i=t[i.toLowerCase()],!i){const r=s[0].charAt(0);return{type:"text",raw:r,text:r}}return ii(s,i,s[0],this.lexer)}}emStrong(e,t,s=""){let i=this.rules.inline.emStrong.lDelim.exec(e);if(!i||i[3]&&s.match(/[\p{L}\p{N}]/u))return;if(!(i[1]||i[2]||"")||!s||this.rules.inline.punctuation.exec(s)){const o=i[0].length-1;let a,l,h=o,d=0;const u=i[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(u.lastIndex=0,t=t.slice(-1*e.length+o);(i=u.exec(t))!=null;){if(a=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!a)continue;if(l=a.length,i[3]||i[4]){h+=l;continue}else if((i[5]||i[6])&&o%3&&!((o+l)%3)){d+=l;continue}if(h-=l,h>0)continue;l=Math.min(l,l+h+d);const p=e.slice(0,o+i.index+l+1);if(Math.min(o,l)%2){const b=p.slice(1,-1);return{type:"em",raw:p,text:b,tokens:this.lexer.inlineTokens(b)}}const g=p.slice(2,-2);return{type:"strong",raw:p,text:g,tokens:this.lexer.inlineTokens(g)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let s=t[2].replace(/\n/g," ");const i=/[^ ]/.test(s),r=/^ /.test(s)&&/ $/.test(s);return i&&r&&(s=s.substring(1,s.length-1)),s=K(s,!0),{type:"codespan",raw:t[0],text:s}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e,t){const s=this.rules.inline.autolink.exec(e);if(s){let i,r;return s[2]==="@"?(i=K(this.options.mangle?t(s[1]):s[1]),r="mailto:"+i):(i=K(s[1]),r=i),{type:"link",raw:s[0],text:i,href:r,tokens:[{type:"text",raw:i,text:i}]}}}url(e,t){let s;if(s=this.rules.inline.url.exec(e)){let i,r;if(s[2]==="@")i=K(this.options.mangle?t(s[0]):s[0]),r="mailto:"+i;else{let o;do o=s[0],s[0]=this.rules.inline._backpedal.exec(s[0])[0];while(o!==s[0]);i=K(s[0]),s[1]==="www."?r="http://"+s[0]:r=s[0]}return{type:"link",raw:s[0],text:i,href:r,tokens:[{type:"text",raw:i,text:i}]}}}inlineText(e,t){const s=this.rules.inline.text.exec(e);if(s){let i;return this.lexer.state.inRawBlock?i=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(s[0]):K(s[0]):s[0]:i=K(this.options.smartypants?t(s[0]):s[0]),{type:"text",raw:s[0],text:i}}}}const x={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:At,lheading:/^((?:(?!^bull ).|\n(?!\n|bull ))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};x._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;x._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;x.def=B(x.def).replace("label",x._label).replace("title",x._title).getRegex();x.bullet=/(?:[*+-]|\d{1,9}[.)])/;x.listItemStart=B(/^( *)(bull) */).replace("bull",x.bullet).getRegex();x.list=B(x.list).replace(/bull/g,x.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+x.def.source+")").getRegex();x._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";x._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;x.html=B(x.html,"i").replace("comment",x._comment).replace("tag",x._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();x.lheading=B(x.lheading).replace(/bull/g,x.bullet).getRegex();x.paragraph=B(x._paragraph).replace("hr",x.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",x._tag).getRegex();x.blockquote=B(x.blockquote).replace("paragraph",x.paragraph).getRegex();x.normal={...x};x.gfm={...x.normal,table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"};x.gfm.table=B(x.gfm.table).replace("hr",x.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",x._tag).getRegex();x.gfm.paragraph=B(x._paragraph).replace("hr",x.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",x.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",x._tag).getRegex();x.pedantic={...x.normal,html:B(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",x._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:At,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:B(x.normal._paragraph).replace("hr",x.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",x.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};const y={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:At,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,rDelimAst:/^[^_*]*?__[^_*]*?\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\*)[punct](\*+)(?=[\s]|$)|[^punct\s](\*+)(?!\*)(?=[punct\s]|$)|(?!\*)[punct\s](\*+)(?=[^punct\s])|[\s](\*+)(?!\*)(?=[punct])|(?!\*)[punct](\*+)(?!\*)(?=[punct])|[^punct\s](\*+)(?=[^punct\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\s]|$)|[^punct\s](_+)(?!_)(?=[punct\s]|$)|(?!_)[punct\s](_+)(?=[^punct\s])|[\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:At,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^((?![*_])[\spunctuation])/};y._punctuation="\\p{P}$+<=>`^|~";y.punctuation=B(y.punctuation,"u").replace(/punctuation/g,y._punctuation).getRegex();y.blockSkip=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g;y.anyPunctuation=/\\[punct]/g;y._escapes=/\\([punct])/g;y._comment=B(x._comment).replace("(?:-->|$)","-->").getRegex();y.emStrong.lDelim=B(y.emStrong.lDelim,"u").replace(/punct/g,y._punctuation).getRegex();y.emStrong.rDelimAst=B(y.emStrong.rDelimAst,"gu").replace(/punct/g,y._punctuation).getRegex();y.emStrong.rDelimUnd=B(y.emStrong.rDelimUnd,"gu").replace(/punct/g,y._punctuation).getRegex();y.anyPunctuation=B(y.anyPunctuation,"gu").replace(/punct/g,y._punctuation).getRegex();y._escapes=B(y._escapes,"gu").replace(/punct/g,y._punctuation).getRegex();y._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;y._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;y.autolink=B(y.autolink).replace("scheme",y._scheme).replace("email",y._email).getRegex();y._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;y.tag=B(y.tag).replace("comment",y._comment).replace("attribute",y._attribute).getRegex();y._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;y._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;y._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;y.link=B(y.link).replace("label",y._label).replace("href",y._href).replace("title",y._title).getRegex();y.reflink=B(y.reflink).replace("label",y._label).replace("ref",x._label).getRegex();y.nolink=B(y.nolink).replace("ref",x._label).getRegex();y.reflinkSearch=B(y.reflinkSearch,"g").replace("reflink",y.reflink).replace("nolink",y.nolink).getRegex();y.normal={...y};y.pedantic={...y.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:B(/^!?\[(label)\]\((.*?)\)/).replace("label",y._label).getRegex(),reflink:B(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",y._label).getRegex()};y.gfm={...y.normal,escape:B(y.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/};y.gfm.url=B(y.gfm.url,"i").replace("email",y.gfm._extended_email).getRegex();y.breaks={...y.gfm,br:B(y.br).replace("{2,}","*").getRegex(),text:B(y.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};function wn(n){return n.replace(/---/g,"â€”").replace(/--/g,"â€“").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1â€˜").replace(/'/g,"â€™").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1â€œ").replace(/"/g,"â€").replace(/\.{3}/g,"â€¦")}function ri(n){let e="",t,s;const i=n.length;for(t=0;t<i;t++)s=n.charCodeAt(t),Math.random()>.5&&(s="x"+s.toString(16)),e+="&#"+s+";";return e}class me{constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Ee,this.options.tokenizer=this.options.tokenizer||new It,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:x.normal,inline:y.normal};this.options.pedantic?(t.block=x.pedantic,t.inline=y.pedantic):this.options.gfm&&(t.block=x.gfm,this.options.breaks?t.inline=y.breaks:t.inline=y.gfm),this.tokenizer.rules=t}static get rules(){return{block:x,inline:y}}static lex(e,t){return new me(t).lex(e)}static lexInline(e,t){return new me(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);let t;for(;t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(e,t=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(a,l,h)=>l+"    ".repeat(h.length));let s,i,r,o;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(s=a.call({lexer:this},e,t))?(e=e.substring(s.raw.length),t.push(s),!0):!1))){if(s=this.tokenizer.space(e)){e=e.substring(s.raw.length),s.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(s);continue}if(s=this.tokenizer.code(e)){e=e.substring(s.raw.length),i=t[t.length-1],i&&(i.type==="paragraph"||i.type==="text")?(i.raw+=`
`+s.raw,i.text+=`
`+s.text,this.inlineQueue[this.inlineQueue.length-1].src=i.text):t.push(s);continue}if(s=this.tokenizer.fences(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.heading(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.hr(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.blockquote(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.list(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.html(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.def(e)){e=e.substring(s.raw.length),i=t[t.length-1],i&&(i.type==="paragraph"||i.type==="text")?(i.raw+=`
`+s.raw,i.text+=`
`+s.raw,this.inlineQueue[this.inlineQueue.length-1].src=i.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title});continue}if(s=this.tokenizer.table(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.lheading(e)){e=e.substring(s.raw.length),t.push(s);continue}if(r=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0;const l=e.slice(1);let h;this.options.extensions.startBlock.forEach(function(d){h=d.call({lexer:this},l),typeof h=="number"&&h>=0&&(a=Math.min(a,h))}),a<1/0&&a>=0&&(r=e.substring(0,a+1))}if(this.state.top&&(s=this.tokenizer.paragraph(r))){i=t[t.length-1],o&&i.type==="paragraph"?(i.raw+=`
`+s.raw,i.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=i.text):t.push(s),o=r.length!==e.length,e=e.substring(s.raw.length);continue}if(s=this.tokenizer.text(e)){e=e.substring(s.raw.length),i=t[t.length-1],i&&i.type==="text"?(i.raw+=`
`+s.raw,i.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=i.text):t.push(s);continue}if(e){const a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let s,i,r,o=e,a,l,h;if(this.tokens.links){const d=Object.keys(this.tokens.links);if(d.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(o))!=null;)d.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(o))!=null;)o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(o))!=null;)o=o.slice(0,a.index)+"++"+o.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(l||(h=""),l=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(d=>(s=d.call({lexer:this},e,t))?(e=e.substring(s.raw.length),t.push(s),!0):!1))){if(s=this.tokenizer.escape(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.tag(e)){e=e.substring(s.raw.length),i=t[t.length-1],i&&s.type==="text"&&i.type==="text"?(i.raw+=s.raw,i.text+=s.text):t.push(s);continue}if(s=this.tokenizer.link(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(s.raw.length),i=t[t.length-1],i&&s.type==="text"&&i.type==="text"?(i.raw+=s.raw,i.text+=s.text):t.push(s);continue}if(s=this.tokenizer.emStrong(e,o,h)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.codespan(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.br(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.del(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.autolink(e,ri)){e=e.substring(s.raw.length),t.push(s);continue}if(!this.state.inLink&&(s=this.tokenizer.url(e,ri))){e=e.substring(s.raw.length),t.push(s);continue}if(r=e,this.options.extensions&&this.options.extensions.startInline){let d=1/0;const u=e.slice(1);let p;this.options.extensions.startInline.forEach(function(g){p=g.call({lexer:this},u),typeof p=="number"&&p>=0&&(d=Math.min(d,p))}),d<1/0&&d>=0&&(r=e.substring(0,d+1))}if(s=this.tokenizer.inlineText(r,wn)){e=e.substring(s.raw.length),s.raw.slice(-1)!=="_"&&(h=s.raw.slice(-1)),l=!0,i=t[t.length-1],i&&i.type==="text"?(i.raw+=s.raw,i.text+=s.text):t.push(s);continue}if(e){const d="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return t}}class Lt{constructor(e){this.options=e||Ee}code(e,t,s){const i=(t||"").match(/\S*/)[0];if(this.options.highlight){const r=this.options.highlight(e,i);r!=null&&r!==e&&(s=!0,e=r)}return e=e.replace(/\n$/,"")+`
`,i?'<pre><code class="'+this.options.langPrefix+K(i)+'">'+(s?e:K(e,!0))+`</code></pre>
`:"<pre><code>"+(s?e:K(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e,t){return e}heading(e,t,s,i){if(this.options.headerIds){const r=this.options.headerPrefix+i.slug(s);return`<h${t} id="${r}">${e}</h${t}>
`}return`<h${t}>${e}</h${t}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(e,t,s){const i=t?"ol":"ul",r=t&&s!==1?' start="'+s+'"':"";return"<"+i+r+`>
`+e+"</"+i+`>
`}listitem(e){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(e){return`<p>${e}</p>
`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){const s=t.header?"th":"td";return(t.align?`<${s} align="${t.align}">`:`<${s}>`)+e+`</${s}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(e){return`<del>${e}</del>`}link(e,t,s){if(e=ti(this.options.sanitize,this.options.baseUrl,e),e===null)return s;let i='<a href="'+e+'"';return t&&(i+=' title="'+t+'"'),i+=">"+s+"</a>",i}image(e,t,s){if(e=ti(this.options.sanitize,this.options.baseUrl,e),e===null)return s;let i=`<img src="${e}" alt="${s}"`;return t&&(i+=` title="${t}"`),i+=this.options.xhtml?"/>":">",i}text(e){return e}}class ms{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,s){return""+s}image(e,t,s){return""+s}br(){return""}}class ys{constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(e,t){let s=e,i=0;if(this.seen.hasOwnProperty(s)){i=this.seen[e];do i++,s=e+"-"+i;while(this.seen.hasOwnProperty(s))}return t||(this.seen[e]=i,this.seen[s]=0),s}slug(e,t={}){const s=this.serialize(e);return this.getNextSafeSlug(s,t.dryrun)}}class ye{constructor(e){this.options=e||Ee,this.options.renderer=this.options.renderer||new Lt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new ms,this.slugger=new ys}static parse(e,t){return new ye(t).parse(e)}static parseInline(e,t){return new ye(t).parseInline(e)}parse(e,t=!0){let s="",i,r,o,a,l,h,d,u,p,g,b,T,L,k,_,D,S,U,P;const M=e.length;for(i=0;i<M;i++){if(g=e[i],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[g.type]&&(P=this.options.extensions.renderers[g.type].call({parser:this},g),P!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(g.type))){s+=P||"";continue}switch(g.type){case"space":continue;case"hr":{s+=this.renderer.hr();continue}case"heading":{s+=this.renderer.heading(this.parseInline(g.tokens),g.depth,Ii(this.parseInline(g.tokens,this.textRenderer)),this.slugger);continue}case"code":{s+=this.renderer.code(g.text,g.lang,g.escaped);continue}case"table":{for(u="",d="",a=g.header.length,r=0;r<a;r++)d+=this.renderer.tablecell(this.parseInline(g.header[r].tokens),{header:!0,align:g.align[r]});for(u+=this.renderer.tablerow(d),p="",a=g.rows.length,r=0;r<a;r++){for(h=g.rows[r],d="",l=h.length,o=0;o<l;o++)d+=this.renderer.tablecell(this.parseInline(h[o].tokens),{header:!1,align:g.align[o]});p+=this.renderer.tablerow(d)}s+=this.renderer.table(u,p);continue}case"blockquote":{p=this.parse(g.tokens),s+=this.renderer.blockquote(p);continue}case"list":{for(b=g.ordered,T=g.start,L=g.loose,a=g.items.length,p="",r=0;r<a;r++)_=g.items[r],D=_.checked,S=_.task,k="",_.task&&(U=this.renderer.checkbox(D),L?_.tokens.length>0&&_.tokens[0].type==="paragraph"?(_.tokens[0].text=U+" "+_.tokens[0].text,_.tokens[0].tokens&&_.tokens[0].tokens.length>0&&_.tokens[0].tokens[0].type==="text"&&(_.tokens[0].tokens[0].text=U+" "+_.tokens[0].tokens[0].text)):_.tokens.unshift({type:"text",text:U}):k+=U),k+=this.parse(_.tokens,L),p+=this.renderer.listitem(k,S,D);s+=this.renderer.list(p,b,T);continue}case"html":{s+=this.renderer.html(g.text,g.block);continue}case"paragraph":{s+=this.renderer.paragraph(this.parseInline(g.tokens));continue}case"text":{for(p=g.tokens?this.parseInline(g.tokens):g.text;i+1<M&&e[i+1].type==="text";)g=e[++i],p+=`
`+(g.tokens?this.parseInline(g.tokens):g.text);s+=t?this.renderer.paragraph(p):p;continue}default:{const N='Token with "'+g.type+'" type was not found.';if(this.options.silent){console.error(N);return}else throw new Error(N)}}}return s}parseInline(e,t){t=t||this.renderer;let s="",i,r,o;const a=e.length;for(i=0;i<a;i++){if(r=e[i],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[r.type]&&(o=this.options.extensions.renderers[r.type].call({parser:this},r),o!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(r.type))){s+=o||"";continue}switch(r.type){case"escape":{s+=t.text(r.text);break}case"html":{s+=t.html(r.text);break}case"link":{s+=t.link(r.href,r.title,this.parseInline(r.tokens,t));break}case"image":{s+=t.image(r.href,r.title,r.text);break}case"strong":{s+=t.strong(this.parseInline(r.tokens,t));break}case"em":{s+=t.em(this.parseInline(r.tokens,t));break}case"codespan":{s+=t.codespan(r.text);break}case"br":{s+=t.br();break}case"del":{s+=t.del(this.parseInline(r.tokens,t));break}case"text":{s+=t.text(r.text);break}default:{const l='Token with "'+r.type+'" type was not found.';if(this.options.silent){console.error(l);return}else throw new Error(l)}}}return s}}class _t{constructor(e){this.options=e||Ee}static passThroughHooks=new Set(["preprocess","postprocess"]);preprocess(e){return e}postprocess(e){return e}}class bn{defaults=gs();options=this.setOptions;parse=this.#e(me.lex,ye.parse);parseInline=this.#e(me.lexInline,ye.parseInline);Parser=ye;parser=ye.parse;Renderer=Lt;TextRenderer=ms;Lexer=me;lexer=me.lex;Tokenizer=It;Slugger=ys;Hooks=_t;constructor(...e){this.use(...e)}walkTokens(e,t){let s=[];for(const i of e)switch(s=s.concat(t.call(this,i)),i.type){case"table":{for(const r of i.header)s=s.concat(this.walkTokens(r.tokens,t));for(const r of i.rows)for(const o of r)s=s.concat(this.walkTokens(o.tokens,t));break}case"list":{s=s.concat(this.walkTokens(i.items,t));break}default:this.defaults.extensions&&this.defaults.extensions.childTokens&&this.defaults.extensions.childTokens[i.type]?this.defaults.extensions.childTokens[i.type].forEach(r=>{s=s.concat(this.walkTokens(i[r],t))}):i.tokens&&(s=s.concat(this.walkTokens(i.tokens,t)))}return s}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(s=>{const i={...s};if(i.async=this.defaults.async||i.async||!1,s.extensions&&(s.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if(r.renderer){const o=t.renderers[r.name];o?t.renderers[r.name]=function(...a){let l=r.renderer.apply(this,a);return l===!1&&(l=o.apply(this,a)),l}:t.renderers[r.name]=r.renderer}if(r.tokenizer){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");t[r.level]?t[r.level].unshift(r.tokenizer):t[r.level]=[r.tokenizer],r.start&&(r.level==="block"?t.startBlock?t.startBlock.push(r.start):t.startBlock=[r.start]:r.level==="inline"&&(t.startInline?t.startInline.push(r.start):t.startInline=[r.start]))}r.childTokens&&(t.childTokens[r.name]=r.childTokens)}),i.extensions=t),s.renderer){const r=this.defaults.renderer||new Lt(this.defaults);for(const o in s.renderer){const a=r[o];r[o]=(...l)=>{let h=s.renderer[o].apply(r,l);return h===!1&&(h=a.apply(r,l)),h}}i.renderer=r}if(s.tokenizer){const r=this.defaults.tokenizer||new It(this.defaults);for(const o in s.tokenizer){const a=r[o];r[o]=(...l)=>{let h=s.tokenizer[o].apply(r,l);return h===!1&&(h=a.apply(r,l)),h}}i.tokenizer=r}if(s.hooks){const r=this.defaults.hooks||new _t;for(const o in s.hooks){const a=r[o];_t.passThroughHooks.has(o)?r[o]=l=>{if(this.defaults.async)return Promise.resolve(s.hooks[o].call(r,l)).then(d=>a.call(r,d));const h=s.hooks[o].call(r,l);return a.call(r,h)}:r[o]=(...l)=>{let h=s.hooks[o].apply(r,l);return h===!1&&(h=a.apply(r,l)),h}}i.hooks=r}if(s.walkTokens){const r=this.defaults.walkTokens;i.walkTokens=function(o){let a=[];return a.push(s.walkTokens.call(this,o)),r&&(a=a.concat(r.call(this,o))),a}}this.defaults={...this.defaults,...i}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}#e(e,t){return(s,i,r)=>{typeof i=="function"&&(r=i,i=null);const o={...i};i={...this.defaults,...o};const a=this.#t(i.silent,i.async,r);if(typeof s>"u"||s===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof s!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(s)+", string expected"));if(mn(i,r),i.hooks&&(i.hooks.options=i),r){const l=i.highlight;let h;try{i.hooks&&(s=i.hooks.preprocess(s)),h=e(s,i)}catch(p){return a(p)}const d=p=>{let g;if(!p)try{i.walkTokens&&this.walkTokens(h,i.walkTokens),g=t(h,i),i.hooks&&(g=i.hooks.postprocess(g))}catch(b){p=b}return i.highlight=l,p?a(p):r(null,g)};if(!l||l.length<3||(delete i.highlight,!h.length))return d();let u=0;this.walkTokens(h,p=>{p.type==="code"&&(u++,setTimeout(()=>{l(p.text,p.lang,(g,b)=>{if(g)return d(g);b!=null&&b!==p.text&&(p.text=b,p.escaped=!0),u--,u===0&&d()})},0))}),u===0&&d();return}if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(s):s).then(l=>e(l,i)).then(l=>i.walkTokens?Promise.all(this.walkTokens(l,i.walkTokens)).then(()=>l):l).then(l=>t(l,i)).then(l=>i.hooks?i.hooks.postprocess(l):l).catch(a);try{i.hooks&&(s=i.hooks.preprocess(s));const l=e(s,i);i.walkTokens&&this.walkTokens(l,i.walkTokens);let h=t(l,i);return i.hooks&&(h=i.hooks.postprocess(h)),h}catch(l){return a(l)}}}#t(e,t,s){return i=>{if(i.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const r="<p>An error occurred:</p><pre>"+K(i.message+"",!0)+"</pre>";if(t)return Promise.resolve(r);if(s){s(null,r);return}return r}if(t)return Promise.reject(i);if(s){s(i);return}throw i}}}const Ie=new bn(Ee);function O(n,e,t){return Ie.parse(n,e,t)}O.options=O.setOptions=function(n){return Ie.setOptions(n),O.defaults=Ie.defaults,Pi(O.defaults),O};O.getDefaults=gs;O.defaults=Ee;O.use=function(...n){return Ie.use(...n),O.defaults=Ie.defaults,Pi(O.defaults),O};O.walkTokens=function(n,e){return Ie.walkTokens(n,e)};O.parseInline=Ie.parseInline;O.Parser=ye;O.parser=ye.parse;O.Renderer=Lt;O.TextRenderer=ms;O.Lexer=me;O.lexer=me.lex;O.Tokenizer=It;O.Slugger=ys;O.Hooks=_t;O.parse=O;O.options;O.setOptions;O.use;O.walkTokens;O.parseInline;ye.parse;me.lex;class Sn{scene;repoUrl;readmeUrl;container;buttonBg;overlayEl;confirmEl;buttonText;burgerGraphics;margin=12;size=44;constructor(e,t,s){this.scene=e,this.repoUrl=t,this.readmeUrl=s||"https://raw.githubusercontent.com/m-ko-de/open-td/main/README.md"}create(){const e=this.margin,t=this.size,s=this.scene.cameras.main;let i=s.width-e-t,r=s.height-e-t,o=i+t/2,a=r+t/2;this.buttonBg=this.scene.add.rectangle(o,a,t,t,2236962,.8),this.buttonBg.setStrokeStyle(2,16777215,.06),this.buttonBg.setOrigin(.5),this.buttonBg.setInteractive({useHandCursor:!0}),this.burgerGraphics=this.scene.add.graphics({x:i+10,y:r+12}),this.burgerGraphics.fillStyle(16777215,1),this.burgerGraphics.fillRect(0,0,24,3),this.burgerGraphics.fillRect(0,8,24,3),this.burgerGraphics.fillRect(0,16,24,3),this.buttonText=this.scene.add.text(i-8,a,f("menu.burger"),{font:"12px Arial",color:"#ffffff"}),this.buttonText.setOrigin(1,.5),this.container=this.scene.add.container(0,0,[this.buttonBg,this.burgerGraphics,this.buttonText]),this.container.setDepth(1e3),this.buttonBg.on("pointerdown",()=>{this.openOverlay()}),this.scene.scale.on("resize",this.onResize,this)}onResize(e){try{const t=this.scene.cameras.main,s=this.margin,i=this.size,r=t.width-s-i,o=t.height-s-i,a=r+i/2,l=o+i/2;this.buttonBg&&this.buttonBg.setPosition(a,l),this.burgerGraphics&&this.burgerGraphics.setPosition(r+10,o+12),this.buttonText&&this.buttonText.setPosition(r-8,l)}catch{}}destroy(){try{this.container&&(this.container.removeAll(!0),this.container.destroy())}catch{}try{this.overlayEl&&(this.overlayEl.remove(),this.overlayEl=void 0)}catch{}try{this.scene.scale.off("resize",this.onResize,this)}catch{}}getButton(){return this.buttonBg}async openOverlay(){if(typeof document>"u"){this.showCanvasOverlay("Could not load README (no DOM in this environment)");return}if(!this.overlayEl){const e=document.getElementById("game-container")||document.body,t=document.createElement("div");t.id="opentd-ingame-menu-overlay",t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.right="0",t.style.bottom="0",t.style.zIndex="10000",t.style.background="rgba(0,0,0,0.85)",t.style.color="#fff",t.style.padding="18px",t.style.overflow="auto",t.style.fontFamily="Arial, sans-serif";const s=document.createElement("button");s.textContent=f("menu.close"),s.style.position="fixed",s.style.right="18px",s.style.top="18px",s.style.padding="8px 12px",s.style.cursor="pointer",s.onclick=()=>this.closeOverlay();const i=document.createElement("button");i.textContent=f("menu.source"),i.style.position="fixed",i.style.right="120px",i.style.top="18px",i.style.padding="8px 12px",i.style.cursor="pointer",i.onclick=()=>window.open(this.repoUrl,"_blank");const r=document.createElement("button");r.textContent=f("menu.restart");const o=document.createElement("select");o.style.position="fixed",o.style.right="360px",o.style.top="18px",o.style.padding="6px 8px",o.style.cursor="pointer",ki().forEach(h=>{const d=document.createElement("option");d.value=h.code,d.textContent=h.label,o.appendChild(d)}),o.value=vi(),o.onchange=()=>{const h=o.value;xi(h),s.textContent=f("menu.close"),i.textContent=f("menu.source"),r.textContent=f("menu.restart"),this.buttonText&&this.buttonText.setText(f("menu.burger"))},r.style.position="fixed",r.style.right="240px",r.style.top="18px",r.style.padding="8px 12px",r.style.cursor="pointer",r.onclick=()=>{this.showRestartConfirm()};const l=document.createElement("div");l.style.maxWidth="min(1100px, 95%)",l.style.margin="60px auto 40px auto",l.style.fontSize="14px",l.style.lineHeight="1.4",l.style.background="rgba(0,0,0,0.1)",l.style.padding="12px",l.style.borderRadius="8px",l.style.whiteSpace="pre-wrap",l.style.wordWrap="break-word",l.style.maxWidth="min(1100px, 95%)",l.style.margin="60px auto 40px auto",l.style.fontSize="14px",l.style.lineHeight="1.4",l.style.background="rgba(0,0,0,0.1)",l.style.padding="12px",l.style.borderRadius="8px",t.appendChild(s),t.appendChild(i),t.appendChild(r),t.appendChild(o),t.appendChild(l),e.appendChild(t),this.overlayEl=t;try{const h=await fetch(this.readmeUrl);if(h.ok){const d=await h.text();try{const u=O(d),p=sn.sanitize(u);l.innerHTML=p}catch{l.textContent=d}}else l.textContent=f("menu.readme_load_failed")}catch(h){l.textContent=f("menu.readme_fetch_error",{error:String(h)})}}try{this.scene.scene.pause();try{this.scene.ui?.setPaused?.(!0)}catch{}}catch{}this.overlayEl.style.display="block"}showRestartConfirm(){if(!this.overlayEl||this.confirmEl)return;const e=document.createElement("div");e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.right="0",e.style.bottom="0",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.zIndex="10001";const t=document.createElement("div");t.style.background="#111",t.style.color="#fff",t.style.border="1px solid rgba(255,255,255,0.05)",t.style.padding="18px",t.style.borderRadius="8px",t.style.minWidth="320px",t.style.textAlign="center";const s=document.createElement("div");s.textContent=f("menu.restart_confirm_msg"),s.style.marginBottom="12px";const i=document.createElement("button");i.textContent=f("menu.yes"),i.style.marginRight="8px",i.style.padding="8px 12px",i.onclick=()=>{try{const o=window.restartGame;typeof o=="function"?o():window.location.reload()}catch(o){console.warn("Neustart fehlgeschlagen",o)}finally{this.removeConfirm()}};const r=document.createElement("button");r.textContent=f("menu.cancel"),r.style.padding="8px 12px",r.onclick=()=>this.removeConfirm(),t.appendChild(s),t.appendChild(i),t.appendChild(r),e.appendChild(t),document.body.appendChild(e),this.confirmEl=e}removeConfirm(){if(this.confirmEl){try{this.confirmEl.remove()}catch{}this.confirmEl=void 0}}closeOverlay(){this.overlayEl&&(this.overlayEl.style.display="none");try{this.scene.scene.resume();try{this.scene.ui?.setPaused?.(!1)}catch{}}catch{}}showCanvasOverlay(e){const t=this.scene.cameras.main.width,s=this.scene.cameras.main.height,i=this.scene.add.rectangle(t/2,s/2,t-40,s-40,0,.9),r=this.scene.add.text(t/2,s/2,e,{font:"16px Arial",color:"#ffffff",align:"center",wordWrap:{width:t-80}});r.setOrigin(.5),i.setInteractive({useHandCursor:!0}),i.on("pointerdown",()=>{i.destroy(),r.destroy()})}}class vn{scene;gold;lives;wave;researchManager;statsDisplay;towerButtons;controlButtons;towerActionButtons;researchButton;researchOverlay;inGameMenu;constructor(e,t,s,i){this.scene=e,this.gold=t,this.lives=s,this.wave=0,this.researchManager=i}create(e,t,s,i,r,o,a,l){this.statsDisplay=new Pr(this.scene,this.gold,this.lives,this.wave,this.researchManager.getLevel(),this.researchManager.getXP(),this.researchManager.getXPForNextLevel()),this.towerButtons=new Mr(this.scene,this.gold,this.researchManager,t),this.controlButtons=new Ar(this.scene,e,s,i),this.towerActionButtons=new Ir(this.scene,this.gold,a,l),this.researchButton=new Lr(this.scene,r),this.researchOverlay=new Or(this.scene,this.researchManager,this.gold,h=>{this.gold-=h,this.updateGold(this.gold)},h=>{(h==="frost_tower"||h==="fire_tower")&&this.towerButtons.recreate(),typeof o=="function"&&o(h)}),this.inGameMenu=new Sn(this.scene,"https://github.com/m-ko-de/open-td"),this.inGameMenu.create()}updateGold(e){this.gold=e,this.statsDisplay.updateGold(e),this.towerButtons.updateGold(e),this.towerActionButtons.updateGold(e),this.researchOverlay.updateGold(e)}updateLives(e){this.lives=e,this.statsDisplay.updateLives(e)}updateWave(e){this.wave=e,this.statsDisplay.updateWave(e)}updateXP(e,t){this.statsDisplay.updateXP(e,t,this.researchManager.getXPForNextLevel())}showStartButton(e="Welle Starten"){this.controlButtons.showStartButton(e)}hideStartButton(){this.controlButtons.hideStartButton()}updateButtonStyles(e){this.towerButtons.updateStyles(e)}updateUpgradeButton(e){this.towerActionButtons.updateForTower(e)}getButtons(){return[...this.towerButtons.getButtons(),...this.controlButtons.getButtons(),...this.towerActionButtons.getButtons(),this.researchButton.getButton(),this.inGameMenu?this.inGameMenu.getButton():null]}setPaused(e){this.controlButtons.setPaused(e)}setAutoWave(e){this.controlButtons.setAutoWave(e)}toggleResearchOverlay(){this.researchOverlay.toggle()}showResearchButtonPulse(){this.researchButton.showPulse()}hideResearchButtonPulse(){this.researchButton.hidePulse()}getGold(){return this.gold}getLives(){return this.lives}getWave(){return this.wave}showRoomCode(e){this.statsDisplay.showRoomCode(e)}hideRoomCode(){this.statsDisplay.hideRoomCode()}destroy(){try{this.inGameMenu?.destroy()}catch{}try{this.statsDisplay=null,this.towerButtons=null,this.controlButtons=null,this.towerActionButtons=null,this.researchButton=null,this.researchOverlay=null}catch{}}}class xn{sprite;follower;path;health;maxHealth;speed;baseSpeed;goldReward;xpReward;healthBar;slowEffect=0;slowDuration=0;constructor(e,t,s,i=1,r="normal",o=1){this.path=t,this.follower={t:0,vec:new Phaser.Math.Vector2};const a=this.getTypeStats(r,s,o,i);this.maxHealth=a.health,this.health=this.maxHealth;const h=E.getInstance().getConfig().enemies.baseSpeed;switch(this.baseSpeed=h*a.speedMultiplier,this.speed=this.baseSpeed,this.goldReward=a.gold,this.xpReward=a.xp,this.sprite=e.add.graphics(),r){case"fast":this.createGhostSprite(a.color,a.size);break;case"tank":this.createHeavyMonsterSprite(a.color,a.size);break;case"normal":default:this.createMonsterSprite(a.color,a.size);break}this.healthBar=e.add.graphics(),this.updatePosition(),this.updateHealthBar()}getTypeStats(e,t,s=1,i=1){const r=E.getInstance().getConfig(),o=r.enemies[e],a=r.enemies.healthScaling,l=Math.pow(a.waveMultiplier,Math.floor(t/a.waveInterval)),h=Math.pow(a.levelMultiplier,s-1);let d=1;if(i>1){const p=r.multiplayer;d=1+(i-1)*p.enemyScaling.healthPerPlayer}const u=l*h*d;return{health:Math.round(o.baseHealth*u),speedMultiplier:o.speedMultiplier,gold:o.baseGold+t*o.goldPerWave,xp:o.xpReward,color:parseInt(o.color),size:o.size}}createMonsterSprite(e,t){const s=Phaser.Display.Color.IntegerToColor(e),i=Phaser.Display.Color.GetColor(Math.min(255,Math.floor(s.red*1.3)),Math.min(255,Math.floor(s.green*1.3)),Math.min(255,Math.floor(s.blue*1.3))),r=Phaser.Display.Color.GetColor(Math.floor(s.red*.6),Math.floor(s.green*.6),Math.floor(s.blue*.6));this.sprite.fillStyle(0,.3),this.sprite.fillEllipse(0,t*1.2,t*1.3,t*.5),this.sprite.fillStyle(e,1),this.sprite.fillCircle(0,0,t),this.sprite.fillEllipse(0,t*.3,t*.9,t*.8),this.sprite.fillStyle(i,.7),this.sprite.fillCircle(-t*.3,-t*.4,t*.5),this.sprite.fillStyle(16776960,1),this.sprite.fillCircle(-t*.3,-t*.2,t*.35),this.sprite.fillCircle(t*.3,-t*.2,t*.35),this.sprite.fillStyle(16711680,1),this.sprite.fillCircle(-t*.3,-t*.15,t*.2),this.sprite.fillCircle(t*.3,-t*.15,t*.2),this.sprite.fillStyle(16777215,.8),this.sprite.fillCircle(-t*.25,-t*.25,t*.1),this.sprite.fillCircle(t*.35,-t*.25,t*.1),this.sprite.fillStyle(0,1),this.sprite.fillEllipse(0,t*.4,t*.5,t*.3),this.sprite.fillStyle(16777215,1),this.sprite.fillRect(-t*.2,t*.25,t*.15,t*.25),this.sprite.fillRect(t*.05,t*.25,t*.15,t*.25),this.sprite.fillStyle(r,1),this.sprite.beginPath(),this.sprite.moveTo(-t*.7,-t*.3),this.sprite.lineTo(-t*.5,-t*.8),this.sprite.lineTo(-t*.3,-t*.4),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.beginPath(),this.sprite.moveTo(t*.7,-t*.3),this.sprite.lineTo(t*.5,-t*.8),this.sprite.lineTo(t*.3,-t*.4),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.lineStyle(2,0,1),this.sprite.strokeCircle(0,0,t)}createGhostSprite(e,t){this.sprite.fillStyle(0,.2),this.sprite.fillEllipse(0,t*1.2,t*1,t*.4),this.sprite.fillStyle(e,.8),this.sprite.beginPath(),this.sprite.arc(0,0,t,0,Math.PI,!0),this.sprite.lineTo(t*.6,t*.9),this.sprite.lineTo(t*.3,t*.6),this.sprite.lineTo(0,t*.9),this.sprite.lineTo(-t*.3,t*.6),this.sprite.lineTo(-t*.6,t*.9),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.fillStyle(16777215,.4),this.sprite.fillCircle(-t*.3,-t*.3,t*.6),this.sprite.fillStyle(0,1),this.sprite.fillCircle(-t*.3,-t*.1,t*.3),this.sprite.fillCircle(t*.3,-t*.1,t*.3),this.sprite.fillStyle(e,.6),this.sprite.fillCircle(-t*.3,-t*.1,t*.15),this.sprite.fillCircle(t*.3,-t*.1,t*.15),this.sprite.fillStyle(0,1),this.sprite.fillCircle(0,t*.3,t*.25),this.sprite.lineStyle(2,0,.6),this.sprite.strokeCircle(0,-t*.2,t*.9)}createHeavyMonsterSprite(e,t){const s=Phaser.Display.Color.IntegerToColor(e),i=Phaser.Display.Color.GetColor(Math.floor(s.red*.5),Math.floor(s.green*.5),Math.floor(s.blue*.5));this.sprite.fillStyle(0,.4),this.sprite.fillEllipse(0,t*1.3,t*1.6,t*.6),this.sprite.fillStyle(e,1),this.sprite.fillEllipse(0,t*.2,t*1.2,t*1),this.sprite.fillCircle(0,-t*.3,t*.9),this.sprite.fillStyle(i,1),this.sprite.fillRect(-t*.8,-t*.2,t*.3,t*.8),this.sprite.fillRect(t*.5,-t*.2,t*.3,t*.8),this.sprite.fillRect(-t*.4,t*.5,t*.8,t*.3),this.sprite.fillStyle(4473924,1),this.sprite.beginPath(),this.sprite.moveTo(-t*1,-t*.5),this.sprite.lineTo(-t*.8,-t*1),this.sprite.lineTo(-t*.6,-t*.5),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.beginPath(),this.sprite.moveTo(t*1,-t*.5),this.sprite.lineTo(t*.8,-t*1),this.sprite.lineTo(t*.6,-t*.5),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.fillStyle(16711680,1),this.sprite.fillRect(-t*.45,-t*.4,t*.3,t*.15),this.sprite.fillRect(t*.15,-t*.4,t*.3,t*.15),this.sprite.fillStyle(16737792,.6),this.sprite.fillRect(-t*.5,-t*.45,t*.4,t*.25),this.sprite.fillRect(t*.1,-t*.45,t*.4,t*.25),this.sprite.fillStyle(15658734,1),this.sprite.beginPath(),this.sprite.moveTo(-t*.4,-t*.1),this.sprite.lineTo(-t*.5,t*.4),this.sprite.lineTo(-t*.3,t*.1),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.beginPath(),this.sprite.moveTo(t*.4,-t*.1),this.sprite.lineTo(t*.5,t*.4),this.sprite.lineTo(t*.3,t*.1),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.lineStyle(3,0,1),this.sprite.strokeEllipse(0,t*.2,t*1.2,t*1),this.sprite.strokeCircle(0,-t*.3,t*.9)}update(e){this.slowDuration>0&&(this.slowDuration-=e,this.slowDuration<=0&&(this.slowEffect=0,this.speed=this.baseSpeed));const t=this;t.burnEffect&&(t.burnEffect.update()?t.burnIndicator&&(t.burnIndicator.clear(),t.burnIndicator.fillStyle(16737792,.6),t.burnIndicator.fillCircle(this.sprite.x,this.sprite.y,12)):(t.burnEffect=null,t.burnIndicator&&(t.burnIndicator.destroy(),t.burnIndicator=null))),this.follower.t+=this.speed*e,this.follower.t>=1&&(this.follower.t=1),this.updatePosition()}updatePosition(){this.path.getPoint(this.follower.t,this.follower.vec),this.sprite.x=this.follower.vec.x,this.sprite.y=this.follower.vec.y,this.updateHealthBar()}updateHealthBar(){this.healthBar.clear();const e=30,t=4,s=this.sprite.x-e/2,i=this.sprite.y-25;this.healthBar.fillStyle(0,.5),this.healthBar.fillRect(s,i,e,t);const r=this.health/this.maxHealth*e,o=this.health>this.maxHealth*.5?65280:16711680;this.healthBar.fillStyle(o,1),this.healthBar.fillRect(s,i,r,t)}takeDamage(e){this.health-=e,this.updateHealthBar(),this.health<=0&&(this.health=0)}isDead(){return this.health<=0}reachedEnd(){return this.follower.t>=1}getGoldReward(){return this.goldReward}getHealth(){return this.health}getXPReward(){return this.xpReward}getPosition(){return this.follower.vec}getProgress(){return this.follower.t}get x(){return this.follower.vec.x}get y(){return this.follower.vec.y}applySlow(e,t){e>this.slowEffect&&(this.slowEffect=e,this.slowDuration=t,this.speed=this.baseSpeed*(1-this.slowEffect))}destroy(){this.sprite.destroy(),this.healthBar.destroy();const e=this;e.burnIndicator&&(e.burnIndicator.destroy(),e.burnIndicator=null),e.burnEffect=null}}class kn extends xn{constructor(e,t,s,i=1,r=1){super(e,t,s,r,"normal",i);const o=E.getInstance().getConfig(),a=o.enemies.boss,l=o.enemies.healthScaling,h=Math.pow(l.waveMultiplier,Math.floor(s/l.waveInterval)),d=Math.pow(l.levelMultiplier,i-1);let u=1;if(r>1){const g=o.multiplayer;u=1+(r-1)*g.enemyScaling.healthPerPlayer}const p=h*d*u;this.maxHealth=Math.round(a.baseHealth*p),this.health=this.maxHealth,this.goldReward=a.baseGold+s*a.goldPerWave,this.xpReward=a.baseXp+s*a.xpPerWave,this.baseSpeed=this.baseSpeed*a.speedMultiplier,this.speed=this.baseSpeed,this.sprite.destroy(),this.sprite=e.add.graphics(),this.createBossSprite(),this.updatePosition(),this.updateHealthBar()}createBossSprite(){this.sprite.fillStyle(0,.5),this.sprite.fillEllipse(0,32*1.5,64,32*.8),this.sprite.fillStyle(6684825,1),this.sprite.fillEllipse(0,32*.5,32*1.5,32*1.3),this.sprite.fillStyle(7798954,1),this.sprite.fillCircle(0,-32*.2,32*1.1),this.sprite.fillStyle(8913100,1),this.sprite.fillCircle(0,-32*.8,32*.7),this.sprite.fillStyle(4456550,1),this.sprite.fillRect(-32*1.3,-32*.5,32*.6,32*1.2),this.sprite.fillRect(32*.7,-32*.5,32*.6,32*1.2),this.sprite.fillStyle(3355443,1);for(let t=-1;t<=1;t++)this.sprite.fillRect(t*32*.4-32*.3,-32*.1,32*.5,32*.15);this.sprite.fillStyle(2236962,1);for(let t=0;t<3;t++){const s=(t-1)*32*.3;this.sprite.beginPath(),this.sprite.moveTo(-32*1.5+s,-32*.3),this.sprite.lineTo(-32*1.3+s,-32*1.2),this.sprite.lineTo(-32*1.1+s,-32*.3),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.beginPath(),this.sprite.moveTo(32*1.5-s,-32*.3),this.sprite.lineTo(32*1.3-s,-32*1.2),this.sprite.lineTo(32*1.1-s,-32*.3),this.sprite.closePath(),this.sprite.fillPath()}this.sprite.fillStyle(16755200,1),this.sprite.beginPath(),this.sprite.moveTo(-32*.6,-32*1.1),this.sprite.lineTo(-32*.4,-32*1.7),this.sprite.lineTo(-32*.2,-32),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.beginPath(),this.sprite.moveTo(32*.6,-32*1.1),this.sprite.lineTo(32*.4,-32*1.7),this.sprite.lineTo(32*.2,-32),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.beginPath(),this.sprite.moveTo(-32*.15,-32*1.2),this.sprite.lineTo(0,-32*1.9),this.sprite.lineTo(32*.15,-32*1.2),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.fillStyle(16711680,1),this.sprite.fillCircle(-32*.25,-32*.8,32*.25),this.sprite.fillCircle(32*.25,-32*.8,32*.25),this.sprite.fillStyle(16737792,.8),this.sprite.fillCircle(-32*.25,-32*.8,32*.35),this.sprite.fillCircle(32*.25,-32*.8,32*.35),this.sprite.fillStyle(16776960,.9),this.sprite.fillCircle(-32*.25,-32*.8,32*.15),this.sprite.fillCircle(32*.25,-32*.8,32*.15),this.sprite.fillStyle(16777215,1);for(let t=0;t<4;t++){const s=(t-1.5)*32*.25;this.sprite.beginPath(),this.sprite.moveTo(s-32*.08,-32*.3),this.sprite.lineTo(s,32*.2),this.sprite.lineTo(s+32*.08,-32*.3),this.sprite.closePath(),this.sprite.fillPath()}this.sprite.lineStyle(4,16711935,.3),this.sprite.strokeCircle(0,0,32*1.6),this.sprite.lineStyle(2,16711935,.5),this.sprite.strokeCircle(0,0,32*1.7),this.sprite.lineStyle(3,0,1),this.sprite.strokeCircle(0,0,32),this.sprite.lineStyle(2,16776960,.4),this.sprite.strokeCircle(0,0,32*1.1),this.sprite.lineStyle(1,16746496,.3),this.sprite.strokeCircle(0,0,32*1.2)}updateHealthBar(){this.healthBar.clear();const e=50,t=6,s=this.sprite.x-e/2,i=this.sprite.y-35;this.healthBar.fillStyle(0,.8),this.healthBar.fillRect(s,i,e,t);const r=this.health/this.maxHealth*e,o=this.health>this.maxHealth*.5?16737792:16711680;this.healthBar.fillStyle(o,1),this.healthBar.fillRect(s,i,r,t),this.healthBar.lineStyle(1,16776960,1),this.healthBar.strokeRect(s,i,e,t)}}class Ge{sprite;scene;follower;path;health;maxHealth;speed;baseSpeed;goldReward;xpReward;healthBar;slowEffect=0;slowDuration=0;wave;playerCount;constructor(e,t,s,i=1,r=1){this.scene=e,this.path=t,this.wave=s,this.playerCount=i,this.follower={t:0,vec:new Phaser.Math.Vector2};const o=this.calculateStats(s,r,i);this.maxHealth=o.health,this.health=this.maxHealth;const l=E.getInstance().getConfig().enemies.baseSpeed;this.baseSpeed=l*o.speedMultiplier,this.speed=this.baseSpeed,this.goldReward=o.gold,this.xpReward=o.xp,this.sprite=e.add.graphics(),this.createSprite(o.color,o.size),this.healthBar=e.add.graphics(),this.updatePosition(),this.updateHealthBar()}onUpdate(e,t){}onTakeDamage(e){return e}onDeath(){return[]}calculateStats(e,t=1,s=1){const i=E.getInstance().getConfig(),r=this.getEnemyConfig(),o=i.enemies.healthScaling,a=Math.pow(o.waveMultiplier,Math.floor(e/o.waveInterval)),l=Math.pow(o.levelMultiplier,t-1);let h=1;if(s>1){const u=i.multiplayer;h=1+(s-1)*u.enemyScaling.healthPerPlayer}const d=a*l*h;return{health:Math.round(r.baseHealth*d),speedMultiplier:r.speedMultiplier,gold:r.baseGold+e*r.goldPerWave,xp:r.xpReward,color:parseInt(r.color),size:r.size}}update(e,t){this.slowDuration>0&&(this.slowDuration-=e,this.slowDuration<=0&&(this.slowEffect=0,this.speed=this.baseSpeed));const s=this;s.burnEffect&&(s.burnEffect.update()?s.burnIndicator&&(s.burnIndicator.clear(),s.burnIndicator.fillStyle(16737792,.6),s.burnIndicator.fillCircle(this.sprite.x,this.sprite.y,12)):(s.burnEffect=null,s.burnIndicator&&(s.burnIndicator.destroy(),s.burnIndicator=null))),this.onUpdate(e,t),this.follower.t+=this.speed*e,this.follower.t>=1&&(this.follower.t=1),this.updatePosition()}updatePosition(){this.path.getPoint(this.follower.t,this.follower.vec),this.sprite.x=this.follower.vec.x,this.sprite.y=this.follower.vec.y,this.updateHealthBar()}updateHealthBar(){this.healthBar.clear();const e=30,t=4,s=this.sprite.x-e/2,i=this.sprite.y-25;this.healthBar.fillStyle(0,.5),this.healthBar.fillRect(s,i,e,t);const r=this.health/this.maxHealth*e,o=this.health>this.maxHealth*.5?65280:16711680;this.healthBar.fillStyle(o,1),this.healthBar.fillRect(s,i,r,t)}takeDamage(e){const t=this.onTakeDamage(e);return this.health-=t,this.updateHealthBar(),this.showFloatingDamage(t),this.sprite.setAlpha&&this.sprite.setAlpha(.5),this.scene.tweens?.add&&this.scene.tweens.add({targets:this.sprite,alpha:1,duration:100,ease:"Power2"}),this.health<=0?(this.health=0,this.playDeathAnimation(),this.onDeath()):[]}showFloatingDamage(e){if(!this.scene.add.text||!this.scene.tweens?.add)return;const t=this.scene.add.text(this.sprite.x,this.sprite.y-20,Math.round(e).toString(),{fontSize:"16px",color:"#ff4444",fontStyle:"bold",stroke:"#000000",strokeThickness:3});t.setOrigin(.5),t.setDepth&&t.setDepth(100),this.scene.tweens.add({targets:t,y:t.y-30,alpha:0,duration:800,ease:"Power2",onComplete:()=>t.destroy()})}playDeathAnimation(){if(!this.scene.tweens?.add)return;const e=this.calculateStats(this.wave,1,this.playerCount);for(let t=0;t<15;t++){const s=this.scene.add.graphics(),i=2+Math.random()*4;s.fillStyle(e.color,.8),s.fillCircle(0,0,i),s.x=this.sprite.x,s.y=this.sprite.y,s.setDepth&&s.setDepth(95);const r=Math.random()*Math.PI*2,o=20+Math.random()*40;this.scene.tweens.add({targets:s,x:s.x+Math.cos(r)*o,y:s.y+Math.sin(r)*o,alpha:0,scale:.2,duration:400+Math.random()*400,ease:"Power2",onComplete:()=>s.destroy()})}this.sprite.clear(),this.sprite.fillStyle(16777215,.8),this.sprite.fillCircle(0,0,e.size),this.scene.tweens.add({targets:this.sprite,alpha:0,scale:1.5,duration:300,ease:"Power2"})}isDead(){return this.health<=0}reachedEnd(){return this.follower.t>=1}getGoldReward(){return this.goldReward}getHealth(){return this.health}getMaxHealth(){return this.maxHealth}getXPReward(){return this.xpReward}getPosition(){return this.follower.vec}getProgress(){return this.follower.t}get x(){return this.follower.vec.x}get y(){return this.follower.vec.y}applySlow(e,t){e>this.slowEffect&&(this.slowEffect=e,this.slowDuration=t,this.speed=this.baseSpeed*(1-this.slowEffect))}destroy(){this.sprite.destroy(),this.healthBar.destroy();const e=this;e.burnIndicator&&(e.burnIndicator.destroy(),e.burnIndicator=null),e.burnEffect=null}}class ni extends Ge{getEnemyConfig(){return E.getInstance().getConfig().enemies.normal}createSprite(e,t){const s=Phaser.Display.Color.IntegerToColor(e),i=Phaser.Display.Color.GetColor(Math.min(255,Math.floor(s.red*1.3)),Math.min(255,Math.floor(s.green*1.3)),Math.min(255,Math.floor(s.blue*1.3))),r=Phaser.Display.Color.GetColor(Math.floor(s.red*.6),Math.floor(s.green*.6),Math.floor(s.blue*.6));this.sprite.fillStyle(0,.3),this.sprite.fillEllipse(0,t*1.2,t*1.3,t*.5),this.sprite.fillStyle(e,1),this.sprite.fillCircle(0,0,t),this.sprite.fillEllipse(0,t*.3,t*.9,t*.8),this.sprite.fillStyle(i,.7),this.sprite.fillCircle(-t*.3,-t*.4,t*.5),this.sprite.fillStyle(16776960,1),this.sprite.fillCircle(-t*.3,-t*.2,t*.35),this.sprite.fillCircle(t*.3,-t*.2,t*.35),this.sprite.fillStyle(16711680,1),this.sprite.fillCircle(-t*.3,-t*.15,t*.2),this.sprite.fillCircle(t*.3,-t*.15,t*.2),this.sprite.fillStyle(16777215,.8),this.sprite.fillCircle(-t*.25,-t*.25,t*.1),this.sprite.fillCircle(t*.35,-t*.25,t*.1),this.sprite.fillStyle(0,1),this.sprite.fillEllipse(0,t*.4,t*.5,t*.3),this.sprite.fillStyle(16777215,1),this.sprite.fillRect(-t*.2,t*.25,t*.15,t*.25),this.sprite.fillRect(t*.05,t*.25,t*.15,t*.25),this.sprite.fillStyle(r,1),this.sprite.beginPath(),this.sprite.moveTo(-t*.7,-t*.3),this.sprite.lineTo(-t*.5,-t*.8),this.sprite.lineTo(-t*.3,-t*.4),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.beginPath(),this.sprite.moveTo(t*.7,-t*.3),this.sprite.lineTo(t*.5,-t*.8),this.sprite.lineTo(t*.3,-t*.4),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.lineStyle(2,0,1),this.sprite.strokeCircle(0,0,t)}}class Tn extends Ge{getEnemyConfig(){return E.getInstance().getConfig().enemies.fast}createSprite(e,t){this.sprite.fillStyle(0,.2),this.sprite.fillEllipse(0,t*1.2,t*1,t*.4),this.sprite.fillStyle(e,.8),this.sprite.beginPath(),this.sprite.arc(0,0,t,0,Math.PI,!0),this.sprite.lineTo(t*.6,t*.9),this.sprite.lineTo(t*.3,t*.6),this.sprite.lineTo(0,t*.9),this.sprite.lineTo(-t*.3,t*.6),this.sprite.lineTo(-t*.6,t*.9),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.fillStyle(16777215,.4),this.sprite.fillCircle(-t*.3,-t*.3,t*.6),this.sprite.fillStyle(0,1),this.sprite.fillCircle(-t*.3,-t*.1,t*.3),this.sprite.fillCircle(t*.3,-t*.1,t*.3),this.sprite.fillStyle(e,.6),this.sprite.fillCircle(-t*.3,-t*.1,t*.15),this.sprite.fillCircle(t*.3,-t*.1,t*.15),this.sprite.fillStyle(0,1),this.sprite.fillCircle(0,t*.3,t*.25),this.sprite.lineStyle(2,0,.6),this.sprite.strokeCircle(0,-t*.2,t*.9)}}class _n extends Ge{getEnemyConfig(){return E.getInstance().getConfig().enemies.tank}createSprite(e,t){const s=Phaser.Display.Color.IntegerToColor(e),i=Phaser.Display.Color.GetColor(Math.floor(s.red*.5),Math.floor(s.green*.5),Math.floor(s.blue*.5));this.sprite.fillStyle(0,.4),this.sprite.fillEllipse(0,t*1.3,t*1.6,t*.6),this.sprite.fillStyle(e,1),this.sprite.fillEllipse(0,t*.2,t*1.2,t*1),this.sprite.fillCircle(0,-t*.3,t*.9),this.sprite.fillStyle(i,1),this.sprite.fillRect(-t*.8,-t*.2,t*.3,t*.8),this.sprite.fillRect(t*.5,-t*.2,t*.3,t*.8),this.sprite.fillRect(-t*.4,t*.5,t*.8,t*.3),this.sprite.fillStyle(4473924,1),this.sprite.beginPath(),this.sprite.moveTo(-t*1,-t*.5),this.sprite.lineTo(-t*.8,-t*1),this.sprite.lineTo(-t*.6,-t*.5),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.beginPath(),this.sprite.moveTo(t*1,-t*.5),this.sprite.lineTo(t*.8,-t*1),this.sprite.lineTo(t*.6,-t*.5),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.fillStyle(16711680,1),this.sprite.fillRect(-t*.45,-t*.4,t*.3,t*.15),this.sprite.fillRect(t*.15,-t*.4,t*.3,t*.15),this.sprite.fillStyle(16737792,.6),this.sprite.fillRect(-t*.5,-t*.45,t*.4,t*.25),this.sprite.fillRect(t*.1,-t*.45,t*.4,t*.25),this.sprite.fillStyle(15658734,1),this.sprite.beginPath(),this.sprite.moveTo(-t*.4,-t*.1),this.sprite.lineTo(-t*.5,t*.4),this.sprite.lineTo(-t*.3,t*.1),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.beginPath(),this.sprite.moveTo(t*.4,-t*.1),this.sprite.lineTo(t*.5,t*.4),this.sprite.lineTo(t*.3,t*.1),this.sprite.closePath(),this.sprite.fillPath(),this.sprite.lineStyle(3,0,1),this.sprite.strokeEllipse(0,t*.2,t*1.2,t*1),this.sprite.strokeCircle(0,-t*.3,t*.9)}}class Cn extends Ge{shield;maxShield;shieldRegenDelay=3e3;lastDamageTime=0;shieldIndicator=null;constructor(e,t,s,i=1,r=1){super(e,t,s,i,r),this.maxShield=Math.round(this.maxHealth*.5),this.shield=this.maxShield,this.shieldIndicator=e.add.graphics(),this.updateShieldIndicator()}getEnemyConfig(){return{baseHealth:60,speedMultiplier:1,baseGold:12,goldPerWave:2,xpReward:12,color:"0x4dabf7",size:12}}createSprite(e,t){this.sprite.fillStyle(0,.3),this.sprite.fillEllipse(0,t*1.2,t*1.3,t*.5),this.sprite.fillStyle(e,1),this.sprite.fillCircle(0,0,t*.8),this.sprite.fillStyle(7651580,1),this.sprite.fillCircle(0,-t,t*.3),this.sprite.fillCircle(0,t,t*.3),this.sprite.fillCircle(-t,0,t*.3),this.sprite.fillCircle(t,0,t*.3),this.sprite.lineStyle(2,10868991,.8),this.sprite.beginPath(),this.sprite.moveTo(0,-t),this.sprite.lineTo(t,0),this.sprite.lineTo(0,t),this.sprite.lineTo(-t,0),this.sprite.closePath(),this.sprite.strokePath(),this.sprite.fillStyle(1667522,1),this.sprite.fillCircle(0,0,t*.4),this.sprite.fillStyle(16777215,.6),this.sprite.fillCircle(0,0,t*.2),this.sprite.lineStyle(2,820633,1),this.sprite.strokeCircle(0,0,t*.8)}onUpdate(e,t){const s=Date.now();this.shield<this.maxShield&&s-this.lastDamageTime>this.shieldRegenDelay&&(this.shield=Math.min(this.maxShield,this.shield+this.maxShield*.1*(e/1e3))),this.updateShieldIndicator()}onTakeDamage(e){if(this.lastDamageTime=Date.now(),this.shield>0){const t=Math.min(this.shield,e);this.shield-=t;const s=e-t;return this.shieldIndicator&&this.scene.tweens.add({targets:this.shieldIndicator,alpha:.3,duration:100,yoyo:!0}),s}return e}updateShieldIndicator(){if(this.shieldIndicator&&(this.shieldIndicator.clear(),this.shield>0)){const t=this.shield/this.maxShield;this.shieldIndicator.lineStyle(2,5090295,.6*t),this.shieldIndicator.strokeCircle(this.sprite.x,this.sprite.y,16);const s=[];for(let i=0;i<6;i++){const r=Math.PI/3*i-Math.PI/2,o=this.sprite.x+Math.cos(r)*16*t,a=this.sprite.y+Math.sin(r)*16*t;s.push(o,a)}this.shieldIndicator.fillStyle(5090295,.2*t),this.shieldIndicator.fillPoints(s,!0)}}updateHealthBar(){if(super.updateHealthBar(),this.shield>0){const s=this.sprite.x-15,i=this.sprite.y-30,r=this.shield/this.maxShield*30;this.healthBar.fillStyle(5090295,.8),this.healthBar.fillRect(s,i,r,3)}}destroy(){this.shieldIndicator&&(this.shieldIndicator.destroy(),this.shieldIndicator=null),super.destroy()}}class Rn extends Ge{damageReduction=.5;armorPlating=null;constructor(e,t,s,i=1,r=1){super(e,t,s,i,r),this.armorPlating=e.add.graphics(),this.updateArmorIndicator()}getEnemyConfig(){return{baseHealth:80,speedMultiplier:.7,baseGold:15,goldPerWave:3,xpReward:15,color:"0x868e96",size:14}}createSprite(e,t){this.sprite.fillStyle(0,.4),this.sprite.fillEllipse(0,t*1.3,t*1.4,t*.6),this.sprite.fillStyle(e,1),this.sprite.fillCircle(0,0,t);const s=4804695,i=11384253,r=3422784;this.sprite.fillStyle(s,1),this.sprite.fillRect(-t*.7,-t*.5,t*1.4,t),this.sprite.fillStyle(r,1);for(let o=-1;o<=1;o++)for(let a=-1;a<=1;a++)this.sprite.fillCircle(o*t*.5,a*t*.3,t*.1);this.sprite.fillStyle(s,1),this.sprite.fillRect(-t*1.1,-t*.7,t*.5,t*.8),this.sprite.fillRect(t*.6,-t*.7,t*.5,t*.8),this.sprite.fillStyle(i,.6),this.sprite.fillRect(-t*.6,-t*.4,t*.3,t*.2),this.sprite.fillRect(t*.3,-t*.4,t*.3,t*.2),this.sprite.fillStyle(16739179,1),this.sprite.fillRect(-t*.45,-t*.2,t*.3,t*.15),this.sprite.fillRect(t*.15,-t*.2,t*.3,t*.15),this.sprite.fillStyle(16746375,.5),this.sprite.fillRect(-t*.5,-t*.25,t*.4,t*.25),this.sprite.fillRect(t*.1,-t*.25,t*.4,t*.25),this.sprite.lineStyle(3,2172201,1),this.sprite.strokeCircle(0,0,t),this.sprite.strokeRect(-t*.7,-t*.5,t*1.4,t)}onTakeDamage(e){const t=e*(1-this.damageReduction);if(this.scene){const s=this.scene.add.graphics();s.fillStyle(16766011,1),s.fillCircle(this.sprite.x,this.sprite.y-10,3),this.scene.tweens.add({targets:s,alpha:0,y:s.y-20,duration:300,onComplete:()=>s.destroy()})}return t}updateArmorIndicator(){if(!this.armorPlating)return;this.armorPlating.clear();const e=this.sprite.x,t=this.sprite.y-22,s=4;this.armorPlating.fillStyle(8818326,.8),this.armorPlating.beginPath(),this.armorPlating.moveTo(e,t-s),this.armorPlating.lineTo(e-s,t),this.armorPlating.lineTo(e-s,t+s),this.armorPlating.lineTo(e+s,t+s),this.armorPlating.lineTo(e+s,t),this.armorPlating.closePath(),this.armorPlating.fillPath()}updatePosition(){super.updatePosition(),this.updateArmorIndicator()}destroy(){this.armorPlating&&(this.armorPlating.destroy(),this.armorPlating=null),super.destroy()}}class En extends Ge{healRadius=100;healAmount=5;healCooldown=1e3;lastHealTime=0;healIndicator=null;pulseAnimation=0;constructor(e,t,s,i=1,r=1){super(e,t,s,i,r),this.healIndicator=e.add.graphics()}getEnemyConfig(){return{baseHealth:40,speedMultiplier:.8,baseGold:20,goldPerWave:4,xpReward:20,color:"0x51cf66",size:11}}createSprite(e,t){this.sprite.fillStyle(0,.3),this.sprite.fillEllipse(0,t*1.2,t*1.3,t*.5),this.sprite.fillStyle(e,1),this.sprite.fillCircle(0,0,t),this.sprite.fillStyle(9234842,.7),this.sprite.fillCircle(-t*.3,-t*.3,t*.6);const s=16777215,i=t*.3,r=t*.8;this.sprite.fillStyle(s,1),this.sprite.fillRect(-i/2,-r/2,i,r),this.sprite.fillRect(-r/2,-i/2,r,i),this.sprite.fillStyle(16739179,1),this.sprite.fillRect(-i/4,-r/2.5,i/2,r/1.5),this.sprite.fillRect(-r/2.5,-i/4,r/1.5,i/2),this.sprite.fillStyle(3120708,1),this.sprite.fillCircle(-t*.4,-t*.1,t*.2),this.sprite.fillCircle(t*.4,-t*.1,t*.2),this.sprite.fillStyle(16777215,.8),this.sprite.fillCircle(-t*.35,-t*.15,t*.1),this.sprite.fillCircle(t*.45,-t*.15,t*.1),this.sprite.lineStyle(2,3120708,1),this.sprite.beginPath(),this.sprite.arc(0,t*.3,t*.4,0,Math.PI,!1),this.sprite.strokePath(),this.sprite.lineStyle(2,2853438,1),this.sprite.strokeCircle(0,0,t)}onUpdate(e,t){const s=Date.now();this.pulseAnimation+=e*.003,this.pulseAnimation>Math.PI*2&&(this.pulseAnimation-=Math.PI*2),this.updateHealIndicator(),s-this.lastHealTime>this.healCooldown&&t&&(this.lastHealTime=s,this.healNearbyAllies(t,e))}healNearbyAllies(e,t){let s=0;for(const i of e){if(i===this||i.isDead())continue;if(Phaser.Math.Distance.Between(this.x,this.y,i.x,i.y)<=this.healRadius){const o=i.getHealth(),a=i.getMaxHealth();if(o<a){const l=Math.min(this.healAmount,a-o);i.health=Math.min(a,o+l),i.updateHealthBar(),this.createHealParticle(i.x,i.y),s++}}}s>0&&this.createHealWave()}createHealParticle(e,t){if(!this.scene)return;const s=this.scene.add.graphics();s.fillStyle(5361510,.8),s.fillCircle(0,0,3),s.setPosition(this.sprite.x,this.sprite.y),this.scene.tweens.add({targets:s,x:e,y:t,alpha:0,duration:400,ease:"Cubic.Out",onComplete:()=>s.destroy()})}createHealWave(){if(!this.scene)return;const e=this.scene.add.graphics();e.lineStyle(2,5361510,.6),e.strokeCircle(this.sprite.x,this.sprite.y,5),this.scene.tweens.add({targets:e,alpha:0,duration:600,onUpdate:()=>{e.clear(),e.lineStyle(2,5361510,e.alpha*.6);const t=5+(1-e.alpha)*this.healRadius;e.strokeCircle(this.sprite.x,this.sprite.y,t)},onComplete:()=>e.destroy()})}updateHealIndicator(){if(!this.healIndicator)return;this.healIndicator.clear();const e=5+Math.sin(this.pulseAnimation)*2;this.healIndicator.lineStyle(1,5361510,.3+Math.sin(this.pulseAnimation)*.2),this.healIndicator.strokeCircle(this.sprite.x,this.sprite.y,this.healRadius*.3);const t=this.sprite.x,s=this.sprite.y-22;this.healIndicator.fillStyle(5361510,.8),this.healIndicator.fillRect(t-e,s-1,e*2,2),this.healIndicator.fillRect(t-1,s-e,2,e*2)}updatePosition(){super.updatePosition()}destroy(){this.healIndicator&&(this.healIndicator.destroy(),this.healIndicator=null),super.destroy()}}class oi{static createEnemy(e,t,s,i,r=1,o=1){switch(s){case"normal":return new ni(e,t,i,r,o);case"fast":return new Tn(e,t,i,r,o);case"tank":return new _n(e,t,i,r,o);case"shielded":return new Cn(e,t,i,r,o);case"armored":return new Rn(e,t,i,r,o);case"healing":return new En(e,t,i,r,o);default:return console.warn(`Unknown enemy type: ${s}, defaulting to normal`),new ni(e,t,i,r,o)}}static getRandomType(e){if(e<=3)return Math.random()<.7?"normal":"fast";if(e<=7){const s=Math.random();return s<.5?"normal":s<.75?"fast":"tank"}if(e<=12){const s=Math.random();return s<.35?"normal":s<.6?"fast":s<.8?"tank":"shielded"}if(e<=18){const s=Math.random();return s<.25?"normal":s<.45?"fast":s<.65?"tank":s<.85?"shielded":"armored"}const t=Math.random();return t<.2?"normal":t<.35?"fast":t<.5?"tank":t<.65?"shielded":t<.8?"armored":"healing"}static getWaveComposition(e,t){const s=[];if(e%10===0){for(let i=0;i<t;i++)s.push("normal");return s}if(e%5===0&&e>5&&e>=19){const i=Math.min(2,Math.floor(t*.15));for(let r=0;r<i;r++)s.push("healing");for(let r=i;r<t;r++)s.push(Math.random()<.5?"tank":"armored");return s}for(let i=0;i<t;i++)s.push(this.getRandomType(e));return s}}class Pn{scene;path;enemies=[];wave=0;isSpawning=!1;waveComplete=!1;playerLevel=1;playerCount=1;constructor(e,t,s="classic"){this.scene=e,this.path=t}setPlayerCount(e){this.playerCount=Math.max(1,e)}setPlayerLevel(e){this.playerLevel=e}startWave(){if(this.isSpawning)return;this.isSpawning=!0,this.waveComplete=!1,this.wave++;const e=E.getInstance().getConfig().waves;if(this.wave%e.bossInterval===0){let s=Math.max(1,Math.floor(this.wave/e.bossInterval));if(this.playerCount>1){const r=E.getInstance().getConfig().multiplayer,o=1+(this.playerCount-1)*r.enemyScaling.countPerPlayer;s=Math.max(1,Math.round(s*o))}const i=e.bossSpawnDelay;for(let r=0;r<s;r++)this.scene.time.delayedCall(r*i,()=>{const o=new kn(this.scene,this.path,this.wave,this.playerLevel,this.playerCount);this.enemies.push(o)});this.scene.time.delayedCall((s-1)*i+100,()=>{this.isSpawning=!1})}else{const s=fs.getSettings(),i=e.difficulty[s.difficulty]||e.difficulty.normal,r=i.baseEnemies,o=i.enemyMultiplier;let a=r+this.wave*o;if(this.playerCount>1){const d=E.getInstance().getConfig().multiplayer,u=1+(this.playerCount-1)*d.enemyScaling.countPerPlayer;a=Math.round(a*u)}const l=Math.max(e.spawnDelay.minimum,e.spawnDelay.base-this.wave*e.spawnDelay.reduction),h=oi.getWaveComposition(this.wave,a);for(let d=0;d<a;d++)this.scene.time.delayedCall(d*l,()=>{const u=h[d]||"normal",p=oi.createEnemy(this.scene,this.path,u,this.wave,this.playerCount,this.playerLevel);this.enemies.push(p)});this.scene.time.delayedCall((a-1)*l+100,()=>{this.isSpawning=!1})}}update(e,t,s,i){const r=[];this.enemies=this.enemies.filter(o=>{if(o.update(e,this.enemies),o.isDead()){t(o.getGoldReward(),o.getXPReward());const a=o.takeDamage(0);return r.push(...a),o.destroy(),!1}return o.reachedEnd()?(s(),o.destroy(),!1):!0}),this.enemies.push(...r),this.enemies.length===0&&this.wave>0&&!this.waveComplete&&!this.isSpawning&&(this.waveComplete=!0,i&&i(this.wave))}getEnemies(){return this.enemies}getWave(){return this.wave}isWaveComplete(){return this.waveComplete}isSpawningEnemies(){return this.isSpawning}resetWaveComplete(){this.waveComplete=!1}markWaveComplete(){this.waveComplete=!0}cleanup(){this.enemies.forEach(e=>e.destroy()),this.enemies=[]}}class Le{id;towerType;sprite;scene;rangeCircle;showRange=!1;upgradeLevelText;x;y;range;damage;fireRate;baseDamage;baseFireRate;upgradeLevel=1;buildCost;totalInvested;lastFired=0;currentRotation=0;targetRotation=0;constructor(e,t,s,i,r){this.scene=e,this.x=t,this.y=s,this.towerType=i,this.buildCost=r,this.totalInvested=r;const o=E.getInstance().getTowerConfig(i);if(!o)throw new Error(`Tower config not found for type: ${i}`);this.range=o.range,this.baseDamage=o.damage,this.baseFireRate=o.fireRate,this.damage=this.baseDamage,this.fireRate=this.baseFireRate,this.createSprite(),this.upgradeLevelText=this.scene.add.text(this.x,this.y-30,"1",{fontSize:"14px",color:"#ffffff",backgroundColor:"#000000",padding:{x:4,y:2}}).setOrigin(.5).setDepth(100),this.rangeCircle=e.add.graphics(),this.updateRangeCircle(),this.sprite.setInteractive(new Phaser.Geom.Circle(0,0,20),Phaser.Geom.Circle.Contains),this.sprite.on("pointerover",()=>{this.showRange=!0,this.updateRangeCircle()}),this.sprite.on("pointerout",()=>{this.showRange=!1,this.updateRangeCircle()})}findTarget(e){let t=null,s=-1;if(!Array.isArray(e)||e.length===0)return null;for(const i of e){if(i.isDead())continue;if(Phaser.Math.Distance.Between(this.x,this.y,i.x,i.y)<=this.range){const o=this.calculateTargetValue(i);o>s&&(s=o,t=i)}}return t}calculateTargetValue(e){return e.getProgress()}update(e,t){if(Math.abs(this.targetRotation-this.currentRotation)>.01){const r=this.targetRotation-this.currentRotation;this.currentRotation+=r*.15,this.sprite.setRotation&&this.sprite.setRotation(this.currentRotation)}if(e-this.lastFired<this.fireRate)return null;const s=Array.isArray(t)?t:[],i=this.findTarget(s);if(i){this.targetRotation=Math.atan2(i.y-this.y,i.x-this.x)+Math.PI/2,this.createMuzzleFlash(),Ae.getInstance().playTower(this.towerType);const r=this.fireAtTarget(i,s);return this.lastFired=e,r}return null}createMuzzleFlash(){if(!this.scene.tweens?.add)return;const e=this.scene.add.graphics();e.fillStyle(16776960,.8),e.fillCircle(0,0,8),e.x=this.x,e.y=this.y-15,e.setDepth&&e.setDepth(99),this.scene.tweens.add({targets:e,alpha:0,scale:1.5,duration:150,ease:"Power2",onComplete:()=>e.destroy()});for(let t=0;t<3;t++){const s=this.scene.add.graphics();s.fillStyle(16746496,.6),s.fillCircle(0,0,3),s.x=this.x,s.y=this.y-15,s.setDepth&&s.setDepth(99);const i=Math.random()*Math.PI*2,r=20+Math.random()*30;this.scene.tweens.add({targets:s,x:s.x+Math.cos(i)*r,y:s.y+Math.sin(i)*r,alpha:0,scale:.5,duration:200+Math.random()*200,ease:"Power2",onComplete:()=>s.destroy()})}}upgrade(){const e=this.getUpgradeCost();return this.upgradeLevel++,this.totalInvested+=e,this.damage=Math.round(this.baseDamage*Math.pow(1.2,this.upgradeLevel-1)),this.fireRate=Math.round(this.baseFireRate*Math.pow(.9,this.upgradeLevel-1)),this.upgradeLevelText.setText(this.upgradeLevel.toString()),e}applyDamageMultiplier(e){this.baseDamage=Math.round(this.baseDamage*e),this.damage=Math.round(this.damage*e)}applyRangeMultiplier(e){this.range=Math.round(this.range*e)}canUpgrade(){return this.upgradeLevel<5}getUpgradeCost(){return Math.round(this.buildCost*Math.pow(1.5,this.upgradeLevel-1))}getSellValue(){return Math.round(this.totalInvested*.7)}updateRangeCircle(){this.rangeCircle.clear(),this.showRange&&(this.rangeCircle.lineStyle(2,16777215,.5),this.rangeCircle.strokeCircle(this.x,this.y,this.range),this.rangeCircle.fillStyle(16777215,.1),this.rangeCircle.fillCircle(this.x,this.y,this.range))}setShowRange(e){this.showRange=e,this.updateRangeCircle()}destroy(){this.sprite.destroy(),this.rangeCircle.destroy(),this.upgradeLevelText.destroy()}getSprite(){return this.sprite}getRange(){return this.range}getDamage(){return this.damage}getUpgradeLevel(){return this.upgradeLevel}getType(){return this.towerType}getTotalInvested(){return this.totalInvested}}class ot{sprite;scene;target;damage;speed=.3;x;y;rotation=0;hasHit=!1;isFrost=!1;slowAmount=0;slowDuration=0;splashRadius=0;allEnemies=[];trailParticles=[];constructor(e,t,s,i,r,o=!1,a=0,l=0,h=0,d=[]){if(this.scene=e,this.x=t,this.y=s,this.target=i,this.damage=r,this.isFrost=o,this.slowAmount=a,this.slowDuration=l,this.splashRadius=h,this.allEnemies=d,this.sprite=e.add.graphics(),o){this.sprite.fillStyle(8978431,.3),this.sprite.fillCircle(0,0,8),this.sprite.fillStyle(65535,.6),this.sprite.fillCircle(0,0,6),this.sprite.fillStyle(16777215,1),this.sprite.fillCircle(0,0,4),this.sprite.lineStyle(2,16777215,.8);for(let u=0;u<6;u++){const p=u/6*Math.PI*2,g=Math.cos(p)*6,b=Math.sin(p)*6;this.sprite.lineBetween(0,0,g,b)}}else this.sprite.fillStyle(16746496,.3),this.sprite.fillCircle(0,0,10),this.sprite.fillStyle(16755200,.6),this.sprite.fillCircle(0,0,7),this.sprite.fillStyle(16776960,1),this.sprite.beginPath?(this.sprite.beginPath(),this.sprite.moveTo(8,0),this.sprite.lineTo(-4,-4),this.sprite.lineTo(-2,0),this.sprite.lineTo(-4,4),this.sprite.closePath(),this.sprite.fillPath()):this.sprite.fillCircle(0,0,5),this.sprite.fillStyle(16777215,.9),this.sprite.fillCircle(0,0,3),this.sprite.fillStyle(16777215,.6),this.sprite.fillCircle(4,0,2);this.sprite.x=t,this.sprite.y=s}update(e){if(this.hasHit||this.target.isDead()){this.hasHit=!0;return}const t=this.target.x,s=this.target.y,i=Math.atan2(s-this.y,t-this.x);this.rotation=i;const r=Math.cos(i)*this.speed*e,o=Math.sin(i)*this.speed*e;if(this.x+=r,this.y+=o,this.sprite.x=this.x,this.sprite.y=this.y,this.sprite.setRotation&&this.sprite.setRotation(this.rotation),Math.random()<.6&&this.scene.tweens?.add){const l=this.scene.add.graphics(),h=this.isFrost?65535:16755200,d=this.isFrost?4:5;l.fillStyle(h,.6),l.fillCircle(0,0,d),l.fillStyle(h,.3),l.fillCircle(0,0,d*1.5),l.x=this.x,l.y=this.y,l.setRotation&&l.setRotation(this.rotation),l.setDepth&&l.setDepth(90),this.trailParticles.push(l),this.scene.tweens.add({targets:l,alpha:0,scaleX:.3,scaleY:.8,duration:400,ease:"Power2",onComplete:()=>{const u=this.trailParticles.indexOf(l);u>-1&&this.trailParticles.splice(u,1),l.destroy()}})}Phaser.Math.Distance.Between(this.x,this.y,t,s)<10&&(this.target.takeDamage(this.damage),this.isFrost&&this.target.applySlow(this.slowAmount,this.slowDuration),this.splashRadius>0&&this.applySplashDamage(this.x,this.y),this.hasHit=!0)}applySplashDamage(e,t){if(this.scene.cameras?.main?.shake&&this.scene.cameras.main.shake(150,.003),this.scene.tweens?.add){const s=this.scene.add.graphics();s.fillStyle(16746496,.8),s.fillCircle(0,0,this.splashRadius*.6),s.fillStyle(16737792,.6),s.fillCircle(0,0,this.splashRadius),s.lineStyle(3,16755200,.9),s.strokeCircle(0,0,this.splashRadius),s.x=e,s.y=t,this.scene.tweens.add({targets:s,alpha:0,scale:1.5,duration:400,ease:"Power2",onComplete:()=>s.destroy()});for(let i=0;i<12;i++){const r=this.scene.add.graphics(),o=3+Math.random()*4;r.fillStyle(i%2===0?16737792:16746496,.8),r.fillCircle(0,0,o),r.x=e,r.y=t,r.setDepth&&r.setDepth(98);const a=i/12*Math.PI*2+Math.random()*.3,l=this.splashRadius*(.8+Math.random()*.6);this.scene.tweens.add({targets:r,x:e+Math.cos(a)*l,y:t+Math.sin(a)*l,alpha:0,scale:.3,duration:300+Math.random()*300,ease:"Power2",onComplete:()=>r.destroy()})}}for(const s of this.allEnemies){if(s===this.target||s.isDead())continue;Phaser.Math.Distance.Between(e,t,s.x,s.y)<=this.splashRadius&&s.takeDamage(this.damage)}}shouldDestroy(){return this.hasHit||this.target.isDead()}destroy(){this.sprite.destroy();for(const e of this.trailParticles)e.destroy();this.trailParticles=[]}}class ai extends Le{constructor(e,t,s,i){super(e,t,s,"basic",i)}createSprite(){this.sprite=this.scene.add.graphics(),this.sprite.fillStyle(4868682,1),this.sprite.fillRoundedRect(-18,10,36,8,2),this.sprite.fillStyle(255,1),this.sprite.fillRoundedRect(-12,-8,24,18,3),this.sprite.fillStyle(153,1),this.sprite.fillRect(8,-8,4,18),this.sprite.fillStyle(2763306,1),this.sprite.fillRoundedRect(-8,-15,16,7,2),this.sprite.fillStyle(3815994,1),this.sprite.fillRect(-3,-18,6,8),this.sprite.fillStyle(16776960,.8),this.sprite.fillCircle(0,0,4),this.sprite.lineStyle(1,16777215,.6),this.sprite.strokeCircle(0,0,4),this.sprite.fillStyle(6710886,1),[-8,8].forEach(e=>{[-4,4].forEach(t=>{this.sprite.fillCircle(e,t,1.5)})}),this.sprite.lineStyle(2,16777215,.3),this.sprite.strokeRoundedRect(-12,-8,24,18,3),this.sprite.x=this.x,this.sprite.y=this.y}fireAtTarget(e,t){return new ot(this.scene,this.x,this.y,e,this.damage,!1)}}class Mn extends Le{constructor(e,t,s,i){super(e,t,s,"fast",i)}createSprite(){this.sprite=this.scene.add.graphics(),this.sprite.fillStyle(3815994,1),this.sprite.fillRoundedRect(-18,10,36,8,2),this.sprite.fillStyle(5597999,1),this.sprite.fillRoundedRect(-14,-6,28,16,2),this.sprite.fillStyle(4017951,1),this.sprite.fillRect(10,-6,4,16),this.sprite.fillStyle(9139029,1),this.sprite.fillRoundedRect(-16,0,6,8,1),this.sprite.lineStyle(1,0,.5),this.sprite.strokeRoundedRect(-16,0,6,8,1),this.sprite.fillStyle(2763306,1),this.sprite.fillRect(-3,-18,2,14),this.sprite.fillRect(1,-18,2,14),this.sprite.fillStyle(16737792,.3),this.sprite.fillCircle(-2,-18,3),this.sprite.fillCircle(2,-18,3),this.sprite.fillStyle(2763306,1),this.sprite.fillRect(-2,-6,4,6),this.sprite.fillStyle(65280,.6),this.sprite.fillCircle(-10,-2,2),this.sprite.fillCircle(10,-2,2),this.sprite.fillStyle(6710886,1),[-10,10].forEach(e=>{this.sprite.fillCircle(e,4,1.5)}),this.sprite.fillStyle(1710618,1),this.sprite.fillRoundedRect(8,-2,4,6,1),this.sprite.x=this.x,this.sprite.y=this.y}fireAtTarget(e,t){return new ot(this.scene,this.x,this.y,e,this.damage,!1)}}class An extends Le{constructor(e,t,s,i){super(e,t,s,"strong",i)}createSprite(){this.sprite=this.scene.add.graphics(),this.sprite.fillStyle(4868682,1),this.sprite.fillRoundedRect(-18,10,36,8,2),this.sprite.fillStyle(16711935,1),this.sprite.fillRoundedRect(-12,-8,24,18,3),this.sprite.fillStyle(11141290,1),this.sprite.fillRect(8,-8,4,18),this.sprite.fillStyle(2763306,1),this.sprite.fillRoundedRect(-8,-15,16,7,2),this.sprite.fillStyle(3815994,1),this.sprite.fillRect(-3,-18,6,8),this.sprite.fillStyle(16776960,.8),this.sprite.fillCircle(0,0,4),this.sprite.lineStyle(1,16777215,.6),this.sprite.strokeCircle(0,0,4),this.sprite.fillStyle(6710886,1),[-8,8].forEach(e=>{[-4,4].forEach(t=>{this.sprite.fillCircle(e,t,1.5)})}),this.sprite.lineStyle(2,16777215,.3),this.sprite.strokeRoundedRect(-12,-8,24,18,3),this.sprite.x=this.x,this.sprite.y=this.y}fireAtTarget(e,t){return new ot(this.scene,this.x,this.y,e,this.damage,!1)}}class In extends Le{constructor(e,t,s,i){super(e,t,s,"frost",i)}createSprite(){this.sprite=this.scene.add.graphics(),this.sprite.fillStyle(4868682,1),this.sprite.fillRoundedRect(-18,10,36,8,2),this.sprite.fillStyle(56831,1),this.sprite.fillRoundedRect(-12,-8,24,18,3),this.sprite.fillStyle(39355,1),this.sprite.fillRect(8,-8,4,18),this.sprite.fillStyle(2763306,1),this.sprite.fillRoundedRect(-8,-15,16,7,2),this.sprite.fillStyle(3815994,1),this.sprite.fillRect(-3,-18,6,8),this.sprite.fillStyle(16776960,.8),this.sprite.fillCircle(0,0,4),this.sprite.lineStyle(1,16777215,.6),this.sprite.strokeCircle(0,0,4),this.sprite.fillStyle(6710886,1),[-8,8].forEach(e=>{[-4,4].forEach(t=>{this.sprite.fillCircle(e,t,1.5)})}),this.sprite.lineStyle(2,16777215,.3),this.sprite.strokeRoundedRect(-12,-8,24,18,3),this.sprite.x=this.x,this.sprite.y=this.y}fireAtTarget(e,t){return new ot(this.scene,this.x,this.y,e,this.damage,!0)}}class Ln{enemy;damagePerSecond;duration;startTime;lastDamageTick;constructor(e,t,s){this.enemy=e,this.damagePerSecond=t,this.duration=s,this.startTime=Date.now(),this.lastDamageTick=this.startTime}update(){const e=Date.now();return e-this.startTime>=this.duration?!1:(e-this.lastDamageTick>=1e3&&(this.enemy.takeDamage(this.damagePerSecond),this.lastDamageTick=e),!0)}getTimeRemaining(){const e=Date.now()-this.startTime;return Math.max(0,this.duration-e)}getDamagePerSecond(){return this.damagePerSecond}refresh(){this.startTime=Date.now(),this.lastDamageTick=this.startTime}}class On extends Le{burnDamagePerSecond;burnDuration;constructor(e,t,s,i){super(e,t,s,"fire",i);const r=E.getInstance().getConfig().towers.fire;this.burnDamagePerSecond=r.burnDamagePerSecond||5,this.burnDuration=r.burnDuration||5e3}createSprite(){this.sprite=this.scene.add.graphics(),this.sprite.fillStyle(4868682,1),this.sprite.fillRoundedRect(-18,10,36,8,2),this.sprite.fillStyle(16737792,1),this.sprite.fillRoundedRect(-12,-8,24,18,3),this.sprite.fillStyle(13386752,1),this.sprite.fillRect(8,-8,4,18),this.sprite.fillStyle(2763306,1),this.sprite.fillRoundedRect(-8,-15,16,7,2),this.sprite.fillStyle(3815994,1),this.sprite.fillRect(-3,-18,6,8),this.sprite.fillStyle(16729088,.8),this.sprite.fillCircle(0,0,4),this.sprite.lineStyle(1,16755200,.8),this.sprite.strokeCircle(0,0,4),this.sprite.fillStyle(6710886,1),[-8,8].forEach(e=>{[-4,4].forEach(t=>{this.sprite.fillCircle(e,t,1.5)})}),this.sprite.lineStyle(2,16746496,.5),this.sprite.strokeRoundedRect(-12,-8,24,18,3),this.sprite.x=this.x,this.sprite.y=this.y}fireAtTarget(e,t){if(e.isDead())return null;this.applyBurn(e);const s=this.scene.add.graphics();return s.fillStyle(16737792,.8),s.fillCircle(this.x,this.y,8),this.scene.tweens.add({targets:s,alpha:0,scale:2,duration:300,onComplete:()=>s.destroy()}),null}applyBurn(e){new Ln(e,this.burnDamagePerSecond,this.burnDuration)}upgrade(){const e=super.upgrade();return this.burnDamagePerSecond=Math.round(this.burnDamagePerSecond*1.3),e}}class Bn extends Le{splashRadius;constructor(e,t,s,i){super(e,t,s,"splash",i);const r=E.getInstance().getConfig().towers.splash;this.splashRadius=r.splashRadius||50}createSprite(){this.sprite=this.scene.add.graphics(),this.sprite.fillStyle(4868682,1),this.sprite.fillRoundedRect(-20,10,40,8,2),this.sprite.fillStyle(9139029,1),this.sprite.fillEllipse(0,0,28,24),this.sprite.fillStyle(7033669,1),this.sprite.fillEllipse(6,0,10,24),this.sprite.fillStyle(2763306,1),this.sprite.fillEllipse(0,-12,16,8),this.sprite.fillStyle(16737792,1),this.sprite.fillTriangle(-8,4,0,-4,8,4),this.sprite.lineStyle(2,0,.8),this.sprite.strokeEllipse(0,0,28,24),this.sprite.fillStyle(6710886,1),[-10,10].forEach(e=>{this.sprite.fillCircle(e,8,2)}),this.sprite.x=this.x,this.sprite.y=this.y}fireAtTarget(e,t){return e.isDead()?null:new ot(this.scene,this.x,this.y,e,this.damage,!1,0,0,this.splashRadius,t)}upgrade(){const e=super.upgrade();return this.splashRadius=Math.round(this.splashRadius*1.1),e}}class Dn extends Le{armorPenetration;constructor(e,t,s,i){super(e,t,s,"sniper",i);const r=E.getInstance().getConfig().towers.sniper;this.armorPenetration=r.armorPenetration||.5}createSprite(){this.sprite=this.scene.add.graphics(),this.sprite.fillStyle(3815994,1),this.sprite.fillRoundedRect(-18,10,36,8,2),this.sprite.fillStyle(2969375,1),this.sprite.fillRoundedRect(-10,-6,20,16,2),this.sprite.fillStyle(1710618,1),this.sprite.fillRect(-4,-14,8,8),this.sprite.fillStyle(4474111,.7),this.sprite.fillCircle(0,-10,4),this.sprite.lineStyle(1,16777215,.5),this.sprite.strokeCircle(0,-10,4),this.sprite.fillStyle(2763306,1),this.sprite.fillRect(-2,-24,4,12),this.sprite.fillStyle(1710618,1),this.sprite.fillCircle(0,-24,3),this.sprite.lineStyle(1,16711680,.6),this.sprite.beginPath(),this.sprite.moveTo(-6,0),this.sprite.lineTo(6,0),this.sprite.moveTo(0,-6),this.sprite.lineTo(0,6),this.sprite.strokePath(),this.sprite.fillStyle(3815994,1),this.sprite.fillRect(-12,8,3,4),this.sprite.fillRect(9,8,3,4),this.sprite.x=this.x,this.sprite.y=this.y}calculateTargetValue(e){return e.getHealth()}fireAtTarget(e,t){if(e.isDead())return null;const s=this.damage*(1+this.armorPenetration);e.takeDamage(s);const i=this.scene.add.graphics();i.lineStyle(2,16776960,.8),i.beginPath(),i.moveTo(this.x,this.y),i.lineTo(e.x,e.y),i.strokePath();const r=this.scene.add.graphics();return r.fillStyle(16776960,.9),r.fillCircle(this.x,this.y-20,6),this.scene.tweens.add({targets:[i,r],alpha:0,duration:150,onComplete:()=>{i.destroy(),r.destroy()}}),null}upgrade(){const e=super.upgrade();return this.armorPenetration=Math.min(.9,this.armorPenetration+.1),e}}class li{static createTower(e,t,s,i,r){switch(i){case"basic":return new ai(e,t,s,r);case"fast":return new Mn(e,t,s,r);case"strong":return new An(e,t,s,r);case"frost":return new In(e,t,s,r);case"fire":return new On(e,t,s,r);case"splash":return new Bn(e,t,s,r);case"sniper":return new Dn(e,t,s,r);default:return console.warn(`Unknown tower type: ${i}, creating basic tower`),new ai(e,t,s,r)}}}class Un{scene;path;towers=[];preview=null;selectedType=null;selectedCost=0;selectedTower=null;placementDistance=45;constructor(e,t,s=45){this.scene=e,this.path=t,this.placementDistance=s,this.scene.input.on("pointerdown",i=>{this.handleTowerClick(i)})}selectTower(e,t){this.selectedType===e?(this.selectedType=null,this.selectedCost=0,this.clearPreview()):(this.selectedType=e,this.selectedCost=t)}deselectTower(){this.selectedType=null,this.selectedCost=0,this.clearPreview()}updatePreview(e){if(!this.selectedType){this.clearPreview();return}this.preview||(this.preview=this.scene.add.graphics()),this.preview.clear();const s=this.isValidPosition(e.x,e.y)?65280:16711680,i=.5;this.preview.fillStyle(s,i),this.preview.fillRect(e.x-15,e.y-15,30,30),this.preview.lineStyle(2,16777215,i),this.preview.strokeRect(e.x-15,e.y-15,30,30);const r=this.getTowerRange(this.selectedType);this.preview.lineStyle(2,s,i*.5),this.preview.strokeCircle(e.x,e.y,r)}tryPlaceTower(e,t,s){if(!this.selectedType||s<this.selectedCost)return{success:!1,cost:0};if(!this.isValidPosition(e,t))return{success:!1,cost:0};const i=li.createTower(this.scene,e,t,this.selectedType,this.selectedCost);this.towers.push(i);const r=this.selectedCost;return this.selectedType=null,this.selectedCost=0,this.clearPreview(),{success:!0,cost:r}}update(e,t){const s=[];return this.towers.forEach(i=>{const r=i.update(e,Array.isArray(t)?t:[]);r&&s.push(r)}),s}isValidPosition(e,t){const s=this.path.getPoints(100);for(const i of s)if(Phaser.Math.Distance.Between(e,t,i.x,i.y)<this.placementDistance)return!1;for(const i of this.towers)if(Phaser.Math.Distance.Between(e,t,i.x,i.y)<65)return!1;return!0}getTowerRange(e){switch(e){case"fast":return 120;case"strong":return 180;case"frost":return 140;case"splash":return 120;case"sniper":return 250;default:return 150}}clearPreview(){this.preview&&(this.preview.destroy(),this.preview=null)}getSelectedType(){return this.selectedType}addTowerFromServer(e,t,s,i,r){const a=E.getInstance().getConfig().towers[s],l=a?a.cost:0,h=li.createTower(this.scene,e,t,s,l);r&&(h.id=r);for(let d=1;d<i;d++)h.upgrade();this.towers.push(h)}applyDamageMultiplierToAll(e){for(const t of this.towers)t.applyDamageMultiplier&&t.applyDamageMultiplier(e)}applyRangeMultiplierToAll(e){for(const t of this.towers)t.applyRangeMultiplier&&t.applyRangeMultiplier(e)}handleTowerClick(e){if(!this.selectedType){for(const t of this.towers)if(Phaser.Math.Distance.Between(e.x,e.y,t.x,t.y)<25){this.selectedTower=t;return}this.selectedTower=null}}tryUpgradeTower(e){if(!this.selectedTower||!this.selectedTower.canUpgrade())return{success:!1,cost:0};const t=this.selectedTower.getUpgradeCost();return e<t?{success:!1,cost:0}:(this.selectedTower.upgrade(),{success:!0,cost:t})}trySellTower(){if(!this.selectedTower)return{success:!1,refund:0};const e=this.selectedTower.getSellValue(),t=this.towers.indexOf(this.selectedTower);return t>-1&&this.towers.splice(t,1),this.selectedTower.destroy(),this.selectedTower=null,{success:!0,refund:e}}getSelectedTower(){return this.selectedTower}upgradeTowerById(e,t){const s=this.towers.find(i=>i.id===e);if(s)for(console.log(`ðŸ”§ Upgrading tower ${e} to level ${t}`);s.getUpgradeLevel()<t&&s.canUpgrade();)s.upgrade();else console.error(`âŒ Tower ${e} not found for upgrade`),console.log("Available towers:",this.towers.map(i=>({id:i.id,x:i.x,y:i.y})))}sellTowerById(e){const t=this.towers.find(s=>s.id===e);if(t){const s=this.towers.indexOf(t);s>-1&&this.towers.splice(s,1),t.destroy()}}cleanup(){this.towers.forEach(e=>e.destroy()),this.towers=[],this.clearPreview(),this.selectedTower=null}}class ci{scene;path;mapConfig;mapName;mapRegistry;placedDecorations=[];constructor(e,t="classic"){this.scene=e,this.mapName=t,this.mapRegistry=Ce.getInstance()}async loadMap(){const e=this.mapRegistry.getMap(this.mapName);if(!e)throw new Error(`Map not found in registry: ${this.mapName}`);this.mapConfig=e}create(){if(!this.mapConfig)throw new Error("Map not loaded. Call loadMap() first.");const e=this.scene.cameras.main.width,t=this.scene.cameras.main.height;this.createBackground(e,t),this.createPathFromWaypoints(e,t),this.addTerrainDecorations(e,t),this.drawPathWithDepth(),this.addVegetationDecorations(e,t)}createPathFromWaypoints(e,t){const s=this.mapConfig.path.waypoints;if(s.length===0)throw new Error("No waypoints defined in map");const i=this.convertWaypoint(s[0],e,t);this.path=new Phaser.Curves.Path(i.x,i.y);for(let r=1;r<s.length;r++){const o=this.convertWaypoint(s[r],e,t);this.path.lineTo(o.x,o.y)}}convertWaypoint(e,t,s){let i=e.x,r=e.y;return i<0&&(i=t+i),r<0&&(r=s+r),typeof r=="number"&&r>0&&r<=1&&(r=s*r),typeof i=="number"&&i>0&&i<=1&&(i=t*i),{x:i,y:r}}createBackground(e,t){const s=this.scene.add.graphics(),i=this.mapConfig.background,r=t*i.skyHeight;for(let h=0;h<r;h++){const d=h/r,u=Phaser.Display.Color.Interpolate.ColorWithColor(Phaser.Display.Color.HexStringToColor(i.skyColorTop),Phaser.Display.Color.HexStringToColor(i.skyColorBottom),100,d*100);s.fillStyle(Phaser.Display.Color.GetColor(u.r,u.g,u.b),1),s.fillRect(0,h,e,2)}const a=Phaser.Display.Color.HexStringToColor(i.grassColor).color,l=40;for(let h=0;h<e;h+=l)for(let d=r;d<t;d+=l){const u=(Math.random()-.5)*20,p=Phaser.Display.Color.ValueToColor(a);p.darken(u),s.fillStyle(p.color,1);const g=l+Math.random()*10,b=l+Math.random()*10;s.fillRect(h,d,g,b)}for(let h=0;h<80;h++){const d=Math.random()*e,u=r+Math.random()*(t-r),p=3+Math.random()*4;s.fillStyle(1728282,.2+Math.random()*.2),s.fillCircle(d,u,p)}}addTerrainDecorations(e,t){const s=this.mapConfig.decorations;s.water&&s.water.forEach(i=>{const r=i.x*e,o=i.y*t,a=Math.max(i.width,i.height)/2;this.canPlaceDecoration(r,o,a,i.safeDistance)&&(this.drawSteampunkWater(r,o,i.width,i.height),this.registerDecoration(r,o,a))}),s.mountains&&s.mountains.forEach(i=>{const r=i.x*e,o=i.y*t,a=Phaser.Display.Color.HexStringToColor(i.color),l=Math.max(i.width,i.height)/2;this.canPlaceDecoration(r,o,l,i.safeDistance)&&(this.drawMountain(r,o,i.width,i.height,a.color),this.registerDecoration(r,o,l))}),s.gears&&s.gears.forEach(i=>{const r=i.x*e,o=i.y*t,a=Phaser.Display.Color.HexStringToColor(i.color);this.canPlaceDecoration(r,o,i.radius,i.safeDistance)&&(this.drawSteampunkGear(r,o,i.radius,a.color),this.registerDecoration(r,o,i.radius))}),s.pipes&&s.pipes.forEach(i=>{const r=i.x*e,o=i.y*t,a=30;this.canPlaceDecoration(r,o,a,i.safeDistance)&&(this.drawSteampunkPipes(r,o),this.registerDecoration(r,o,a))})}addVegetationDecorations(e,t){const s=this.mapConfig.decorations;s.trees&&s.trees.forEach(i=>{const r=i.x*e,o=i.y*t,a=Phaser.Display.Color.HexStringToColor(i.color),l=i.size*.6;this.canPlaceDecoration(r,o,l,i.safeDistance)&&(this.drawComicTree(r,o,i.size,a.color),this.registerDecoration(r,o,l))}),s.bushes&&s.bushes.forEach(i=>{const r=i.x*e,o=i.y*t,a=Phaser.Display.Color.HexStringToColor(i.color),l=i.size*.8;this.canPlaceDecoration(r,o,l,i.safeDistance)&&(this.drawBush(r,o,i.size,a.color),this.registerDecoration(r,o,l))}),s.lamps&&s.lamps.forEach(i=>{const r=i.x*e,o=i.y*t,a=20;this.canPlaceDecoration(r,o,a,i.safeDistance)&&(this.drawSteampunkLamp(r,o),this.registerDecoration(r,o,a))})}isOnPath(e,t,s){const i=this.path.getPoints(100);for(const r of i)if(Phaser.Math.Distance.Between(e,t,r.x,r.y)<s)return!0;return!1}canPlaceDecoration(e,t,s,i){if(this.isOnPath(e,t,i))return!1;for(const r of this.placedDecorations){const o=Phaser.Math.Distance.Between(e,t,r.x,r.y),a=s+r.radius+10;if(o<a)return!1}return!0}registerDecoration(e,t,s){this.placedDecorations.push({x:e,y:t,radius:s})}drawPathWithDepth(){const e=this.scene.add.graphics(),t=this.path.getPoints(200);for(let s=0;s<t.length-1;s++){const i=t[s],r=t[s+1],o=r.x-i.x,a=r.y-i.y,l=Math.sqrt(o*o+a*a);if(l===0)continue;const h=-a/l,d=o/l,u=22,p=Math.sin(s*.3)*2,g=u+p;e.fillStyle(7036239,1),e.fillTriangle(i.x-h*g,i.y-d*g,i.x+h*g,i.y+d*g,r.x-h*g,r.y-d*g),e.fillTriangle(r.x+h*g,r.y+d*g,r.x-h*g,r.y-d*g,i.x+h*g,i.y+d*g)}e.lineStyle(2,4864554,.4);for(let s=0;s<t.length-1;s++){const i=t[s],r=t[Math.min(s+1,t.length-1)].x-i.x,o=t[Math.min(s+1,t.length-1)].y-i.y,a=Math.sqrt(r*r+o*o);if(a===0)continue;const l=-o/a,h=r/a,d=24;e.beginPath(),e.moveTo(i.x-l*d,i.y-h*d),e.lineTo(t[Math.min(s+1,t.length-1)].x-l*d,t[Math.min(s+1,t.length-1)].y-h*d),e.strokePath(),e.beginPath(),e.moveTo(i.x+l*d,i.y+h*d),e.lineTo(t[Math.min(s+1,t.length-1)].x+l*d,t[Math.min(s+1,t.length-1)].y+h*d),e.strokePath()}for(let s=0;s<t.length;s+=5){const i=t[s];if(Math.random()>.6){const r=(Math.random()-.5)*30,o=(Math.random()-.5)*30,a=3+Math.random()*4;e.fillStyle(9075306,.5+Math.random()*.3),e.fillCircle(i.x+r,i.y+o,a),e.fillStyle(11184810,.3),e.fillCircle(i.x+r-1,i.y+o-1,a*.4)}if(Math.random()>.8){e.lineStyle(1,5917242,.3);const r=5+Math.random()*10,o=Math.random()*Math.PI*2;e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(i.x+Math.cos(o)*r,i.y+Math.sin(o)*r),e.strokePath()}}for(let s=0;s<t.length;s+=8){const i=t[s],r=Math.min(s+1,t.length-1),o=t[r].x-i.x,a=t[r].y-i.y,l=Math.sqrt(o*o+a*a);if(l===0)continue;const h=-a/l,d=o/l;for(const u of[-1,1]){const p=26+Math.random()*8,g=i.x+h*p*u,b=i.y+d*p*u,T=3+Math.floor(Math.random()*3);for(let L=0;L<T;L++){const k=(Math.random()-.5)*.4,_=4+Math.random()*4,D=g+(Math.random()-.5)*3,S=b+(Math.random()-.5)*3;e.lineStyle(1,2969622,.6+Math.random()*.2),e.beginPath(),e.moveTo(D,S),e.lineTo(D+Math.sin(k)*2,S-_),e.strokePath()}}}}drawSteampunkWater(e,t,s,i){const r=this.scene.add.graphics();r.fillStyle(4620980,.7),r.fillEllipse(e,t,s,i),r.lineStyle(3,9139029,1),r.strokeEllipse(e,t,s,i);for(let o=0;o<8;o++){const a=o/8*Math.PI*2,l=e+Math.cos(a)*(s/2),h=t+Math.sin(a)*(i/2);r.fillStyle(6908265,1),r.fillCircle(l,h,3)}}drawMountain(e,t,s,i,r){const o=this.scene.add.graphics();o.fillStyle(r,1),o.beginPath(),o.moveTo(e-s/2,t+i/2),o.lineTo(e-s/4,t-i/4),o.lineTo(e,t-i/2),o.lineTo(e+s/4,t-i/4),o.lineTo(e+s/2,t+i/2),o.closePath(),o.fillPath(),o.fillStyle(16775930,1),o.beginPath(),o.moveTo(e-s/8,t-i/4),o.lineTo(e,t-i/2),o.lineTo(e+s/8,t-i/4),o.closePath(),o.fillPath(),o.lineStyle(3,0,1),o.beginPath(),o.moveTo(e-s/2,t+i/2),o.lineTo(e,t-i/2),o.lineTo(e+s/2,t+i/2),o.strokePath()}drawSteampunkGear(e,t,s,i){const r=this.scene.add.graphics();r.fillStyle(i,1),r.fillCircle(e,t,s),r.fillStyle(i,1);const o=8;for(let a=0;a<o;a++){const l=a/o*Math.PI*2,h=e+Math.cos(l)*s,d=t+Math.sin(l)*s;r.fillRect(h-3,d-5,6,10)}r.fillStyle(3355443,1),r.fillCircle(e,t,s*.4),r.fillStyle(6908265,1);for(let a=0;a<4;a++){const l=a/4*Math.PI*2+Math.PI/4,h=e+Math.cos(l)*s*.6,d=t+Math.sin(l)*s*.6;r.fillCircle(h,d,3)}r.lineStyle(2,0,1),r.strokeCircle(e,t,s)}drawSteampunkPipes(e,t){const s=this.scene.add.graphics();s.fillStyle(9139029,1),s.fillRect(e-8,t-60,16,120);for(let i=0;i<3;i++){const r=t-40+i*40;s.lineStyle(2,6636321,1),s.lineTo(e-8,r),s.lineTo(e+8,r),s.strokePath(),s.fillStyle(6908265,1),s.fillCircle(e-6,r,2),s.fillCircle(e+6,r,2)}s.fillStyle(13467442,1),s.fillCircle(e+15,t,8),s.lineStyle(3,6636321,1),s.lineTo(e+8,t),s.lineTo(e+22,t),s.strokePath()}drawComicTree(e,t,s,i){const r=this.scene.add.graphics();r.fillStyle(6636321,1),r.fillRect(e-s*.15,t,s*.3,s*.8),r.lineStyle(2,0,1),r.strokeRect(e-s*.15,t,s*.3,s*.8),r.fillStyle(i,1),r.fillCircle(e,t-s*.2,s*.5),r.fillCircle(e-s*.3,t,s*.4),r.fillCircle(e+s*.3,t,s*.4),r.lineStyle(2,0,1),r.strokeCircle(e,t-s*.2,s*.5),r.strokeCircle(e-s*.3,t,s*.4),r.strokeCircle(e+s*.3,t,s*.4),r.fillStyle(16777215,.3),r.fillCircle(e-s*.1,t-s*.3,s*.15)}drawBush(e,t,s,i){const r=this.scene.add.graphics();r.fillStyle(i,1),r.fillCircle(e,t,s),r.fillCircle(e-s*.5,t+s*.2,s*.7),r.fillCircle(e+s*.5,t+s*.2,s*.7),r.lineStyle(2,0,1),r.strokeCircle(e,t,s),r.strokeCircle(e-s*.5,t+s*.2,s*.7),r.strokeCircle(e+s*.5,t+s*.2,s*.7),r.fillStyle(16777215,.2),r.fillCircle(e-s*.2,t-s*.2,s*.3)}drawSteampunkLamp(e,t){const s=this.scene.add.graphics();s.fillStyle(9139029,1),s.fillRect(e-4,t,8,80);for(let i=0;i<4;i++){const r=t+i*20;s.fillStyle(6908265,1),s.fillCircle(e-4,r,2),s.fillCircle(e+4,r,2)}s.fillStyle(13467442,1),s.fillRect(e-12,t-20,24,20),s.fillStyle(16777113,.8),s.fillRect(e-8,t-16,16,12),s.fillStyle(9139029,1),s.beginPath(),s.moveTo(e-14,t-20),s.lineTo(e,t-28),s.lineTo(e+14,t-20),s.closePath(),s.fillPath(),s.lineStyle(2,0,1),s.strokeRect(e-12,t-20,24,20),s.strokeRect(e-4,t,8,80)}getPath(){return this.path}getMapConfig(){return this.mapConfig}getPlacementDistance(){const e=this.mapConfig?.path?.placementDistance;return typeof e=="number"?e:45}}class Nn{xp=0;level=1;researches;constructor(){this.researches=new Map,this.initializeResearches(),this.checkUnlocks()}initializeResearches(){this.researches.set("basic_tower_upgrade",{id:"basic_tower_upgrade",name:"Basis-Turm Upgrade",description:"Verbessert Basis-TÃ¼rme: +20% Schaden, +10% Reichweite",goldCost:150,xpRequired:0,unlocked:!0,researched:!1}),this.researches.set("frost_tower",{id:"frost_tower",name:"Frost-Turm",description:"Schaltet den Frost-Turm frei, der Gegner verlangsamt",goldCost:300,xpRequired:0,unlocked:!1,researched:!1}),this.researches.set("fire_tower",{id:"fire_tower",name:"Feuer-Turm",description:"Schaltet den Feuer-Turm frei, der Gegner verbrennt (8 Schaden/Sek fÃ¼r 5 Sek)",goldCost:350,xpRequired:0,unlocked:!1,researched:!1}),this.researches.set("tower_damage_1",{id:"tower_damage_1",name:"VerstÃ¤rkter Schaden I",description:"+10% Schaden fÃ¼r alle TÃ¼rme",goldCost:200,xpRequired:0,unlocked:!1,researched:!1}),this.researches.set("tower_range_1",{id:"tower_range_1",name:"Erweiterte Reichweite I",description:"+10% Reichweite fÃ¼r alle TÃ¼rme",goldCost:200,xpRequired:0,unlocked:!1,researched:!1})}addXP(e){this.xp+=e;let t=!1;const s=[];for(;this.xp>=this.getXPForLevel(this.level+1);){this.level++,t=!0;const i=this.checkUnlocks();s.push(...i)}return t?{levelUp:!0,newLevel:this.level,newResearchUnlocked:s}:{levelUp:!1,newLevel:this.level,newResearchUnlocked:[]}}getXPForLevel(e){return e*100}checkUnlocks(){const e=[];if(console.log("Checking unlocks, current level:",this.level),this.level>=3){const t=this.researches.get("frost_tower");console.log("Frost tower before unlock:",t?.unlocked),t&&!t.unlocked&&(t.unlocked=!0,e.push(t.name),console.log("Frost tower unlocked!"))}if(this.level>=4){const t=this.researches.get("fire_tower");t&&!t.unlocked&&(t.unlocked=!0,e.push(t.name));const s=this.researches.get("tower_damage_1");s&&!s.unlocked&&(s.unlocked=!0,e.push(s.name));const i=this.researches.get("tower_range_1");i&&!i.unlocked&&(i.unlocked=!0,e.push(i.name))}return e}canResearch(e,t){const s=this.researches.get(e);return s?s.unlocked&&!s.researched&&t>=s.goldCost:!1}research(e){const t=this.researches.get(e);return!t||!t.unlocked||t.researched?!1:(t.researched=!0,!0)}isResearched(e){const t=this.researches.get(e);return t?t.researched:!1}getAvailableResearches(){const e=Array.from(this.researches.values()).filter(t=>t.unlocked&&!t.researched);return console.log("Available researches:",e.map(t=>({name:t.name,unlocked:t.unlocked,researched:t.researched}))),console.log("Current level:",this.level,"XP:",this.xp),e}getResearch(e){return this.researches.get(e)}getXP(){return this.xp}getLevel(){return this.level}getXPForNextLevel(){return this.getXPForLevel(this.level+1)}getXPProgress(){const e=this.level>1?this.getXPForLevel(this.level):0,t=this.getXPForLevel(this.level+1),s=this.xp-e,i=t-e;return s/i}}class Hn{projectiles=[];addProjectile(e){this.projectiles.push(e)}update(e){for(const t of this.projectiles)t.update(e);this.projectiles=this.projectiles.filter(t=>t.shouldDestroy()?(t.destroy(),!1):!0)}getCount(){return this.projectiles.length}clear(){for(const e of this.projectiles)e.destroy();this.projectiles=[]}}class $n{constructor(e){this.scene=e}showLevelUp(e){const t=this.scene.cameras.main.width,s=this.scene.cameras.main.height,i=this.scene.add.container(t/2,s/3),r=this.scene.add.rectangle(0,0,300,100,0,.8),o=this.scene.add.text(0,-20,f("notification.level_up"),{font:"bold 32px Arial",color:"#ffff00"}).setOrigin(.5),a=this.scene.add.text(0,20,`Level ${e}`,{font:"24px Arial",color:"#ffffff"}).setOrigin(.5);i.add([r,o,a]),i.setDepth(1e3),this.scene.tweens.add({targets:i,alpha:{from:1,to:0},y:s/3-50,duration:2e3,ease:"Power2",onComplete:()=>i.destroy()})}showTowerUpgrade(){const e=this.scene.cameras.main.width,t=this.scene.cameras.main.height,s=this.scene.add.container(e/2,t/2),i=this.scene.add.rectangle(0,0,250,80,0,.8),r=this.scene.add.text(0,0,f("notification.tower_upgraded"),{font:"bold 28px Arial",color:"#ff9900"}).setOrigin(.5);s.add([i,r]),s.setDepth(1e3),this.scene.tweens.add({targets:s,alpha:{from:1,to:0},y:t/2-50,duration:1500,ease:"Power2",onComplete:()=>s.destroy()})}showTowerSold(e){const t=this.scene.cameras.main.width,s=this.scene.cameras.main.height,i=this.scene.add.container(t/2,s/2),r=this.scene.add.rectangle(0,0,280,100,0,.8),o=this.scene.add.text(0,-15,f("notification.tower_sold"),{font:"bold 28px Arial",color:"#cc0000"}).setOrigin(.5),a=this.scene.add.text(0,20,f("notification.gold_gain",{amount:e}),{font:"22px Arial",color:"#ffff00"}).setOrigin(.5);i.add([r,o,a]),i.setDepth(1e3),this.scene.tweens.add({targets:i,alpha:{from:1,to:0},y:s/2-50,duration:1500,ease:"Power2",onComplete:()=>i.destroy()})}showResearchUnlocked(e){const t=this.scene.cameras.main.width,s=this.scene.cameras.main.height,i=this.scene.add.container(t/2,s/2),r=this.scene.add.rectangle(0,0,400,120,0,.9);r.setStrokeStyle(3,10027263,1);const o=this.scene.add.text(0,-30,"ðŸ”¬",{font:"bold 40px Arial"}).setOrigin(.5),a=this.scene.add.text(0,10,f("notification.research_unlocked"),{font:"bold 24px Arial",color:"#ff00ff"}).setOrigin(.5),l=this.scene.add.text(0,40,e,{font:"20px Arial",color:"#ffff00"}).setOrigin(.5);i.add([r,o,a,l]),i.setDepth(1001),i.setScale(.5),this.scene.tweens.add({targets:i,scale:{from:.5,to:1},duration:300,ease:"Back.easeOut"}),this.scene.tweens.add({targets:r,scaleX:{from:1,to:1.05},scaleY:{from:1,to:1.05},duration:800,yoyo:!0,repeat:2}),this.scene.tweens.add({targets:i,alpha:{from:1,to:0},y:s/2-80,delay:3e3,duration:1e3,ease:"Power2",onComplete:()=>i.destroy()})}}class Fn{constructor(e,t,s){this.researchManager=e,this.ui=t,this.onLevelUp=s}awardXP(e,t){const s=this.researchManager.addXP(e);this.ui.updateXP(this.researchManager.getXP(),this.researchManager.getLevel()),t&&t.setPlayerLevel(this.researchManager.getLevel()),s.levelUp&&this.onLevelUp(s.newLevel,s.newResearchUnlocked)}checkAvailableResearches(e){const t=this.researchManager.getAvailableResearches();return t.length===0?!1:t.some(i=>this.researchManager.canResearch(i.id,e))||t.length>0}}class Wn{constructor(e,t,s,i,r){this.waveManager=e,this.xpHandler=t,this.onGoldChange=s,this.onLifeLost=i,this.onWaveComplete=r}handleEnemyKilled(e,t){this.onGoldChange(e),this.xpHandler.awardXP(t,this.waveManager)}handleEnemyEscaped(){this.onLifeLost()}handleWaveCompleted(e){const t=50+e*10,s=(20+e*5)*2;this.onGoldChange(t),this.xpHandler.awardXP(s,this.waveManager),this.onWaveComplete(e)}}class Gn{constructor(e,t,s,i){this.towerManager=e,this.ui=t,this.onGoldChange=s,this.onNotification=i}selectTower(e,t){this.towerManager.selectTower(e,t),this.ui.updateButtonStyles(this.towerManager.getSelectedType()||void 0)}tryPlaceTower(e,t,s){const i=this.towerManager.tryPlaceTower(e,t,s);return i.success?(this.onGoldChange(-i.cost),this.ui.updateButtonStyles(),!0):!1}tryUpgradeTower(e){const t=this.towerManager.tryUpgradeTower(e);return t.success?(this.onGoldChange(-t.cost),this.onNotification("upgrade"),!0):!1}trySellTower(){const e=this.towerManager.trySellTower();return e.success?(this.onGoldChange(e.refund),this.onNotification("sell",e.refund),!0):!1}getSelectedTower(){return this.towerManager.getSelectedTower()}deselectTower(){this.towerManager.deselectTower()}}const be=Object.create(null);be.open="0";be.close="1";be.ping="2";be.pong="3";be.message="4";be.upgrade="5";be.noop="6";const Ct=Object.create(null);Object.keys(be).forEach(n=>{Ct[be[n]]=n});const as={type:"error",data:"parser error"},Li=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Oi=typeof ArrayBuffer=="function",Bi=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,ws=({type:n,data:e},t,s)=>Li&&e instanceof Blob?t?s(e):hi(e,s):Oi&&(e instanceof ArrayBuffer||Bi(e))?t?s(e):hi(new Blob([e]),s):s(be[n]+(e||"")),hi=(n,e)=>{const t=new FileReader;return t.onload=function(){const s=t.result.split(",")[1];e("b"+(s||""))},t.readAsDataURL(n)};function di(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let ts;function qn(n,e){if(Li&&n.data instanceof Blob)return n.data.arrayBuffer().then(di).then(e);if(Oi&&(n.data instanceof ArrayBuffer||Bi(n.data)))return e(di(n.data));ws(n,!1,t=>{ts||(ts=new TextEncoder),e(ts.encode(t))})}const ui="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",et=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<ui.length;n++)et[ui.charCodeAt(n)]=n;const jn=n=>{let e=n.length*.75,t=n.length,s,i=0,r,o,a,l;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const h=new ArrayBuffer(e),d=new Uint8Array(h);for(s=0;s<t;s+=4)r=et[n.charCodeAt(s)],o=et[n.charCodeAt(s+1)],a=et[n.charCodeAt(s+2)],l=et[n.charCodeAt(s+3)],d[i++]=r<<2|o>>4,d[i++]=(o&15)<<4|a>>2,d[i++]=(a&3)<<6|l&63;return h},Vn=typeof ArrayBuffer=="function",bs=(n,e)=>{if(typeof n!="string")return{type:"message",data:Di(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:Xn(n.substring(1),e)}:Ct[t]?n.length>1?{type:Ct[t],data:n.substring(1)}:{type:Ct[t]}:as},Xn=(n,e)=>{if(Vn){const t=jn(n);return Di(t,e)}else return{base64:!0,data:n}},Di=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},Ui="",Yn=(n,e)=>{const t=n.length,s=new Array(t);let i=0;n.forEach((r,o)=>{ws(r,!1,a=>{s[o]=a,++i===t&&e(s.join(Ui))})})},Kn=(n,e)=>{const t=n.split(Ui),s=[];for(let i=0;i<t.length;i++){const r=bs(t[i],e);if(s.push(r),r.type==="error")break}return s};function Jn(){return new TransformStream({transform(n,e){qn(n,t=>{const s=t.length;let i;if(s<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s);else if(s<65536){i=new Uint8Array(3);const r=new DataView(i.buffer);r.setUint8(0,126),r.setUint16(1,s)}else{i=new Uint8Array(9);const r=new DataView(i.buffer);r.setUint8(0,127),r.setBigUint64(1,BigInt(s))}n.data&&typeof n.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(t)})}})}let ss;function St(n){return n.reduce((e,t)=>e+t.length,0)}function vt(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let s=0;for(let i=0;i<e;i++)t[i]=n[0][s++],s===n[0].length&&(n.shift(),s=0);return n.length&&s<n[0].length&&(n[0]=n[0].slice(s)),t}function Zn(n,e){ss||(ss=new TextDecoder);const t=[];let s=0,i=-1,r=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(s===0){if(St(t)<1)break;const l=vt(t,1);r=(l[0]&128)===128,i=l[0]&127,i<126?s=3:i===126?s=1:s=2}else if(s===1){if(St(t)<2)break;const l=vt(t,2);i=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),s=3}else if(s===2){if(St(t)<8)break;const l=vt(t,8),h=new DataView(l.buffer,l.byteOffset,l.length),d=h.getUint32(0);if(d>Math.pow(2,21)-1){a.enqueue(as);break}i=d*Math.pow(2,32)+h.getUint32(4),s=3}else{if(St(t)<i)break;const l=vt(t,i);a.enqueue(bs(r?l:ss.decode(l),e)),s=0}if(i===0||i>n){a.enqueue(as);break}}}})}const Ni=4;function q(n){if(n)return Qn(n)}function Qn(n){for(var e in q.prototype)n[e]=q.prototype[e];return n}q.prototype.on=q.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};q.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};q.prototype.off=q.prototype.removeListener=q.prototype.removeAllListeners=q.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var s,i=0;i<t.length;i++)if(s=t[i],s===e||s.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};q.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(t){t=t.slice(0);for(var s=0,i=t.length;s<i;++s)t[s].apply(this,e)}return this};q.prototype.emitReserved=q.prototype.emit;q.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};q.prototype.hasListeners=function(n){return!!this.listeners(n).length};const Ot=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),re=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),zn="arraybuffer";function Hi(n,...e){return e.reduce((t,s)=>(n.hasOwnProperty(s)&&(t[s]=n[s]),t),{})}const eo=re.setTimeout,to=re.clearTimeout;function Bt(n,e){e.useNativeTimers?(n.setTimeoutFn=eo.bind(re),n.clearTimeoutFn=to.bind(re)):(n.setTimeoutFn=re.setTimeout.bind(re),n.clearTimeoutFn=re.clearTimeout.bind(re))}const so=1.33;function io(n){return typeof n=="string"?ro(n):Math.ceil((n.byteLength||n.size)*so)}function ro(n){let e=0,t=0;for(let s=0,i=n.length;s<i;s++)e=n.charCodeAt(s),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(s++,t+=4);return t}function $i(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function no(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function oo(n){let e={},t=n.split("&");for(let s=0,i=t.length;s<i;s++){let r=t[s].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}class ao extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class Ss extends q{constructor(e){super(),this.writable=!1,Bt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new ao(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=bs(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=no(e);return t.length?"?"+t:""}}class lo extends Ss{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||t()})),this.writable||(s++,this.once("drain",function(){--s||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};Kn(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Yn(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=$i()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let Fi=!1;try{Fi=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const co=Fi;function ho(){}class uo extends lo{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let s=location.port;s||(s=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(i,r)=>{this.onError("xhr post error",i,r)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,s)=>{this.onError("xhr poll error",t,s)}),this.pollXhr=e}}class we extends q{constructor(e,t,s){super(),this.createRequest=e,Bt(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var e;const t=Hi(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(t);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var i;s.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=we.requestsCount++,we.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=ho,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete we.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}we.requestsCount=0;we.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",pi);else if(typeof addEventListener=="function"){const n="onpagehide"in re?"pagehide":"unload";addEventListener(n,pi,!1)}}function pi(){for(let n in we.requests)we.requests.hasOwnProperty(n)&&we.requests[n].abort()}const po=(function(){const n=Wi({xdomain:!1});return n&&n.responseType!==null})();class fo extends uo{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=po&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new we(Wi,this.uri(),e)}}function Wi(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||co))return new XMLHttpRequest}catch{}if(!e)try{return new re[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Gi=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class go extends Ss{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,s=Gi?{}:Hi(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],i=t===e.length-1;ws(s,this.supportsBinary,r=>{try{this.doWrite(s,r)}catch{}i&&Ot(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=$i()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const is=re.WebSocket||re.MozWebSocket;class mo extends go{createSocket(e,t,s){return Gi?new is(e,t,s):t?new is(e,t):new is(e)}doWrite(e,t){this.ws.send(t)}}class yo extends Ss{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=Zn(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),i=Jn();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const r=()=>{s.read().then(({done:a,value:l})=>{a||(this.onPacket(l),r())}).catch(a=>{})};r();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],i=t===e.length-1;this._writer.write(s).then(()=>{i&&Ot(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const wo={websocket:mo,webtransport:yo,polling:fo},bo=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,So=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function ls(n){if(n.length>8e3)throw"URI too long";const e=n,t=n.indexOf("["),s=n.indexOf("]");t!=-1&&s!=-1&&(n=n.substring(0,t)+n.substring(t,s).replace(/:/g,";")+n.substring(s,n.length));let i=bo.exec(n||""),r={},o=14;for(;o--;)r[So[o]]=i[o]||"";return t!=-1&&s!=-1&&(r.source=e,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=vo(r,r.path),r.queryKey=xo(r,r.query),r}function vo(n,e){const t=/\/{2,9}/g,s=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&s.splice(0,1),e.slice(-1)=="/"&&s.splice(s.length-1,1),s}function xo(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,i,r){i&&(t[i]=r)}),t}const cs=typeof addEventListener=="function"&&typeof removeEventListener=="function",Rt=[];cs&&addEventListener("offline",()=>{Rt.forEach(n=>n())},!1);class Re extends q{constructor(e,t){if(super(),this.binaryType=zn,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const s=ls(e);t.hostname=s.host,t.secure=s.protocol==="https"||s.protocol==="wss",t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=ls(t.host).host);Bt(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(s=>{const i=s.prototype.name;this.transports.push(i),this._transportsByName[i]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=oo(this.opts.query)),cs&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Rt.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=Ni,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Re.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",Re.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let s=0;s<this.writeBuffer.length;s++){const i=this.writeBuffer[s].data;if(i&&(t+=io(i)),s>0&&t>this._maxPayload)return this.writeBuffer.slice(0,s);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Ot(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,i){if(typeof t=="function"&&(i=t,t=void 0),typeof s=="function"&&(i=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const r={type:e,data:t,options:s};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(Re.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),cs&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=Rt.indexOf(this._offlineEventListener);s!==-1&&Rt.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Re.protocol=Ni;class ko extends Re{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),s=!1;Re.priorWebsocketSuccess=!1;const i=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",u=>{if(!s)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Re.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(d(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=t.name,this.emitReserved("upgradeError",p)}}))};function r(){s||(s=!0,d(),t.close(),t=null)}const o=u=>{const p=new Error("probe error: "+u);p.transport=t.name,r(),this.emitReserved("upgradeError",p)};function a(){o("transport closed")}function l(){o("socket closed")}function h(u){t&&u.name!==t.name&&r()}const d=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",l),this.off("upgrading",h)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",l),this.once("upgrading",h),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}let To=class extends ko{constructor(e,t={}){const s=typeof e=="object"?e:t;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(i=>wo[i]).filter(i=>!!i)),super(e,s)}};function _o(n,e="",t){let s=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),s=ls(n)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const r=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+r+":"+s.port+e,s.href=s.protocol+"://"+r+(t&&t.port===s.port?"":":"+s.port),s}const Co=typeof ArrayBuffer=="function",Ro=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,qi=Object.prototype.toString,Eo=typeof Blob=="function"||typeof Blob<"u"&&qi.call(Blob)==="[object BlobConstructor]",Po=typeof File=="function"||typeof File<"u"&&qi.call(File)==="[object FileConstructor]";function vs(n){return Co&&(n instanceof ArrayBuffer||Ro(n))||Eo&&n instanceof Blob||Po&&n instanceof File}function Et(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,s=n.length;t<s;t++)if(Et(n[t]))return!0;return!1}if(vs(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return Et(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&Et(n[t]))return!0;return!1}function Mo(n){const e=[],t=n.data,s=n;return s.data=hs(t,e),s.attachments=e.length,{packet:s,buffers:e}}function hs(n,e){if(!n)return n;if(vs(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let s=0;s<n.length;s++)t[s]=hs(n[s],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=hs(n[s],e));return t}return n}function Ao(n,e){return n.data=ds(n.data,e),delete n.attachments,n}function ds(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=ds(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=ds(n[t],e));return n}const Io=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Lo=5;var R;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(R||(R={}));class Oo{constructor(e){this.replacer=e}encode(e){return(e.type===R.EVENT||e.type===R.ACK)&&Et(e)?this.encodeAsBinary({type:e.type===R.EVENT?R.BINARY_EVENT:R.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===R.BINARY_EVENT||e.type===R.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Mo(e),s=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(s),i}}function fi(n){return Object.prototype.toString.call(n)==="[object Object]"}class xs extends q{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===R.BINARY_EVENT;s||t.type===R.BINARY_ACK?(t.type=s?R.EVENT:R.ACK,this.reconstructor=new Bo(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(vs(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(R[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===R.BINARY_EVENT||s.type===R.BINARY_ACK){const r=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(r,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");s.attachments=Number(o)}if(e.charAt(t+1)==="/"){const r=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););s.nsp=e.substring(r,t)}else s.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const r=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}s.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(xs.isPayloadValid(s.type,r))s.data=r;else throw new Error("invalid payload")}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case R.CONNECT:return fi(t);case R.DISCONNECT:return t===void 0;case R.CONNECT_ERROR:return typeof t=="string"||fi(t);case R.EVENT:case R.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Io.indexOf(t[0])===-1);case R.ACK:case R.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Bo{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=Ao(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Do=Object.freeze(Object.defineProperty({__proto__:null,Decoder:xs,Encoder:Oo,get PacketType(){return R},protocol:Lo},Symbol.toStringTag,{value:"Module"}));function he(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const Uo=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class ji extends q{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[he(e,"open",this.onopen.bind(this)),he(e,"packet",this.onpacket.bind(this)),he(e,"error",this.onerror.bind(this)),he(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,i,r;if(Uo.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:R.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const d=this.ids++,u=t.pop();this._registerAckCallback(d,u),o.id=d}const a=(i=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||i===void 0?void 0:i.writable,l=this.connected&&!(!((r=this.io.engine)===null||r===void 0)&&r._hasPingExpired());return this.flags.volatile&&!a||(l?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var s;const i=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},i),o=(...a)=>{this.io.clearTimeoutFn(r),t.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((s,i)=>{const r=(o,a)=>o?i(o):s(a);r.withError=!0,t.push(r),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...r)=>s!==this._queue[0]?void 0:(i!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...r)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:R.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(s=>String(s.id)===e)){const s=this.acks[e];delete this.acks[e],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case R.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case R.EVENT:case R.BINARY_EVENT:this.onevent(e);break;case R.ACK:case R.BINARY_ACK:this.onack(e);break;case R.DISCONNECT:this.ondisconnect();break;case R.CONNECT_ERROR:this.destroy();const s=new Error(e.data.message);s.data=e.data.data,this.emitReserved("connect_error",s);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(...i){s||(s=!0,t.packet({type:R.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:R.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function qe(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}qe.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};qe.prototype.reset=function(){this.attempts=0};qe.prototype.setMin=function(n){this.ms=n};qe.prototype.setMax=function(n){this.max=n};qe.prototype.setJitter=function(n){this.jitter=n};class us extends q{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Bt(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((s=t.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new qe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||Do;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new To(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=he(t,"open",function(){s.onopen(),e&&e()}),r=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=he(t,"error",r);if(this._timeout!==!1){const a=this._timeout,l=this.setTimeoutFn(()=>{i(),r(new Error("timeout")),t.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(he(e,"ping",this.onping.bind(this)),he(e,"data",this.ondata.bind(this)),he(e,"error",this.onerror.bind(this)),he(e,"close",this.onclose.bind(this)),he(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Ot(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new ji(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const s of t)if(this.nsps[s].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ze={};function Pt(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=_o(n,e.path||"/socket.io"),s=t.source,i=t.id,r=t.path,o=ze[i]&&r in ze[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let l;return a?l=new us(s,e):(ze[i]||(ze[i]=new us(s,e)),l=ze[i]),t.query&&!e.query&&(e.query=t.queryKey),l.socket(t.path,e)}Object.assign(Pt,{Manager:us,Socket:ji,io:Pt,connect:Pt});class de{static instance;socket=null;connected=!1;currentRoom=null;isHost=!1;eventHandlers=new Map;constructor(){}static getInstance(){return de.instance||(de.instance=new de),de.instance}connect(e){return new Promise((t,s)=>{if(this.connected&&this.socket){t();return}this.socket=Pt(e,{transports:["websocket"],reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5}),this.socket.on("connect",()=>{console.log("âœ… Connected to game server"),this.connected=!0,this.setupSocketListeners(),t()}),this.socket.on("connect_error",i=>{console.error("âŒ Connection error:",i),s(i)}),this.socket.on("disconnect",()=>{console.log("âŒ Disconnected from server"),this.connected=!1,this.trigger("disconnect")})})}setupSocketListeners(){this.socket&&(this.onSocket("room:created",e=>{this.currentRoom=e,this.trigger("room:created",e)}),this.onSocket("room:joined",e=>{this.currentRoom=e.code,this.isHost=e.isHost,this.trigger("room:joined",e)}),["room:playerJoined","room:playerLeft","room:playerReady"].forEach(e=>{this.onSocket(e,t=>this.trigger(e,t))}),this.onSocket("room:error",e=>this.trigger("room:error",e)),this.onSocket("game:started",()=>this.trigger("game:started")),this.onSocket("game:stateUpdate",e=>this.trigger("game:stateUpdate",e)),this.onSocket("game:towerPlaced",e=>this.trigger("game:towerPlaced",e)),this.onSocket("game:towerUpgraded",(e,t)=>this.trigger("game:towerUpgraded",{towerId:e,level:t})),this.onSocket("game:towerSold",(e,t)=>this.trigger("game:towerSold",{towerId:e,refund:t})),this.onSocket("game:enemySpawned",e=>this.trigger("game:enemySpawned",e)),this.onSocket("game:enemyDied",(e,t,s)=>this.trigger("game:enemyDied",{enemyId:e,gold:t,xp:s})),this.onSocket("game:waveStarted",e=>this.trigger("game:waveStarted",e)),this.onSocket("game:waveCompleted",(e,t)=>this.trigger("game:waveCompleted",{wave:e,bonus:t})),this.onSocket("game:levelUp",e=>this.trigger("game:levelUp",e)),this.onSocket("game:over",e=>this.trigger("game:over",e)))}onSocket(e,t){this.socket&&this.socket.on(e,(...s)=>t(...s))}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,[]),this.eventHandlers.get(e).push(t)}off(e,t){const s=this.eventHandlers.get(e);if(s){const i=s.indexOf(t);i>-1&&s.splice(i,1)}}trigger(e,t){const s=this.eventHandlers.get(e);s&&s.forEach(i=>i(t))}createRoom(e){return new Promise((t,s)=>{if(!this.socket){s(new Error("Not connected to server"));return}this.socket.emit("room:create",e,i=>{i.success&&i.code?t(i.code):s(new Error(i.error||"Failed to create room"))})})}joinRoom(e,t){return new Promise((s,i)=>{if(!this.socket){i(new Error("Not connected to server"));return}this.socket.emit("room:join",e,t,r=>{r.success?s():i(new Error(r.error||"Failed to join room"))})})}leaveRoom(){this.socket&&(this.socket.emit("room:leave"),this.currentRoom=null,this.isHost=!1)}setReady(e){this.socket&&this.socket.emit("room:ready",e)}startGame(){this.socket&&this.isHost&&this.socket.emit("room:startGame")}saveData(e,t){this.socket&&this.socket.emit("storage:saveData",{key:e,value:t})}loadData(e,t){this.socket&&this.socket.emit("storage:loadData",e,t)}placeTower(e,t,s){this.socket?(console.log(`ðŸ“¤ Sending tower placement: type=${e}, x=${t}, y=${s}`),this.socket.emit("game:placeTower",{type:e,x:t,y:s})):console.log("âŒ Cannot place tower: socket not connected")}upgradeTower(e){this.socket&&this.socket.emit("game:upgradeTower",e)}sellTower(e){this.socket&&this.socket.emit("game:sellTower",e)}startWave(){this.socket&&this.socket.emit("game:startWave")}unlockResearch(e){this.socket&&this.socket.emit("game:researchUnlock",e)}isConnected(){return this.connected}getCurrentRoom(){return this.currentRoom}getIsHost(){return this.isHost}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.connected=!1,this.currentRoom=null,this.isHost=!1,this.eventHandlers.clear())}}class No{scene;networkManager;onStateUpdate;constructor(e,t){this.scene=e,this.networkManager=de.getInstance(),this.onStateUpdate=t,this.setupListeners()}setupListeners(){this.networkManager.on("game:stateUpdate",e=>{this.handleStateUpdate(e)}),this.networkManager.on("game:over",e=>{this.handleGameOver(e)})}handleStateUpdate(e){this.onStateUpdate(e)}handleGameOver(e){console.log(`Game Over! ${e?"Victory!":"Defeat!"}`),this.scene.events.emit("gameOver",e)}cleanup(){this.networkManager.off("game:stateUpdate",this.handleStateUpdate),this.networkManager.off("game:over",this.handleGameOver)}}class Ho{networkManager;onTowerPlaced;onTowerUpgraded;onTowerSold;constructor(e,t,s){this.networkManager=de.getInstance(),this.onTowerPlaced=e,this.onTowerUpgraded=t,this.onTowerSold=s,this.setupListeners()}setupListeners(){this.networkManager.on("game:towerPlaced",e=>{this.onTowerPlaced(e)}),this.networkManager.on("game:towerUpgraded",e=>{this.onTowerUpgraded(e.towerId,e.level)}),this.networkManager.on("game:towerSold",e=>{this.onTowerSold(e.towerId,e.refund)})}requestPlaceTower(e,t,s){this.networkManager.placeTower(e,t,s)}requestUpgradeTower(e){this.networkManager.upgradeTower(e)}requestSellTower(e){this.networkManager.sellTower(e)}cleanup(){}}class $o{networkManager;onEnemySpawned;onEnemyDied;constructor(e,t){this.networkManager=de.getInstance(),this.onEnemySpawned=e,this.onEnemyDied=t,this.setupListeners()}setupListeners(){this.networkManager.on("game:enemySpawned",e=>{this.onEnemySpawned(e)}),this.networkManager.on("game:enemyDied",e=>{this.onEnemyDied(e.enemyId,e.gold,e.xp)})}cleanup(){}}class Fo{networkManager;onWaveStarted;onWaveCompleted;constructor(e,t){this.networkManager=de.getInstance(),this.onWaveStarted=e,this.onWaveCompleted=t,this.setupListeners()}setupListeners(){this.networkManager.on("game:waveStarted",e=>{this.onWaveStarted(e)}),this.networkManager.on("game:waveCompleted",e=>{this.onWaveCompleted(e.wave,e.bonus)}),this.networkManager.on("game:levelUp",e=>{console.log(`Level Up! Now level ${e}`)})}requestStartWave(){this.networkManager.startWave()}cleanup(){}}class Wo{networkManager;gameStateSync;towerSync;enemySync;waveSync;isMultiplayer;constructor(e,t){this.networkManager=de.getInstance(),this.isMultiplayer=this.networkManager.isConnected()&&this.networkManager.getCurrentRoom()!==null,this.isMultiplayer&&(this.gameStateSync=new No(e,t.onStateUpdate),this.towerSync=new Ho(t.onTowerPlaced,t.onTowerUpgraded,t.onTowerSold),this.enemySync=new $o(t.onEnemySpawned,t.onEnemyDied),this.waveSync=new Fo(t.onWaveStarted,t.onWaveCompleted))}isInMultiplayerMode(){return this.isMultiplayer}placeTower(e,t,s){this.isMultiplayer&&this.towerSync&&this.towerSync.requestPlaceTower(e,t,s)}upgradeTower(e){this.isMultiplayer&&this.towerSync&&this.towerSync.requestUpgradeTower(e)}sellTower(e){this.isMultiplayer&&this.towerSync&&this.towerSync.requestSellTower(e)}startWave(){this.isMultiplayer&&this.waveSync&&this.waveSync.requestStartWave()}unlockResearch(e){this.isMultiplayer&&this.networkManager.unlockResearch(e)}cleanup(){this.isMultiplayer&&(this.gameStateSync?.cleanup(),this.towerSync?.cleanup(),this.enemySync?.cleanup(),this.waveSync?.cleanup())}}class Go{constructor(e,t,s,i,r,o,a,l){this.scene=e,this.waveManager=t,this.towerManager=s,this.ui=i,this.xpHandler=r,this.onStateUpdate=o,this.onGoldChange=a,this.onGameStarted=l}coordinator;setup(){this.coordinator=new Wo(this.scene,{onStateUpdate:e=>this.handleStateUpdate(e),onTowerPlaced:e=>this.handleTowerPlaced(e),onTowerUpgraded:(e,t)=>this.handleTowerUpgraded(e,t),onTowerSold:(e,t)=>this.handleTowerSold(e,t),onEnemySpawned:e=>this.handleEnemySpawned(e),onEnemyDied:(e,t,s)=>this.handleEnemyDied(e,t,s),onWaveStarted:e=>this.handleWaveStarted(e),onWaveCompleted:(e,t)=>this.handleWaveCompleted(e,t)}),this.scene.events.on("gameOver",e=>{e||this.scene.events.emit("triggerGameOver")})}startWave(){this.coordinator?.startWave()}placeTower(e,t,s){console.log(`ðŸŽ¯ Requesting tower placement: ${e} at (${t}, ${s})`),this.coordinator?.placeTower(e,t,s)}upgradeTower(e){console.log(`ðŸ”§ Requesting tower upgrade: ${e}`),this.coordinator?.upgradeTower(e)}sellTower(e){this.coordinator?.sellTower(e)}handleStateUpdate(e){this.onStateUpdate(e.gold,e.lives),this.ui.updateWave(e.wave),this.ui.updateXP(e.xp,e.playerLevel),this.waveManager.setPlayerLevel(e.playerLevel),this.waveManager.setPlayerCount(e.playerCount)}handleTowerPlaced(e){console.log(`âœ… Tower placed by server: ${e.type} at (${e.x}, ${e.y}), level ${e.level}, id=${e.id}`),this.towerManager.addTowerFromServer(e.x,e.y,e.type,e.level,e.id)}handleTowerUpgraded(e,t){console.log(`âœ… Tower ${e} upgraded to level ${t} by server`),this.towerManager.upgradeTowerById(e,t)}handleTowerSold(e,t){console.log(`ðŸ’° Tower ${e} sold for ${t} gold by server`),this.towerManager.sellTowerById(e)}handleEnemySpawned(e){console.log(`Enemy spawned: ${e.type} (${e.id})`)}handleEnemyDied(e,t,s){console.log(`ðŸ’€ Enemy ${e} died. Rewarded: ${t} gold, ${s} xp`),this.onGoldChange(t),this.xpHandler.awardXP(s,this.waveManager)}handleWaveStarted(e){console.log(`Wave ${e} started`),this.onGameStarted(),this.ui.hideStartButton(),this.ui.updateWave(e),this.waveManager.resetWaveComplete(),this.waveManager.startWave()}handleWaveCompleted(e,t){console.log(`ðŸŽ‰ Wave ${e} completed. Bonus: ${t} gold`),this.onGoldChange(t);const s=(20+e*5)*2;this.xpHandler.awardXP(s,this.waveManager),this.waveManager.markWaveComplete(),this.ui.showStartButton()}}class qo{constructor(e){this.scene=e}show(e,t){const s=this.scene.cameras.main.width,i=this.scene.cameras.main.height;this.scene.add.rectangle(0,0,s,i,0,.7).setOrigin(0),this.scene.add.text(s/2,i/2-50,f("game.game_over"),{font:"bold 64px Arial",color:"#ff0000"}).setOrigin(.5),this.scene.add.text(s/2,i/2+20,f("game.final_wave",{wave:e}),{font:"32px Arial",color:"#ffffff"}).setOrigin(.5);const a=this.scene.add.text(s/2,i/2+100,f("menu.restart"),{font:"28px Arial",color:"#ffffff",backgroundColor:"#333333",padding:{x:20,y:10}});a.setOrigin(.5),a.setInteractive({useHandCursor:!0}),a.on("pointerover",()=>{a.setStyle({backgroundColor:"#555555"})}),a.on("pointerout",()=>{a.setStyle({backgroundColor:"#333333"})}),a.on("pointerdown",l=>{l.event.stopPropagation(),t()})}}class jo extends Phaser.Scene{ui;waveManager;towerManager;mapManager;researchManager;projectileManager;notifications;xpHandler;waveHandler;towerHandler;multiplayerHandler;gameOverScreen;gameStarted=!1;isReady=!1;gold=0;lives=0;isPaused=!1;autoWaveEnabled=!1;autoWaveTimer;config=E.getInstance().getConfig();levelType="classic";isMultiplayer=!1;roomCode;constructor(){super({key:"GameScene"})}init(e){const t=fs.getSettings(),s=this.config.game;if(this.isMultiplayer=e.multiplayer||!1,this.roomCode=e.roomCode,this.levelType=e.levelType||"classic",this.gold=s.startGold,this.lives=s.startLives,!this.isMultiplayer)switch(t.difficulty){case"easy":this.gold=s.startGold*2,this.lives=Math.round(s.startLives*1.5);break;case"normal":this.gold=s.startGold,this.lives=s.startLives;break;case"hard":this.gold=Math.round(s.startGold*.75),this.lives=Math.round(s.startLives*.75);break}this.gameStarted=!1,this.isReady=!1}async create(){this.mapManager=new ci(this,this.levelType);try{await this.mapManager.loadMap(),this.mapManager.create()}catch(e){console.error("Failed to load map:",e),this.mapManager=new ci(this,"classic"),await this.mapManager.loadMap(),this.mapManager.create()}this.waveManager=new Pn(this,this.mapManager.getPath(),this.levelType),this.towerManager=new Un(this,this.mapManager.getPath(),this.mapManager.getPlacementDistance()),this.researchManager=new Nn,this.projectileManager=new Hn,this.notifications=new $n(this),this.gameOverScreen=new qo(this),this.ui=new vn(this,this.gold,this.lives,this.researchManager),this.xpHandler=new Fn(this.researchManager,this.ui,(e,t)=>{this.notifications.showLevelUp(e),t.forEach(s=>{this.notifications.showResearchUnlocked(s)}),this.ui.showResearchButtonPulse()}),this.waveHandler=new Wn(this.waveManager,this.xpHandler,e=>this.changeGold(e),()=>this.handleLifeLost(),()=>this.checkResearchAvailability()),this.towerHandler=new Gn(this.towerManager,this.ui,e=>this.changeGold(e),(e,t)=>{e==="upgrade"?this.notifications.showTowerUpgrade():e==="sell"&&t&&this.notifications.showTowerSold(t)}),this.isMultiplayer&&(this.multiplayerHandler=new Go(this,this.waveManager,this.towerManager,this.ui,this.xpHandler,(e,t)=>{this.gold=e,this.lives=t,this.ui.updateGold(e),this.ui.updateLives(t)},e=>{this.gold+=e,this.ui.updateGold(this.gold)},()=>{this.gameStarted=!0}),this.multiplayerHandler.setup(),this.events.on("triggerGameOver",()=>this.gameOver())),this.ui.create(()=>this.handleStartWave(),(e,t)=>this.handleTowerSelect(e,t),()=>this.handlePauseToggle(),()=>this.handleAutoWaveToggle(),()=>this.handleResearchToggle(),e=>{e==="tower_damage_1"?this.towerManager.applyDamageMultiplierToAll(1.1):e==="tower_range_1"&&this.towerManager.applyRangeMultiplierToAll(1.1)},()=>this.handleUpgradeTower(),()=>this.handleSellTower()),this.isMultiplayer&&this.roomCode&&this.ui.showRoomCode(this.roomCode),this.checkAndShowResearchNotification(),this.input.on("pointerdown",e=>{this.handlePointerDown(e)}),this.input.on("pointermove",e=>{this.towerManager.updatePreview(e)}),this.isReady=!0,this.events.on("shutdown",()=>{try{this.ui?.destroy()}catch{}})}update(e,t){if(!this.isReady||this.isPaused)return;const s=this.towerManager.getSelectedTower();this.ui.updateUpgradeButton(s),this.waveManager.update(t,(r,o)=>this.waveHandler.handleEnemyKilled(r,o),()=>this.waveHandler.handleEnemyEscaped(),r=>this.waveHandler.handleWaveCompleted(r)),this.towerManager.update(e,this.waveManager.getEnemies()).forEach(r=>this.projectileManager.addProjectile(r)),this.projectileManager.update(t),this.waveManager.isWaveComplete()&&this.gameStarted&&(this.autoWaveEnabled?this.autoWaveTimer||(this.autoWaveTimer=this.time.delayedCall(5e3,()=>{this.handleStartWave(),this.autoWaveTimer=void 0})):this.ui.showStartButton("NÃ¤chste Welle"))}handleStartWave(){if(this.isMultiplayer&&this.multiplayerHandler){this.multiplayerHandler.startWave();return}this.waveManager.isSpawningEnemies()||(this.gameStarted||(this.gameStarted=!0),this.autoWaveTimer&&(this.autoWaveTimer.destroy(),this.autoWaveTimer=void 0),this.waveManager.resetWaveComplete(),this.ui.hideStartButton(),this.waveManager.startWave(),this.ui.updateWave(this.waveManager.getWave()))}handleTowerSelect(e,t){this.towerHandler.selectTower(e,t)}handleUpgradeTower(){if(this.isMultiplayer&&this.multiplayerHandler){const e=this.towerHandler.getSelectedTower();if(e){const t=e.id;if(!t){console.error("âŒ Selected tower has no ID! Cannot upgrade in multiplayer.");return}console.log(`ðŸŽ¯ Upgrade button clicked for tower: ${t}`),this.multiplayerHandler.upgradeTower(t)}else console.error("âŒ No tower selected for upgrade");return}this.towerHandler.tryUpgradeTower(this.gold)}handleSellTower(){if(this.isMultiplayer&&this.multiplayerHandler){const e=this.towerHandler.getSelectedTower();if(e){const t=e.id||"unknown";this.multiplayerHandler.sellTower(t)}return}this.towerHandler.trySellTower()}handlePauseToggle(){this.isPaused=!this.isPaused,this.isPaused?this.physics.pause():this.physics.resume(),this.ui.setPaused(this.isPaused)}handleAutoWaveToggle(){this.autoWaveEnabled=!this.autoWaveEnabled,this.ui.setAutoWave(this.autoWaveEnabled),this.autoWaveEnabled&&this.waveManager.isWaveComplete()&&!this.autoWaveTimer&&(this.autoWaveTimer=this.time.delayedCall(5e3,()=>{this.handleStartWave(),this.autoWaveTimer=void 0})),!this.autoWaveEnabled&&this.autoWaveTimer&&(this.autoWaveTimer.destroy(),this.autoWaveTimer=void 0,this.ui.showStartButton("NÃ¤chste Welle"))}handleResearchToggle(){this.ui.toggleResearchOverlay()}changeGold(e){this.gold+=e,this.ui.updateGold(this.gold)}handleLifeLost(){this.lives--,this.ui.updateLives(this.lives),this.lives<=0&&this.gameOver()}checkAndShowResearchNotification(){this.xpHandler.checkAvailableResearches(this.gold)&&this.ui.showResearchButtonPulse()}checkResearchAvailability(){this.xpHandler.checkAvailableResearches(this.gold)&&this.ui.showResearchButtonPulse()}handlePointerDown(e){if(!this.ui.getButtons().some(i=>i.visible?i.getBounds().contains(e.x,e.y):!1)){if(this.isMultiplayer&&this.multiplayerHandler){const i=this.towerManager.getSelectedType();i&&(console.log(`ðŸŽ¯ Requesting tower placement: ${i} at (${e.x}, ${e.y})`),this.multiplayerHandler.placeTower(i,e.x,e.y),this.towerHandler.deselectTower());return}this.towerHandler.tryPlaceTower(e.x,e.y,this.gold)}}gameOver(){this.physics.pause(),this.waveManager.cleanup(),this.towerManager.cleanup(),this.time.removeAllEvents(),this.input.off("pointerdown"),this.input.off("pointermove"),this.gameOverScreen.show(this.waveManager.getWave(),()=>this.scene.restart())}}class Vo{constructor(e){this.scene=e}playerListText=null;show(e,t,s,i,r,o,a){const h=this.scene.add.graphics();h.fillStyle(2899536,1),h.fillRoundedRect(e-300,130,600,100,10),h.lineStyle(3,2600544,1),h.strokeRoundedRect(e-300,130,600,100,10),this.scene.add.text(e,155,"Raum-Code:",{fontSize:"20px",color:"#bdc3c7"}).setOrigin(.5),this.scene.add.text(e,190,t,{fontSize:"36px",color:"#27ae60",fontStyle:"bold"}).setOrigin(.5);const d=260,u=this.scene.add.graphics();u.fillStyle(2899536,1),u.fillRoundedRect(e-300,d,600,220,10),u.lineStyle(2,3426654,1),u.strokeRoundedRect(e-300,d,600,220,10),this.scene.add.text(e,d+25,"ðŸ‘¥ Spieler",{fontSize:"24px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5),this.playerListText=this.scene.add.text(e,d+70,"Lade Spielerliste...",{fontSize:"20px",color:"#ecf0f1",align:"center",lineSpacing:12}).setOrigin(.5,0);const p=520,g=s?e-160:e,b=this.scene.add.text(g,p,i?"âœ“ Bereit":"Bereit?",{fontSize:"24px",color:"#ffffff",backgroundColor:i?"#27ae60":"#95a5a6",padding:{x:35,y:15}}).setOrigin(.5).setInteractive();if(b.on("pointerdown",r),b.on("pointerover",()=>{b.setBackgroundColor(i?"#229954":"#7f8c8d")}),b.on("pointerout",()=>{b.setBackgroundColor(i?"#27ae60":"#95a5a6")}),s){const L=this.scene.add.text(e+160,p,"Starten",{fontSize:"24px",color:"#ffffff",backgroundColor:"#f39c12",padding:{x:35,y:15}}).setOrigin(.5).setInteractive();L.on("pointerdown",o),L.on("pointerover",()=>L.setBackgroundColor("#e67e22")),L.on("pointerout",()=>L.setBackgroundColor("#f39c12"))}const T=this.scene.add.text(e,p+80,"â† Verlassen",{fontSize:"20px",color:"#ffffff",backgroundColor:"#e74c3c",padding:{x:30,y:12}}).setOrigin(.5).setInteractive();return T.on("pointerdown",a),T.on("pointerover",()=>T.setBackgroundColor("#c0392b")),T.on("pointerout",()=>T.setBackgroundColor("#e74c3c")),{playerListText:this.playerListText,readyButton:b}}updatePlayerList(e){if(!this.playerListText)return;if(e.size===0){this.playerListText.setText("Keine Spieler im Raum");return}const t=Array.from(e.values()).map(s=>{const i=s.ready?"âœ“":"â—‹",r=s.isHost?" ðŸ‘‘":"";return`${i} ${s.name}${r}`}).join(`
`);this.playerListText.setText(t)}}class it{static create(e,t,s,i,r){const o=document.createElement("input");return o.type="text",o.placeholder=r,o.autocomplete="on",o.style.position="absolute",o.style.left=`${e}px`,o.style.top=`${t}px`,o.style.width=`${s}px`,o.style.height=`${i}px`,o.style.fontSize="18px",o.style.padding="10px 15px",o.style.border="2px solid #3498db",o.style.borderRadius="8px",o.style.backgroundColor="#34495e",o.style.color="#ecf0f1",o.style.boxSizing="border-box",o.style.textAlign="center",o.style.fontFamily="Arial, sans-serif",o.style.outline="none",o.style.transition="all 0.3s",o.addEventListener("focus",()=>{o.style.border="2px solid #3498db",o.style.backgroundColor="#2c3e50"}),o.addEventListener("blur",()=>{o.style.border="2px solid #3498db",o.style.backgroundColor="#34495e"}),document.body.appendChild(o),o}static removeAll(e){e.forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)})}}class Xo{constructor(e){this.scene=e}playerNameInput=null;show(e,t,s){const i=this.scene.add.graphics();i.fillStyle(2899536,1),i.fillRoundedRect(e-250,t,500,240,10),i.lineStyle(2,3426654,1),i.strokeRoundedRect(e-250,t,500,240,10),this.scene.add.text(e,t+25,"ðŸŽ® Neuen Raum Erstellen",{fontSize:"26px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5),this.scene.add.text(e,t+50,"Spielername:",{fontSize:"18px",color:"#ecf0f1"}).setOrigin(.5),this.playerNameInput=it.create(e-120,t+120,440,45,"Dein Name");const r=ie.getInstance().getLocal("playerName");r&&(this.playerNameInput.value=r);const o=this.scene.add.text(e,t+180,"Raum Erstellen",{fontSize:"22px",color:"#ffffff",backgroundColor:"#27ae60",padding:{x:40,y:12}}).setOrigin(.5).setInteractive();return o.on("pointerdown",()=>{const a=this.playerNameInput?.value.trim()||"";s(a)}),o.on("pointerover",()=>o.setBackgroundColor("#229954")),o.on("pointerout",()=>o.setBackgroundColor("#27ae60")),this.playerNameInput}cleanup(){this.playerNameInput&&(it.removeAll([this.playerNameInput]),this.playerNameInput=null)}}class Yo{constructor(e){this.scene=e}playerNameInput=null;roomCodeInput=null;show(e,t,s){const i=this.scene.add.graphics();i.fillStyle(2899536,1),i.fillRoundedRect(e-250,t,500,300,10),i.lineStyle(2,3426654,1),i.strokeRoundedRect(e-250,t,500,300,10),this.scene.add.text(e,t+25,"ðŸšª Raum Beitreten",{fontSize:"26px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5),this.scene.add.text(e,t+60,"Spielername:",{fontSize:"18px",color:"#ecf0f1"}).setOrigin(.5),this.playerNameInput=it.create(e-120,t+120,440,45,"Dein Name");const r=ie.getInstance().getLocal("playerName");r&&(this.playerNameInput.value=r),this.scene.add.text(e,t+100,"Raum-Code: (z.B. bear-lamp)",{fontSize:"18px",color:"#ecf0f1"}).setOrigin(.5),this.roomCodeInput=it.create(e-110,t+180,440,45,"Raum-Code eingeben");const o=this.scene.add.text(e,t+220,"Beitreten",{fontSize:"22px",color:"#ffffff",backgroundColor:"#3498db",padding:{x:40,y:12}}).setOrigin(.5).setInteractive();return o.on("pointerdown",()=>{const a=this.playerNameInput?.value.trim()||"",l=this.roomCodeInput?.value.trim().toLowerCase()||"";s(a,l)}),o.on("pointerover",()=>o.setBackgroundColor("#2980b9")),o.on("pointerout",()=>o.setBackgroundColor("#3498db")),{playerNameInput:this.playerNameInput,roomCodeInput:this.roomCodeInput}}cleanup(){const e=[];this.playerNameInput&&e.push(this.playerNameInput),this.roomCodeInput&&e.push(this.roomCodeInput),e.length>0&&it.removeAll(e),this.playerNameInput=null,this.roomCodeInput=null}}class Ko{constructor(e,t,s,i,r,o,a,l){this.networkManager=e,this.onRoomJoined=t,this.onPlayerJoined=s,this.onPlayerReady=i,this.onPlayerLeft=r,this.onGameStarted=o,this.onError=a,this.onDisconnect=l}setup(){this.networkManager.on("room:joined",e=>{this.onRoomJoined(e.code,e.players)}),this.networkManager.on("room:playerJoined",e=>{this.onPlayerJoined(e)}),this.networkManager.on("room:playerReady",e=>{this.onPlayerReady(e.playerId,e.isReady,e.name)}),this.networkManager.on("room:playerLeft",e=>{this.onPlayerLeft(e,"Spieler")}),this.networkManager.on("room:error",e=>{this.onError(e)}),this.networkManager.on("game:started",()=>{this.onGameStarted(this.networkManager.getCurrentRoom()||"")}),this.networkManager.on("disconnect",()=>{this.onDisconnect()})}}class Jo{constructor(e,t,s,i){this.networkManager=e,this.onSuccess=t,this.onError=s,this.onLoading=i}async createRoom(e){if(!this.validatePlayerName(e))return null;ie.getInstance().setLocal("playerName",e),this.onLoading(f("room.create_loading"));try{const t=await this.networkManager.createRoom(e);return this.onSuccess(f("room.created",{code:t})),t}catch(t){return this.onError(f("room.error_prefix")+t.message),null}}async joinRoom(e,t){if(!this.validatePlayerName(e)||!this.validateRoomCode(t))return!1;ie.getInstance().setLocal("playerName",e),this.onLoading(f("room.join_loading"));try{return await this.networkManager.joinRoom(t,e),this.onSuccess(f("room.joined",{code:t})),!0}catch(s){return this.onError(f("room.error_prefix")+s.message),!1}}leaveRoom(){this.networkManager.leaveRoom()}setReady(e){this.networkManager.setReady(e)}startGame(){return console.log("Starting game..."),this.networkManager.startGame(),!0}validateGameStart(e){const t=Array.from(e.values()),s=t.every(i=>i.isReady||i.isHost);return console.log("Players:",t.map(i=>({name:i.name,isHost:i.isHost,isReady:i.isReady}))),console.log("All ready?",s),s?e.size<1?{canStart:!1,message:f("room.players_min")}:{canStart:!0}:{canStart:!1,message:f("room.players_not_ready")}}validatePlayerName(e){return e?e.length<2||e.length>20?(this.onError(f("room.name_length_error")),!1):!0:(this.onError(f("room.enter_name")),!1)}validateRoomCode(e){return e?/^[a-z]{2,4}-[a-z]{2,4}$/.test(e)?!0:(this.onError(f("room.code_format_error")),!1):(this.onError(f("room.enter_code")),!1)}}class Zo extends tt.Scene{networkManager;config;roomLobbyUI;roomCreationUI;roomJoinUI;networkEventSetup;roomActionHandler;statusText=null;readyButton=null;players=new Map;isReady=!1;currentRoomCode=null;constructor(){super({key:"MultiplayerScene"}),this.networkManager=de.getInstance()}init(){this.cleanupComponents()}create(){this.config=E.getInstance().getConfig();const e=this.cameras.main.centerX;this.add.text(e,50,f("multiplayer.title"),{fontSize:"48px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5),this.networkManager.isConnected()?this.showLobbyUI():this.connectToServer()}async connectToServer(){const e=this.cameras.main.centerX,t=this.cameras.main.centerY,s=this.add.text(e,t,f("multiplayer.connecting"),{fontSize:"24px",color:"#ffff00"}).setOrigin(.5);try{const i=`http://localhost:${this.config.multiplayer.serverPort}`;await this.networkManager.connect(i),s.destroy(),this.showLobbyUI()}catch{s.setText(f("multiplayer.server_unreachable")),s.setColor("#ff0000");const r=this.add.text(e,t+100,"< "+f("options.back"),{fontSize:"24px",color:"#ffffff",backgroundColor:"#333333",padding:{x:20,y:10}}).setOrigin(.5).setInteractive();r.on("pointerdown",()=>{this.cleanupComponents(),this.scene.start("MainMenuScene")}),r.on("pointerover",()=>{r.setBackgroundColor("#555555")}),r.on("pointerout",()=>{r.setBackgroundColor("#333333")})}}showLobbyUI(){const e=this.cameras.main.width,t=this.cameras.main.height,s=e/2;if(this.networkManager.getCurrentRoom()){this.showRoomUI();return}this.roomActionHandler=new Jo(this.networkManager,r=>this.showStatus(r,"#2ecc71"),r=>this.showStatus(r,"#e74c3c"),r=>this.showStatus(r,"#ffff00"));const i=this.add.text(30,30,"â—€ "+f("options.back"),{fontSize:"20px",color:"#ffffff",backgroundColor:"#333333",padding:{x:15,y:10}}).setInteractive();i.on("pointerdown",()=>{this.networkManager.disconnect(),this.scene.start("MainMenuScene")}),i.on("pointerover",()=>i.setBackgroundColor("#555555")),i.on("pointerout",()=>i.setBackgroundColor("#333333")),this.roomCreationUI=new Xo(this),this.roomCreationUI.show(s,150,async r=>{const o=await this.roomActionHandler.createRoom(r);o&&(this.currentRoomCode=o)}),this.add.text(s,380,f("multiplayer.or"),{fontSize:"18px",color:"#7f8c8d",fontStyle:"italic"}).setOrigin(.5),this.roomJoinUI=new Yo(this),this.roomJoinUI.show(s,420,async(r,o)=>{await this.roomActionHandler.joinRoom(r,o)&&(this.currentRoomCode=o)}),this.statusText=this.add.text(s,t-40,"",{fontSize:"18px",color:"#e74c3c",align:"center",fontStyle:"bold"}).setOrigin(.5),this.setupNetworkListeners()}showRoomUI(){this.cleanupComponents(),this.children.removeAll();const e=this.cameras.main.width,t=this.cameras.main.height,s=e/2;this.add.text(s,50,"Multiplayer Lobby",{fontSize:"48px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5),this.roomLobbyUI=new Vo(this);const{readyButton:i}=this.roomLobbyUI.show(s,this.currentRoomCode||"",this.networkManager.getIsHost(),this.isReady,()=>this.toggleReady(),()=>this.handleStartGame(),()=>this.handleLeaveRoom());this.readyButton=i,this.statusText=this.add.text(s,t-40,"",{fontSize:"18px",color:"#e74c3c",align:"center",fontStyle:"bold"}).setOrigin(.5),this.updatePlayerList()}setupNetworkListeners(){this.networkEventSetup=new Ko(this.networkManager,(e,t)=>{this.currentRoomCode=e,this.players.clear(),t.forEach(s=>{this.players.set(s.id,s)}),this.showRoomUI()},e=>{this.players.set(e.id,e),this.updatePlayerList(),this.showStatus(f("multiplayer.player_joined",{name:e.name}),"#2ecc71")},(e,t,s)=>{const i=this.players.get(e);i&&(i.isReady=t,this.updatePlayerList(),console.log(`Player ${s} ready status: ${t}`))},(e,t)=>{this.players.delete(e),this.updatePlayerList(),this.showStatus(f("multiplayer.player_left",{name:t}),"#e74c3c")},e=>{this.showStatus(f("multiplayer.starting"),"#2ecc71"),this.time.delayedCall(1e3,()=>{this.cleanupComponents(),this.scene.start("GameScene",{multiplayer:!0,roomCode:this.currentRoomCode})})},e=>{this.showStatus(f("multiplayer.error_prefix")+e,"#e74c3c")},()=>{this.showStatus(f("multiplayer.connection_lost"),"#e74c3c"),this.time.delayedCall(3e3,()=>{this.cleanupComponents(),this.scene.start("MainMenuScene")})}),this.networkEventSetup.setup()}handleLeaveRoom(){this.roomActionHandler?.leaveRoom(),this.players.clear(),this.currentRoomCode=null,this.isReady=!1,this.cleanupComponents(),this.children.removeAll(),this.create()}toggleReady(){this.isReady=!this.isReady,console.log("Toggle ready:",this.isReady),this.roomActionHandler?.setReady(this.isReady),this.readyButton&&(this.readyButton.setText(this.isReady?"âœ“ Bereit":"Bereit?"),this.readyButton.setBackgroundColor(this.isReady?"#27ae60":"#95a5a6"))}handleStartGame(){if(!this.roomActionHandler)return;const e=this.roomActionHandler.validateGameStart(this.players);if(!e.canStart){this.showStatus(e.message,"#e74c3c");return}this.roomActionHandler.startGame()}updatePlayerList(){this.roomLobbyUI&&this.roomLobbyUI.updatePlayerList(this.players)}showStatus(e,t){this.statusText&&(this.statusText.setText(e),this.statusText.setColor(t))}cleanupComponents(){this.roomCreationUI&&(this.roomCreationUI.cleanup(),this.roomCreationUI=void 0),this.roomJoinUI&&(this.roomJoinUI.cleanup(),this.roomJoinUI=void 0),this.roomLobbyUI=void 0}shutdown(){this.cleanupComponents()}}class Qo extends Phaser.Scene{auth;constructor(){super({key:"AdminScene"}),this.auth=ge.getInstance()}create(){const e=this.cameras.main.width;this.add.text(e/2,40,f("admin.title"),{font:"bold 32px Arial",color:"#ffffff"}).setOrigin(.5);const s=this.add.text(20,20,"â† "+f("options.back"),{font:"18px Arial",color:"#ffffff"});s.setInteractive({useHandCursor:!0}),s.on("pointerdown",()=>{this.scene.resume("MainMenuScene"),this.scene.stop()}),this.add.text(e/2,120,f("admin.loading"),{font:"16px Arial",color:"#cccccc"}).setOrigin(.5),this.fetchAndRenderReports(160)}async fetchAndRenderReports(e){try{const t=this.auth.getAuthToken();if(!t){this.add.text(this.cameras.main.width/2,e,f("admin.not_logged_in"),{color:"#ff6666"}).setOrigin(.5);return}const s=await fetch("/telemetry/errors",{headers:{Authorization:`Bearer ${t}`}});if(!s.ok)return this.add.text(this.cameras.main.width/2,e,f("admin.load_error"),{color:"#ff6666"}).setOrigin(.5);const r=(await s.json()).reports||[];if(r.length===0){this.add.text(this.cameras.main.width/2,e,f("admin.no_reports"),{color:"#888888"}).setOrigin(.5);return}let o=e;for(const a of r.slice().reverse()){const l=a.message||a.extra&&a.extra.message||"no message",h=a.receivedAt||a.timestamp||"",d=this.add.text(40,o,`${h} â€” ${l}`,{font:"14px Arial",color:"#ffffff",wordWrap:{width:this.cameras.main.width-80}});o+=d.getBounds().height+8}}catch(t){console.error("Failed to fetch reports",t),this.add.text(this.cameras.main.width/2,e,"Fehler beim Laden",{color:"#ff6666"}).setOrigin(.5)}}}class zo{persistence=ie.getInstance();installed=!1;constructor(){}async report(e,t){try{const s={message:e?.message||String(e)||"Unknown error",stack:e?.stack||null,url:typeof window<"u"&&window.location&&window.location.href||"unknown",timestamp:new Date().toISOString(),userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",extra:t},r=ge.getInstance().getAuthToken();await this.persistence.saveErrorReport(s,r||void 0),console.error("Global error captured and persisted:",s)}catch(s){console.error("ErrorReporter failed while reporting an error:",s)}}installGlobalHandlers(e){if(this.installed)return;this.installed=!0;const t=e?.onRestart;let s=0,i=null;const r=()=>{try{if(!(this.persistence.loadSettings()?.autoRestartOnError??!0)){console.warn("Auto-restart disabled in settings; skipping restart.");return}}catch{}const o=Date.now();i||(i=o),i&&o-i>3e4&&(s=0,i=o),s+=1;const a=e?.maxRestarts??3;if(s>a){console.error("Too many restart attempts, will not restart again automatically.");return}try{typeof t=="function"?t():typeof window<"u"&&window.location.reload()}catch(l){console.error("Failed to restart game via restart function:",l)}};typeof window<"u"&&(window.addEventListener("error",o=>{try{const a=o.error||{message:o.message};this.report(a,{filename:o.filename,lineno:o.lineno,colno:o.colno})}catch(a){console.error("Error inside global error handler:",a)}r()}),window.addEventListener("unhandledrejection",o=>{try{const a=o.reason||{message:"Unhandled rejection"};this.report(a,{reason:o.reason})}catch(a){console.error("Error inside unhandledrejection handler:",a)}r()}))}}const ea=new zo,ta={type:tt.AUTO,parent:"game-container",backgroundColor:"#2d2d2d",scale:{mode:tt.Scale.FIT,autoCenter:tt.Scale.CENTER_BOTH,width:1280,height:720},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scene:[vr,xr,Rr,jo,fs,Zo,Qo]};let Mt=null,gi=0,xt=0;async function ps(){try{await E.getInstance().load(),Mt=new tt.Game(ta),sa(),ea.installGlobalHandlers({onRestart:Vi})}catch(n){console.error("Failed to initialize game:",n),document.body.innerHTML='<div style="color: white; text-align: center; padding: 50px;">Failed to load game configuration. Please refresh the page.</div>'}}function mi(){try{const n="open-td-error-overlay";let e=document.getElementById(n);if(!e){e=document.createElement("div"),e.id=n,e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.right="0",e.style.bottom="0",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.background="rgba(0,0,0,0.7)",e.style.color="#fff",e.style.zIndex="99999",e.style.fontSize="18px",e.style.padding="20px";try{const t=require("./client/i18n");e.textContent=typeof t?.t=="function"?t.t("main.restart_overlay_message"):"An error occurred. Restarting the game automatically..."}catch{e.textContent="An error occurred. Restarting the game automatically..."}document.body.appendChild(e)}}catch(n){console.error("Failed to show restart overlay",n)}}function sa(){try{const e=document.getElementById("open-td-error-overlay");e&&e.remove()}catch(n){console.error("Failed to remove restart overlay",n)}}async function Vi(){try{const n=Date.now();if(n-gi>3e4&&(xt=0),gi=n,xt+=1,xt>3){console.error("Too many restarts attempted â€” aborting automatic restart."),mi();return}if(mi(),console.warn("Restarting Phaser game (attempt "+xt+")"),Mt){try{Mt.destroy(!0,!1)}catch(e){console.error("Failed to destroy Phaser game instance during restart:",e)}Mt=null}await new Promise(e=>setTimeout(e,400)),ps()}catch(n){console.error("Failed to restart game:",n)}}try{typeof window<"u"&&(window.restartGame=Vi)}catch{}rt.isNativePlatform()?document.addEventListener("deviceready",()=>{ps()}):window.addEventListener("load",()=>{ps()});
